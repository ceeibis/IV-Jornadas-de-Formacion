function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{r||null==s["return"]||s["return"]()}finally{if(o)throw i}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){return Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{r||null==s["return"]||s["return"]()}finally{if(o)throw i}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{r||null==s["return"]||s["return"]()}finally{if(o)throw i}}return n}function _arrayWithHoles(e){return Array.isArray(e)?e:void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __guard__(e,t){return"undefined"!=typeof e&&null!==e?t(e):void 0}function __range__(e,t,n){for(var r=[],o=t>e,i=n?o?t+1:t-1:t,a=e;o?i>a:a>i;o?a++:a--)r.push(a);return r}define("libs/polyfills/symbol",[],function(){!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e):t(e)}("undefined"!=typeof window?window:global,function(e){"use strict";function t(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(t){return!1}var n={object:!0,symbol:!0};return n[typeof Symbol.iterator]&&n[typeof Symbol.toPrimitive]&&n[typeof Symbol.toStringTag]?!0:!1}t()||!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e):t(e)}("undefined"!=typeof window?window:e,function(e){var t=Object.defineProperty,n=Object.defineProperties,r=0,o=[],i=Array.prototype.slice,a="object"==typeof e.ES6?e.ES6:e.ES6={},s=Array.isArray,l=Object.prototype.toString,c=Array.prototype.push,u=function(){},d=function(e){return e},f=function(e){return"function"==typeof e},p=function(){},m=function(e,t){this._array=e,this._flag=t,this._nextIndex=0},h=function(e,t){this._string=e,this._flag=t,this._nextIndex=0},g=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)},v=function(e,t){return n(e,{_description:{value:t},_isSymbol:{value:!0},_id:{value:r++}}),e},_=function(e,t){if("number"==typeof e.length&&e.length>=0&&"number"==typeof t.length&&t.length>=0){var n=Math.floor(e.length),r=Math.floor(t.length),o=0;for(e.length=n+r;r>o;++o)t.hasOwnProperty(o)&&(e[n+o]=t[o])}},q=function(e,t){if("function"!=typeof e||"function"!=typeof t)throw new TypeError("Child and Parent must be function type");e.prototype=Object.create(t.prototype),e.prototype.constructor=e},b=function w(e){if(e=void 0===e?"":String(e),this instanceof w)throw new TypeError("Symbol is not a constructor");return v(Object.create(w.prototype),e)};n(b,{"for":{value:function(e){e=String(e);for(var t,n=o.length,r=0;n>r;++r)if((t=o[r]).key===e)return t.symbol;return t={key:e,symbol:b(e)},o.push(t),t.symbol},writable:!0,configurable:!0},keyFor:{value:function(e){if(!a.isSymbol(e))throw new TypeError(String(e)+" is not a symbol");for(var t,n=o.length,r=0;n>r;++r)if((t=o[r]).symbol===e)return t.key},writable:!0,configurable:!0},hasInstance:{value:b("Symbol.hasInstance")},isConcatSpreadable:{value:b("Symbol.isConcatSpreadable")},iterator:{value:b("Symbol.iterator")},toStringTag:{value:b("Symbol.toStringTag")}}),b.prototype.toString=function(){return"@@_____"+this._id+"_____"},b.prototype.valueOf=function(){return this},t(p.prototype,b.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),q(m,p),q(h,p),t(m.prototype,b.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),t(h.prototype,b.toStringTag.toString(),{value:"String Iterator",configurable:!0}),m.prototype.next=function(){if(!(this instanceof m))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var e;return-1===this._nextIndex?{done:!0,value:void 0}:"number"==typeof this._array.length&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(1===this._flag?e=[this._nextIndex,this._array[this._nextIndex]]:2===this._flag?e=this._array[this._nextIndex]:3===this._flag&&(e=this._nextIndex),this._nextIndex++,{done:!1,value:e}):(this._nextIndex=-1,{done:!0,value:void 0})},h.prototype.next=function(){if(!(this instanceof h))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var e,t=new String(this._string);return-1===this._nextIndex?{done:!0,value:void 0}:this._nextIndex<t.length?(e=t[this._nextIndex],this._nextIndex++,{done:!1,value:e}):(this._nextIndex=-1,{done:!0,value:void 0})};var y=function(e,t){this._target=e,this._values=[],this._thisArg=t};return y.prototype.spread=function(){var e=this;return i.call(arguments).forEach(function(t){a.forOf(t,function(t){e._values.push(t)})}),e},y.prototype.add=function(){var e=this;return i.call(arguments).forEach(function(t){e._values.push(t)}),e},y.prototype.call=function(e){if("function"!=typeof this._target)throw new TypeError("Target is not a function");return e=arguments.length<=0?this._thisArg:e,this._target.apply(e,this._values)},y.prototype["new"]=function(){if("function"!=typeof this._target)throw new TypeError("Target is not a constructor");var e,t;return e=Object.create(this._target.prototype),t=this._target.apply(e,this._values),g(t)?t:e},y.prototype.array=function(){if(!s(this._target))throw new TypeError("Target is not a array");return c.apply(this._target,this._values),this._target},n(a,{isSymbol:{value:function(e){return e instanceof b&&function(e){return!0===e._isSymbol&&"number"==typeof e._id&&"string"==typeof e._description}(e)},writable:!0,configurable:!0},instanceOf:{value:function(e,t){if(!g(t))throw new TypeError("Right-hand side of 'instanceof' is not an object");var n=t[b.hasInstance];if(void 0===n)return e instanceof t;if("function"!=typeof n)throw new TypeError(typeof n+" is not a function");return n.call(t,e)},writable:!0,configurable:!0},forOf:{value:function(e,t,n){if(t="function"!=typeof t?u:t,"function"!=typeof e[b.iterator])throw new TypeError("Iterable[Symbol.iterator] is not a function");var r,o=e[b.iterator]();if("function"!=typeof o.next)throw new TypeError(".iterator.next is not a function");for(;;){if(r=o.next(),!g(r))throw new TypeError("Iterator result "+r+" is not an object");if(r.done)break;t.call(n,r.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(e,t){if("function"!=typeof e&&!s(e))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new y(e,t)},writable:!0,configurable:!0}}),t(e,"Symbol",{value:b,writable:!0,configurable:!0}),t(Function.prototype,b.hasInstance.toString(),{value:function(e){return"function"==typeof this&&e instanceof this}}),t(Array.prototype,"concat",{value:function(){if(void 0===this||null===this)throw new TypeError("Array.prototype.concat called on null or undefined");var e=Object(this),t=i.call(arguments),n=[];return t.unshift(e),t.forEach(function(e){g(e)?void 0!==e[b.isConcatSpreadable]?e[b.isConcatSpreadable]?_(n,e):n.push(e):s(e)?_(n,e):n.push(e):n.push(e)}),n},writable:!0,configurable:!0}),t(Object.prototype,"toString",{value:function(){return void 0===this||null===this?l.call(this):"string"==typeof this[b.toStringTag]?"[object "+this[b.toStringTag]+"]":l.call(this)},writable:!0,configurable:!0}),t(Array.prototype,b.iterator.toString(),{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new m(e,2)},writable:!0,configurable:!0}),t(Array,"from",{value:function(e,t,n){var r,o,i,s=0;if(r=f(this)?this:Array,void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");if(e=Object(e),void 0===t)t=d;else if(!f(t))throw new TypeError(t+" is not a function");if(void 0===e[b.iterator]){if(!("number"==typeof e.length&&e.length>=0))return(i=new r(0)).length=0,i;for(o=Math.floor(e.length),(i=new r(o)).length=o;o>s;++s)i[s]=t.call(n,e[s])}else(i=new r).length=0,a.forOf(e,function(e){i.length++,i[i.length-1]=t.call(n,e)});return i},writable:!0,configurable:!0}),t(Array.prototype,"entries",{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new m(e,1)},writable:!0,configurable:!0}),t(Array.prototype,"keys",{value:function(){if(void 0===this||null===this)throw new TypeError("Cannot convert undefined or null to object");var e=Object(this);return new m(e,3)},writable:!0,configurable:!0}),t(String.prototype,b.iterator.toString(),{value:function(){if(void 0===this||null===this)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new h(String(this),0)},writable:!0,configurable:!0}),a})})}),define("libs/polyfills/array-fill",[],function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1],o=r>>0,i=0>o?Math.max(n+o,0):Math.min(o,n),a=arguments[2],s=void 0===a?n:a>>0,l=0>s?Math.max(n+s,0):Math.min(s,n);l>i;)t[i]=e,i++;return t}})}),define("libs/polyfills/array-includes",[],function(){Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function n(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),o=r.length>>>0;if(0===o)return!1;for(var i=0|t,a=Math.max(i>=0?i:o-Math.abs(i),0);o>a;){if(n(r[a],e))return!0;a++}return!1}})}),angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function(e){return{compile:function(t,n){angular.isFunction(n)&&(n={post:n});var r,o=t.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(t,i){r||(r=e(o)),r(t,function(e){i.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}}}]),define("modules/recursionHelper",function(){});var app=angular.module("ErrorCatcher",[]),UNHANDLED_REJECTION_ERR_MSG="Possibly unhandled rejection: canceled";app.config(["$provide",function(e){return e.decorator("$exceptionHandler",["$log","$delegate",function(e,t){return function(e,n){return e!==UNHANDLED_REJECTION_ERR_MSG||void 0!==n?(null!=("undefined"!=typeof Raven&&null!==Raven?Raven.captureException:void 0)&&Raven.captureException(e),t(e,n)):void 0}}])}]),app.factory("unAuthHttpResponseInterceptor",["$q","$location",function(e,t){return{responseError:function(t){return[401,403].includes(t.status)&&!(null!=t.config?t.config.disableAutoLoginRedirect:void 0)&&(window.location.pathname.match(/^\/project/)?window.location="/login?redir=".concat(encodeURI(window.location.pathname)):window.location="/login"),e.reject(t)}}}]),app.config(["$httpProvider",function(e){return e.interceptors.push("unAuthHttpResponseInterceptor")}]),define("modules/errorCatcher",function(){}),angular.module("localStorage",[]).value("localStorage",function(){try{for(var e,t=arguments.length,n=new Array(t),r=0;t>r;r++)n[r]=arguments[r];return(e=$).localStorage.apply(e,_toConsumableArray(Array.from(n||[])))}catch(o){return console.error("localStorage exception",o),null}}),define("modules/localStorage",function(){}),define("utils/underscore",["libraries"],function(){return angular.module("underscore",[]).factory("_",function(){return window._})}),define("base",["libraries","libs/polyfills/symbol","libs/polyfills/array-fill","libs/polyfills/array-includes","modules/recursionHelper","modules/errorCatcher","modules/localStorage","utils/underscore"],function(){var e=angular.module("SharelatexApp",["ui.bootstrap","autocomplete","RecursionHelper","ng-context-menu","underscore","ngSanitize","ipCookie","ErrorCatcher","localStorage","ngTagsInput","ui.select"]).config(["$qProvider","$httpProvider","uiSelectConfig",function(e,t,n){return e.errorOnUnhandledRejections(!1),n.spinnerClass="fa fa-refresh ui-select-spin",__guard__("undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub:void 0,function(e){return e.Config({messageStyle:"none",imageFont:null,"HTML-CSS":{availableFonts:["TeX"],scale:110,matchFontHeight:!1},TeX:{equationNumbers:{autoNumber:"AMS"},useLabelIDs:!1},skipStartupTypeset:!0,tex2jax:{processEscapes:!0,inlineMath:[["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}})})}]);e.run(["$templateCache",function(e){return e.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="fa fa-times" aria-hidden="true"></i></a></span></div>')}]);var t=null!=__guard__(null!=window.location?window.location.search:void 0,function(e){return e.match(/debug=true/)}),n=null;return window.sl_debugging=t,window.sl_console={log:function(){if(t){var e;n=null;for(var r=arguments.length,o=new Array(r),i=0;r>i;i++)o[i]=arguments[i];return(e=console).log.apply(e,_toConsumableArray(Array.from(o||[])))}},logOnce:function(){for(var e=arguments.length,r=new Array(e),o=0;e>o;o++)r[o]=arguments[o];if(t&&r[0]!==n){var i;return n=r[0],(i=console).log.apply(i,_toConsumableArray(Array.from(r||[])))}}},e}),define("main/project-list/services/project-list",["base"],function(e){return e.service("ProjectListService",function(){return{getOwnerName:function(e){return"owner"===e.accessLevel?"You":null!=e.owner?this.getUserName(e.owner):"None"},getUserName:function(e){if(e&&e._id===window.user_id)return"You";if(e){var t=e.first_name,n=e.last_name,r=e.email;return t||n?[t,n].filter(function(e){return null!=e}).join(" "):r?r:"An Overleaf v1 User"}return"None"}}})}),define("main/project-list/project-list",["base","main/project-list/services/project-list"],function(e){e.controller("ProjectPageController",["$scope","$modal","$window","queuedHttp","event_tracking","$timeout","localStorage","ProjectListService",function(e,t,n,r,o,i,a,s){function l(t,n){var r=0,o=t.type,i=n.type;if("ownerName"!==e.predicate){if(o===i){var a=t.value,s=n.value;"string"===o?(a=a.toLowerCase(),s=s.toLowerCase()):"object"===o&&(angular.isObject(a)&&(a=t.index),angular.isObject(s)&&(s=n.index)),a!==s&&(r=s>a?-1:1)}else r=i>o?-1:1;return r}}function c(t,n){return"ownerName"===e.predicate?"You"===t.value?"You"===n.value&&t.index<n.index?-1:1:"An Overleaf v1 User"===t.value||"None"===t.value?"An Overleaf v1 User"===n.value||"None"===n.value?t.index<n.index?-1:1:-1:"You"===n.value?-1:"An Overleaf v1 User"===n.value||"None"===n.value?1:t.value>n.value?-1:1:void 0}e.projects=window.data.projects,e.tags=window.data.tags,e.notifications=window.data.notifications,e.allSelected=!1,e.selectedProjects=[],e.isArchiveableProjectSelected=!1,e.filter="all",e.predicate="lastUpdated",e.nUntagged=0,e.reverse=!0,e.searchText={value:""},e.$watch("predicate",function(t){e.comparator="ownerName"===t?c:l}),i(function(){return u()},10),e.$watch(function(){return e.projects.filter(function(e){return(null==e.tags||0===e.tags.length)&&!e.archived}).length},function(t){return e.nUntagged=t});var u=function(){var t=$(".project-list-card");if(t){var r=t.offset().top,o=t.outerHeight()-t.height(),i=$("footer").outerHeight(),a=n.innerHeight-r-i-o;e.projectListHeight=a}};angular.element(n).bind("resize",function(){u(),e.$apply()}),e.$on("project-list:notifications-received",function(){return e.$applyAsync(function(){return u()})});var d={},f=!0,p=!1,m=void 0;try{for(var h,g=e.projects[Symbol.iterator]();!(f=(h=g.next()).done);f=!0){var v=h.value;d[v.id]=v}}catch(_){p=!0,m=_}finally{try{f||null==g["return"]||g["return"]()}finally{if(p)throw m}}e.getProjectById=function(e){return d[e]};var q=!0,b=!1,y=void 0;try{for(var w,S=e.tags[Symbol.iterator]();!(q=(w=S.next()).done);q=!0){var C=w.value,x=!0,T=!1,k=void 0;try{for(var P,E=(C.project_ids||[])[Symbol.iterator]();!(x=(P=E.next()).done);x=!0){var I=P.value,F=d[I];F&&(F.tags||(F.tags=[]),F.tags.push(C))}}catch(_){T=!0,k=_}finally{try{x||null==E["return"]||E["return"]()}finally{if(T)throw k}}}}catch(_){b=!0,y=_}finally{try{q||null==S["return"]||S["return"]()}finally{if(b)throw y}}e.changePredicate=function(t){e.predicate===t&&(e.reverse=!e.reverse),e.predicate=t},e.getSortIconClass=function(t){return t===e.predicate&&e.reverse?"fa-caret-down":t!==e.predicate||e.reverse?"":"fa-caret-up"},e.searchProjects=function(){o.send("project-list-page-interaction","project-search","keydown"),e.updateVisibleProjects()},e.clearSearchText=function(){e.searchText.value="",e.filter="all",e.$emit("search:clear"),e.updateVisibleProjects()},e.setFilter=function(t){e.filter=t,e.updateVisibleProjects()},e.updateSelectedProjects=function(){e.selectedProjects=e.projects.filter(function(e){return e.selected}),e.isArchiveableProjectSelected=e.selectedProjects.some(function(e){return window.user_id===e.owner._id})},e.getSelectedProjects=function(){return e.selectedProjects},e.getSelectedProjectIds=function(){return e.selectedProjects.map(function(e){return e.id})},e.getFirstSelectedProject=function(){return e.selectedProjects[0]},e.updateVisibleProjects=function(){e.visibleProjects=[];var t=e.getSelectedTag(),n=!0,r=!1,o=void 0;try{for(var i,s=e.projects[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var l=i.value,c=!0;""!==e.searchText.value&&-1===l.name.toLowerCase().indexOf(e.searchText.value.toLowerCase())&&(c=!1),"tag"!==e.filter||null==t||t.project_ids.includes(l.id)||(c=!1),"untagged"===e.filter&&(null!=l.tags?l.tags.length:void 0)>0&&(c=!1),"shared"===e.filter&&"owner"===l.accessLevel&&(c=!1),"shared"===e.filter&&l.isV1Project&&(c=!1),"owned"===e.filter&&"owner"!==l.accessLevel&&(c=!1),"archived"===e.filter?l.archived||(c=!1):l.archived&&(c=!1),"v1"!==e.filter||l.isV1Project||(c=!1),c?e.visibleProjects.push(l):l.selected=!1}}catch(u){r=!0,o=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw o}}a("project_list",JSON.stringify({filter:e.filter,selectedTagId:null!=t?t._id:void 0})),e.updateSelectedProjects()},e.getSelectedTag=function(){var t=!0,n=!1,r=void 0;try{for(var o,i=e.tags[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(a.selected)return a}}catch(s){n=!0,r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return null},e._removeProjectIdsFromTagArray=function(e,t){var n=[],r=[],o=!0,i=!1,a=void 0;try{for(var s,l=e.project_ids[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;t.includes(c)?r.push(c):n.push(c)}}catch(u){i=!0,a=u}finally{try{o||null==l["return"]||l["return"]()}finally{if(i)throw a}}return e.project_ids=n,r},e._removeProjectFromList=function(t){var n=e.projects.indexOf(t);n>-1&&e.projects.splice(n,1)},e.removeSelectedProjectsFromTag=function(t){t.showWhenEmpty=!0;var n=e.getSelectedProjectIds(),o=e.getSelectedProjects(),i=e._removeProjectIdsFromTagArray(t,n),a=!0,s=!1,l=void 0;try{for(var c,u=o[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;d.tags||(d.tags=[]);var f=d.tags.indexOf(t);f>-1&&d.tags.splice(f,1)}}catch(p){s=!0,l=p}finally{try{a||null==u["return"]||u["return"]()}finally{if(s)throw l}}var m=!0,h=!1,g=void 0;try{for(var v,_=i[Symbol.iterator]();!(m=(v=_.next()).done);m=!0){var q=v.value;r({method:"DELETE",url:"/tag/".concat(t._id,"/project/").concat(q),headers:{"X-CSRF-Token":window.csrfToken}})}}catch(p){h=!0,g=p}finally{try{m||null==_["return"]||_["return"]()}finally{if(h)throw g}}e.updateVisibleProjects()},e.removeProjectFromTag=function(t,n){n.showWhenEmpty=!0,t.tags||(t.tags=[]);var o=t.tags.indexOf(n);o>-1&&(e._removeProjectIdsFromTagArray(n,[t.id]),t.tags.splice(o,1),r({method:"DELETE",url:"/tag/".concat(n._id,"/project/").concat(t.id),headers:{"X-CSRF-Token":window.csrfToken}}),e.updateVisibleProjects())},e.addSelectedProjectsToTag=function(t){var n=e.getSelectedProjects();o.send("project-list-page-interaction","project action","addSelectedProjectsToTag");var i=[],a=!0,s=!1,l=void 0;try{for(var c,u=e.getSelectedProjectIds()[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;t.project_ids.includes(d)||(t.project_ids.push(d),i.push(d))}}catch(f){s=!0,l=f}finally{try{a||null==u["return"]||u["return"]()}finally{if(s)throw l}}var p=!0,m=!1,h=void 0;try{for(var g,v=n[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var _=g.value;_.tags||(_.tags=[]),_.tags.includes(t)||_.tags.push(t)}}catch(f){m=!0,h=f}finally{try{p||null==v["return"]||v["return"]()}finally{if(m)throw h}}for(var q=0,b=i;q<b.length;q++){var y=b[q];r.post("/tag/".concat(t._id,"/project/").concat(y),{_csrf:window.csrfToken})}},e.openNewTagModal=function(n){var r=t.open({templateUrl:"newTagModalTemplate",controller:"NewTagModalController"});r.result.then(function(t){var n=e.tags.find(function(e){return t.name===e.name});n||(e.tags.push(t),e.addSelectedProjectsToTag(t))})},e.createProject=function(t,n){return null==n&&(n="none"),r.post("/project/new",{_csrf:window.csrfToken,projectName:t,template:n}).then(function(n){var r=n.data;e.projects.push({name:t,_id:r.project_id,accessLevel:"owner",owner:{_id:window.user_id}}),e.updateVisibleProjects()})},e.openCreateProjectModal=function(n){null==n&&(n="none"),o.send("project-list-page-interaction","new-project",n);var r=t.open({templateUrl:"newProjectModalTemplate",controller:"NewProjectModalController",resolve:{template:function(){return n}},scope:e});r.result.then(function(e){return window.location="/project/".concat(e)})},e.renameProject=function(e,t){return r.post("/project/".concat(e.id,"/rename"),{newProjectName:t,_csrf:window.csrfToken}).then(function(){return e.name=t})},e.openRenameProjectModal=function(){var n=e.getFirstSelectedProject();n&&"owner"===n.accessLevel&&(o.send("project-list-page-interaction","project action","Rename"),t.open({templateUrl:"renameProjectModalTemplate",controller:"RenameProjectModalController",resolve:{project:function(){return n}},scope:e}))},e.cloneProject=function(t,n){return o.send("project-list-page-interaction","project action","Clone"),r.post("/project/".concat(t.id,"/clone"),{_csrf:window.csrfToken,projectName:n}).then(function(t){var n=t.data;e.projects.push({name:n.name,id:n.project_id,accessLevel:"owner",owner:{_id:n.owner_ref}}),e.updateVisibleProjects()})},e.openCloneProjectModal=function(){var n=e.getFirstSelectedProject();n&&t.open({templateUrl:"cloneProjectModalTemplate",controller:"CloneProjectModalController",resolve:{project:function(){return n}},scope:e})},e.createArchiveProjectsModal=function(e){return t.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return e}}})},e.openArchiveProjectsModal=function(){var t=e.createArchiveProjectsModal(e.getSelectedProjects());o.send("project-list-page-interaction","project action","Delete"),t.result.then(function(){return e.archiveOrLeaveSelectedProjects()})},e.archiveOrLeaveSelectedProjects=function(){return e.archiveOrLeaveProjects(e.getSelectedProjects())},e.archiveOrLeaveProjects=function(t){var n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;e.archiveOrLeaveProject(s)}}catch(l){r=!0,o=l}finally{try{n||null==a["return"]||a["return"]()}finally{if(r)throw o}}e.updateVisibleProjects()},e.archiveOrLeaveProject=function(t){if("owner"===t.accessLevel)t.archived=!0,r({method:"DELETE",url:"/project/".concat(t.id),headers:{"X-CSRF-Token":window.csrfToken}});else{e._removeProjectFromList(t);var n=!0,o=!1,i=void 0;try{for(var a,s=(t.tags||[])[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;e._removeProjectIdsFromTagArray(l,[t._id])}}catch(c){o=!0,i=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(o)throw i}}r({method:"POST",url:"/project/".concat(t.id,"/leave"),headers:{"X-CSRF-Token":window.csrfToken}})}},e.getValueForCurrentPredicate=function(t){return"ownerName"===e.predicate?s.getOwnerName(t):t[e.predicate]},e.openDeleteProjectsModal=function(){var n=t.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return e.getSelectedProjects()}}});n.result.then(function(){return e.deleteSelectedProjects()})},e.deleteSelectedProjects=function(){var t=e.getSelectedProjects(),n=e.getSelectedProjectIds(),o=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;e._removeProjectFromList(c)}}catch(u){i=!0,a=u}finally{try{o||null==l["return"]||l["return"]()}finally{if(i)throw a}}var d=!0,f=!1,p=void 0;try{for(var m,h=e.tags[Symbol.iterator]();!(d=(m=h.next()).done);d=!0){var g=m.value;e._removeProjectIdsFromTagArray(g,n)}}catch(u){f=!0,p=u}finally{try{d||null==h["return"]||h["return"]()}finally{if(f)throw p}}var v=!0,_=!1,q=void 0;try{for(var b,y=n[Symbol.iterator]();!(v=(b=y.next()).done);v=!0){var w=b.value;r({method:"DELETE",url:"/project/".concat(w,"?forever=true"),headers:{"X-CSRF-Token":window.csrfToken}})}}catch(u){_=!0,q=u}finally{try{v||null==y["return"]||y["return"]()}finally{if(_)throw q}}e.updateVisibleProjects()},e.restoreSelectedProjects=function(){return e.restoreProjects(e.getSelectedProjects())},e.restoreProjects=function(t){var n=t.map(function(e){return e.id}),o=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;c.archived=!1}}catch(u){i=!0,a=u}finally{try{o||null==l["return"]||l["return"]()}finally{if(i)throw a}}var d=!0,f=!1,p=void 0;try{for(var m,h=n[Symbol.iterator]();!(d=(m=h.next()).done);d=!0){var g=m.value;r({method:"POST",url:"/project/".concat(g,"/restore"),headers:{"X-CSRF-Token":window.csrfToken}})}}catch(u){f=!0,p=u}finally{try{d||null==h["return"]||h["return"]()}finally{if(f)throw p}}e.updateVisibleProjects()},e.openUploadProjectModal=function(){t.open({templateUrl:"uploadProjectModalTemplate",controller:"UploadProjectModalController"})},e.downloadSelectedProjects=function(){return e.downloadProjectsById(e.getSelectedProjectIds())},e.downloadProjectsById=function(e){var t;return o.send("project-list-page-interaction","project action","Download Zip"),t=e.length>1?"/project/download/zip?project_ids=".concat(e.join(",")):"/project/".concat(e[0],"/download/zip"),window.location=t};var D=function(t){var n=!0,r=!1,o=void 0;try{for(var i,a=e.tags[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;s._id===t?s.selected=!0:s.selected=!1}}catch(l){r=!0,o=l}finally{try{n||null==a["return"]||a["return"]()}finally{if(r)throw o}}},M=JSON.parse(a("project_list"));M&&M.filter?("tag"===M.filter&&M.selectedTagId&&D(M.selectedTagId),e.setFilter(M.filter)):e.updateVisibleProjects()}]),e.controller("ProjectListItemController",["$scope","$modal","queuedHttp","ProjectListService",function(e,t,n,r){e.shouldDisableCheckbox=function(t){return"archived"===e.filter&&"owner"!==t.accessLevel},e.projectLink=function(e){return"readAndWrite"===e.accessLevel&&"token"===e.source?"/".concat(e.tokens.readAndWrite):"readOnly"===e.accessLevel&&"token"===e.source?"/read/".concat(e.tokens.readOnly):"/project/".concat(e.id)},e.isLinkSharingProject=function(e){return"token"===e.source},e.hasGenericOwnerName=function(){var t=e.project.owner,n=t.first_name,r=t.last_name,o=t.email;return!n&&!r&&!o},e.getOwnerName=r.getOwnerName,e.getUserName=r.getUserName,e.isOwner=function(){return e.project.owner&&window.user_id===e.project.owner._id},e.$watch("project.selected",function(t){null!=t&&e.updateSelectedProjects()}),e.clone=function(n){return n.stopPropagation(),e.project.isTableActionInflight=!0,e.cloneProject(e.project,"".concat(e.project.name," (Copy)")).then(function(){return e.project.isTableActionInflight=!1})["catch"](function(n){var r=n.data,o=n.status,i=400===o?{message:r}:!0;t.open({templateUrl:"showErrorModalTemplate",controller:"ShowErrorModalController",resolve:{error:function(){return i}}}),e.project.isTableActionInflight=!1})},e.download=function(t){t.stopPropagation(),e.downloadProjectsById([e.project.id])},e.archiveOrLeave=function(t){t.stopPropagation(),e.createArchiveProjectsModal([e.project]).result.then(function(){e.archiveOrLeaveProject(e.project),e.updateVisibleProjects()})},e.restore=function(t){t.stopPropagation(),e.restoreProjects([e.project])},e.deleteProject=function(r){r.stopPropagation();var o=t.open({templateUrl:"deleteProjectsModalTemplate",controller:"DeleteProjectsModalController",resolve:{projects:function(){return[e.project]}}});o.result.then(function(){return e.project.isTableActionInflight=!0,n({method:"DELETE",url:"/project/".concat(e.project.id,"?forever=true"),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){
e.project.isTableActionInflight=!1,e._removeProjectFromList(e.project);var t=!0,n=!1,r=void 0;try{for(var o,i=e.tags[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;e._removeProjectIdsFromTagArray(a,[e.project.id])}}catch(s){n=!0,r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}e.updateVisibleProjects()})["catch"](function(){return e.project.isTableActionInflight=!1})})}}])}),define("main/project-list/modal-controllers",["base"],function(e){return e.controller("RenameProjectModalController",["$scope","$modalInstance","$timeout","project","queuedHttp",function(e,t,n,r,o){return e.inputs={projectName:r.name},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)}),e.rename=function(){return e.state.inflight=!0,e.state.error=!1,e.renameProject(r,e.inputs.projectName).then(function(){return e.state.inflight=!1,e.state.error=!1,t.close()})["catch"](function(t){var n=t.data,r=t.status;return e.state.inflight=!1,400===r?e.state.error={message:n}:e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("CloneProjectModalController",["$scope","$modalInstance","$timeout","project",function(e,t,n,r){return e.inputs={projectName:r.name+" (Copy)"},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)}),e.clone=function(){return e.state.inflight=!0,e.cloneProject(r,e.inputs.projectName).then(function(){return e.state.inflight=!1,e.state.error=!1,t.close()})["catch"](function(t){var n=t.data,r=t.status;return e.state.inflight=!1,400===r?e.state.error={message:n}:e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("NewProjectModalController",["$scope","$modalInstance","$timeout","template",function(e,t,n,r){return e.inputs={projectName:""},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)}),e.create=function(){return e.state.inflight=!0,e.state.error=!1,e.createProject(e.inputs.projectName,r).then(function(n){var r=n.data;return e.state.inflight=!1,e.state.error=!1,t.close(r.project_id)})["catch"](function(t){var n=t.data,r=t.status;return e.state.inflight=!1,400===r?e.state.error={message:n}:e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("DeleteProjectsModalController",["$scope","$modalInstance","$timeout","projects",function(e,t,n,r){return e.projectsToDelete=r.filter(function(e){return"owner"===e.accessLevel}),e.projectsToLeave=r.filter(function(e){return"owner"!==e.accessLevel}),e.projectsToArchive=r.filter(function(e){return"owner"===e.accessLevel&&!e.archived}),e.projectsToLeave.length>0&&e.projectsToDelete.length>0?e.projectsToArchive.length>0&&window.ExposedSettings.isOverleaf?e.action="archive-and-leave":e.action="delete-and-leave":0===e.projectsToLeave.length&&e.projectsToDelete.length>0?e.projectsToArchive.length>0&&window.ExposedSettings.isOverleaf?e.action="archive":e.action="delete":e.action="leave",e["delete"]=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("UploadProjectModalController",["$scope","$modalInstance","$timeout",function(e,t,n){return e.cancel=function(){return t.dismiss("cancel")},e.onComplete=function(e,t,n){return null!=n.project_id?window.location="/project/".concat(n.project_id):void 0}}]),e.controller("V1ImportModalController",["$scope","$modalInstance","project",function(e,t,n){return e.project=n,e.dismiss=function(){return t.dismiss("cancel")}}]),e.controller("ShowErrorModalController",["$scope","$modalInstance","error",function(e,t,n){return e.error=n,e.cancel=function(){return t.dismiss("cancel")}}])}),define("ide/colors/ColorManager",[],function(){var e;return e={getColorScheme:function(e,t){return this.isDarkTheme(t)?{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 100%, 28%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 100%, 20%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 100%, 60%);")}:{cursor:"hsl(".concat(e,", 70%, 50%)"),labelBackgroundColor:"hsl(".concat(e,", 70%, 50%)"),highlightBackgroundColor:"hsl(".concat(e,", 70%, 85%);"),strikeThroughBackgroundColor:"hsl(".concat(e,", 70%, 95%);"),strikeThroughForegroundColor:"hsl(".concat(e,", 70%, 40%);")}},isDarkTheme:function(e){var t=e.find(".ace_editor").css("background-color"),n=Array.from(t.match(/rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)/)),r=_slicedToArray(n,4),o=(r[0],r[1]),i=r[2],a=r[3];return o=parseInt(o,10),i=parseInt(i,10),a=parseInt(a,10),384>o+i+a},OWN_HUE:200,ANONYMOUS_HUE:100,getHueForUserId:function(e){return null==e||"anonymous-user"===e?this.ANONYMOUS_HUE:window.user.id===e?this.OWN_HUE:(hue=this.getHueForId(e),hue>this.OWNER_HUE-20&&(hue+=40),hue)},getHueForTagId:function(e){return this.getHueForId(e)},getHueForId:function(e){var t=CryptoJS.MD5(e),n=parseInt(t.toString().slice(0,8),16)%320;return n}}}),define("main/project-list/tag-controllers",["base","ide/colors/ColorManager"],function(e,t){return e.controller("TagListController",["$scope","$modal",function(e,n){e.filterProjects=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";e._clearTags(),e.setFilter(t)},e._clearTags=function(){return e.tags.forEach(function(e){e.selected=!1})},e.selectTag=function(t){e._clearTags(),t.selected=!0,e.setFilter("tag")},e.selectUntagged=function(){e._clearTags(),e.setFilter("untagged")},e.countProjectsForTag=function(t){return t.project_ids.reduce(function(t,n){var r=e.getProjectById(n);return r?r.archived?t:t+1:t},0)},e.getHueForTagId=function(e){return t.getHueForTagId(e)},e.deleteTag=function(t){var r=n.open({templateUrl:"deleteTagModalTemplate",controller:"DeleteTagModalController",resolve:{tag:function(){return t}}});r.result.then(function(){var n=!0,r=!1,o=void 0;try{for(var i,a=e.projects[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;s.tags||(s.tags=[]);var l=s.tags.indexOf(t);l>-1&&s.tags.splice(l,1)}}catch(c){r=!0,o=c}finally{try{n||null==a["return"]||a["return"]()}finally{if(r)throw o}}e.tags=e.tags.filter(function(e){return e!==t})})},e.renameTag=function(e){var t=n.open({templateUrl:"renameTagModalTemplate",controller:"RenameTagModalController",resolve:{tag:function(){return e}}});t.result.then(function(t){return e.name=t})}}]),e.controller("TagDropdownItemController",["$scope",function(e){e.recalculateProjectsInTag=function(){var t;e.areSelectedProjectsInTag=!1;var n=!0,r=!1,o=void 0;try{for(var i,a=e.getSelectedProjectIds()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;e.tag.project_ids.includes(s)?e.areSelectedProjectsInTag=!0:t=!0}}catch(l){r=!0,o=l}finally{try{n||null==a["return"]||a["return"]()}finally{if(r)throw o}}e.areSelectedProjectsInTag&&t&&(e.areSelectedProjectsInTag="partial")},e.addOrRemoveProjectsFromTag=function(){e.areSelectedProjectsInTag===!0?(e.removeSelectedProjectsFromTag(e.tag),e.areSelectedProjectsInTag=!1):(e.areSelectedProjectsInTag===!1||"partial"===e.areSelectedProjectsInTag)&&(e.addSelectedProjectsToTag(e.tag),e.areSelectedProjectsInTag=!0)},e.$watch("selectedProjects",function(){return e.recalculateProjectsInTag()}),e.recalculateProjectsInTag()}]),e.controller("NewTagModalController",["$scope","$modalInstance","$timeout","$http",function(e,t,n,r){e.inputs={newTagName:""},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)}),e.create=function(){var n=e.inputs.newTagName;e.state.inflight=!0,e.state.error=!1,r.post("/tag",{_csrf:window.csrfToken,name:n}).then(function(n){var r=n.data;e.state.inflight=!1,t.close(r)})["catch"](function(){e.state.inflight=!1,e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("RenameTagModalController",["$scope","$modalInstance","$timeout","$http","tag",function(e,t,n,r,o){e.inputs={tagName:o.name},e.state={inflight:!1,error:!1},t.opened.then(function(){return n(function(){return e.$broadcast("open")},200)}),e.rename=function(){var n=e.inputs.tagName;return e.state.inflight=!0,e.state.error=!1,r.post("/tag/".concat(o._id,"/rename"),{_csrf:window.csrfToken,name:n}).then(function(){e.state.inflight=!1,t.close(n)})["catch"](function(){e.state.inflight=!1,e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("DeleteTagModalController",["$scope","$modalInstance","$http","tag",function(e,t,n,r){e.tag=r,e.state={inflight:!1,error:!1},e["delete"]=function(){return e.state.inflight=!0,e.state.error=!1,n({method:"DELETE",url:"/tag/".concat(r._id),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){e.state.inflight=!1,t.close()})["catch"](function(){e.state.inflight=!1,e.state.error=!0})},e.cancel=function(){return t.dismiss("cancel")}}])}),define("main/project-list/notifications-controller",["base"],function(e){return e.controller("NotificationsController",["$scope","$http",function(e,t){for(var n=0,r=Array.from(e.notifications);n<r.length;n++){var o=r[n];o.hide=!1}return e.dismiss=function(e){return t({url:"/notifications/".concat(e._id),method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}}).then(function(){return e.hide=!0})}}]),e.controller("ProjectInviteNotificationController",["$scope","$http",function(e,t){return e.projectName=e.notification.messageOpts.projectName,e.userName=e.notification.messageOpts.userName,e.accept=function(){return e.notification.inflight=!0,t({url:"/project/".concat(e.notification.messageOpts.projectId,"/invite/token/").concat(e.notification.messageOpts.token,"/accept"),method:"POST",headers:{"X-Csrf-Token":window.csrfToken,"X-Requested-With":"XMLHttpRequest"}}).then(function(){e.notification.accepted=!0})["catch"](function(t){var n=t.status;404===n?e.notification.accepted=!0:e.notification.error=!0})["finally"](function(){e.notification.inflight=!1})}}]),e.controller("OverleafV2NotificationController",["$scope","localStorage",function(e,t){return e.visible=!t("overleaf_v2_2_notification_hidden_at"),e.dismiss=function(){return e.visible=!1,t("overleaf_v2_2_notification_hidden_at",Date.now())}}]),e.controller("OverleafV1NotificationController",["$scope","localStorage",function(e,t){return e.visible=!t("overleaf_v1_notification_hidden_at"),e.toggle=function(){return e.visible=!e.visible,e.visible?t("overleaf_v1_notification_hidden_at",null):t("overleaf_v1_notification_hidden_at",Date.now())}}]),e.controller("EmailNotificationController",["$scope","$http","UserAffiliationsDataService",function(e,t,n){e.userEmails=[];for(var r=0,o=Array.from(e.userEmails);r<o.length;r++){var i=o[r];i.hide=!1}var a=function(){return n.getUserEmails().then(function(t){return e.userEmails=t,e.$emit("project-list:notifications-received")})};return a(),e.resendConfirmationEmail=function(t){return t.confirmationInflight=!0,n.resendConfirmationEmail(t.email).then(function(){return t.hide=!0,t.confirmationInflight=!1,e.$emit("project-list:notifications-received")})}}])}),define("main/project-list/left-hand-menu-promo-controller",["base"],function(e){return e.controller("LeftHandMenuPromoController",["$scope","UserAffiliationsDataService",function(e,t){e.hasProjects=window.data.projects.length>0,e.userHasNoSubscription=window.userHasNoSubscription;var n=function(){return e.userEmails=[],e.userAffiliations=[],t.getUserEmails().then(function(t){e.userEmails=t,e.userAffiliations=t.filter(function(e){return e.affiliation}).map(function(e){return e.affiliation}),e.userOnPayingUniversity=e.userAffiliations.some(function(e){return"free"!==e.institution.licence})})};n()}])}),define("services/queued-http",["base"],function(e){return e.factory("queuedHttp",["$http","$q",function(e,t){var n=[],r=!1,o=function a(){if(!r){var e=n.shift();return null!=e?(r=!0,e().then(function(){return r=!1,a()})["catch"](function(){return r=!1,a()})):void 0}},i=function(){for(var t=arguments.length,r=new Array(t),i=0;t>i;i++)r[i]=arguments[i];var a={},s=[],l=[];a.then=function(e,t){return s.push(e),null!=t&&l.push(t),a},a["catch"]=function(e){return l.push(e),a};var c=function(){return e.apply(void 0,_toConsumableArray(Array.from(r||[]))).then(function(){for(var e=arguments.length,t=new Array(e),n=0;e>n;n++)t[n]=arguments[n];return Array.from(s).map(function(e){return e.apply(void 0,_toConsumableArray(Array.from(t||[])))})})["catch"](function(){for(var e=arguments.length,t=new Array(e),n=0;e>n;n++)t[n]=arguments[n];return Array.from(l).map(function(e){return e.apply(void 0,_toConsumableArray(Array.from(t||[])))})})};return n.push(c),o(),a};return i.post=function(e,t){return i({method:"POST",url:e,data:t})},i}])}),define("main/project-list/index",["main/project-list/project-list","main/project-list/modal-controllers","main/project-list/tag-controllers","main/project-list/notifications-controller","main/project-list/left-hand-menu-promo-controller","services/queued-http"],function(){}),define("main/user-details",["base","libs/algolia-2.5.2"],function(e,t){return e.factory("Institutions",function(){return new AlgoliaSearch(window.algolia.institutions.app_id,window.algolia.institutions.api_key).initIndex("institutions")}),e.controller("UserProfileController",["$scope","$modal","$http",function(e,t,n){return e.institutions=[],n.get("/user/personal_info").then(function(t){var n=t.data;return e.userInfoForm={first_name:n.first_name||"",last_name:n.last_name||"",role:n.role||"",institution:n.institution||"",_csrf:window.csrfToken}}),e.showForm=function(){return GrooveWidget.toggle(),e.formVisable=!0},e.getPercentComplete=function(){var t=_.filter(e.userInfoForm,function(e){return null==e||0!==(null!=e?e.length:void 0)});return 20*t.length},e.$watch("userInfoForm",function(t){return null!=t?e.percentComplete=e.getPercentComplete():void 0},!0),e.openUserProfileModal=function(){return t.open({templateUrl:"userProfileModalTemplate",controller:"UserProfileModalController",scope:e})}}]),e.controller("UserProfileModalController",["$scope","$modalInstance","$http","Institutions",function(e,t,n,r){e.roles=["Student","Post-graduate student","Post-doctoral researcher","Lecturer","Professor"],t.result["finally"](function(){return o()});var o=function(){var t=n.post("/user/settings",e.userInfoForm);return t.then(function(){}),t["catch"](function(){return console.log("the request failed")})};return e.updateInstitutionsList=function(t){var n=e.userInfoForm.institution;if(!((null!=n?n.length:void 0)<=3))return r.search(e.userInfoForm.institution,function(t,n){return e.institutions=_.map(n.hits,function(e){return"".concat(e.name," (").concat(e.domain,")")})})},e.done=function(){return t.close()}}])}),define("main/account-settings",["base"],function(e){e.controller("AccountSettingsController",["$scope","$http","$modal","event_tracking","UserAffiliationsDataService",function(e,t,n,r,o){e.subscribed=!0,e.unsubscribe=function(){return e.unsubscribing=!0,t({method:"DELETE",url:"/user/newsletter/unsubscribe",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){e.unsubscribing=!1,e.subscribed=!1})["catch"](function(){return e.unsubscribing=!0})},e.deleteAccount=function(){n.open({templateUrl:"deleteAccountModalTemplate",controller:"DeleteAccountModalController",resolve:{userDefaultEmail:function(){return o.getUserDefaultEmail().then(function(e){return(null!=e?e.email:void 0)||null})["catch"](function(){return null})}}})},e.upgradeIntegration=function(e){return r.send("subscription-funnel","settings-page",e)}}]),e.controller("DeleteAccountModalController",["$scope","$modalInstance","$timeout","$http","userDefaultEmail",function(e,t,n,r,o){e.state={isValid:!1,deleteText:"",password:"",confirmV1Purge:!1,confirmSharelatexDelete:!1,inflight:!1,error:null},e.userDefaultEmail=o,t.opened.then(function(){return n(function(){return e.$broadcast("open")},700)}),e.checkValidation=function(){return e.state.isValid=null!=o&&e.state.deleteText.toLowerCase()===o.toLowerCase()&&e.state.password.length>0&&e.state.confirmV1Purge&&e.state.confirmSharelatexDelete},e["delete"]=function(){return e.state.inflight=!0,e.state.error=null,r({method:"POST",url:"/user/delete",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json"},data:{password:e.state.password},disableAutoLoginRedirect:!0}).then(function(){t.close(),e.state.inflight=!1,e.state.error=null,setTimeout(function(){return window.location="/login"},1e3)})["catch"](function(t){var n=t.data,r=t.status;e.state.inflight=!1,403===r?e.state.error={code:"InvalidCredentialsError"}:n.error?e.state.error={code:n.error}:e.state.error={code:"UserDeletionError"}})},e.cancel=function(){return t.dismiss("cancel")}}])}),define("main/clear-sessions",["base"],function(e){return e.controller("ClearSessionsController",["$scope","$http",function(e,t){return e.state={otherSessions:window.otherSessions,error:!1,success:!1},e.clearSessions=function(){return console.log(">> clearing all sessions"),t({method:"POST",url:"/user/sessions/clear",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return e.state.otherSessions=[],e.state.error=!1,e.state.success=!0})["catch"](function(){return e.state.error=!0})}}])}),define("main/account-upgrade",["base"],function(e){return e.controller("FreeTrialModalController",["$scope","event_tracking",function(e,t){return e.buttonClass="btn-primary",e.startFreeTrial=function(n,r){var o="collaborator_free_trial_7_days",i=window.open(),a=function(){var a;return"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",n),window.useV2TrialUrl?a="/user/trial":(a="/user/subscription/new?planCode=".concat(o,"&ssp=true"),null!=r&&(a="".concat(a,"&cc=").concat(r))),e.startedFreeTrial=!0,t.sendMB("subscription-start-trial",{source:n,plan:o}),i.location=a};return a()}}])}),define("main/plans",["base"],function(e){e.factory("MultiCurrencyPricing",function(){var e=window.recomendedCurrency;return{currencyCode:e,plans:{USD:{symbol:"$",student:{monthly:"$8",annual:"$80"},collaborator:{monthly:"$15",annual:"$180"},professional:{monthly:"$30",annual:"$360"}},EUR:{symbol:"€",student:{monthly:"€7",annual:"€70"},collaborator:{monthly:"€14",annual:"€168"},professional:{monthly:"€28",annual:"€336"}},GBP:{symbol:"£",student:{monthly:"£6",annual:"£60"},collaborator:{monthly:"£12",annual:"£144"},professional:{monthly:"£24",annual:"£288"}},SEK:{symbol:"kr",student:{monthly:"60 kr",annual:"600 kr"},collaborator:{monthly:"110 kr",annual:"1320 kr"},professional:{monthly:"220 kr",annual:"2640 kr"}},CAD:{symbol:"$",student:{monthly:"$9",annual:"$90"},collaborator:{monthly:"$17",annual:"$204"},professional:{monthly:"$34",annual:"$408"}},NOK:{symbol:"kr",student:{monthly:"60 kr",annual:"600 kr"},collaborator:{monthly:"110 kr",annual:"1320 kr"},professional:{monthly:"220 kr",annual:"2640 kr"}},DKK:{symbol:"kr",student:{monthly:"50 kr",annual:"500 kr"},collaborator:{monthly:"90 kr",annual:"1080 kr"},professional:{monthly:"180 kr",annual:"2160 kr"}},AUD:{symbol:"$",student:{monthly:"$10",annual:"$100"},collaborator:{monthly:"$18",annual:"$216"},professional:{monthly:"$35",annual:"$420"}},NZD:{symbol:"$",student:{monthly:"$10",annual:"$100"},collaborator:{monthly:"$18",annual:"$216"},professional:{monthly:"$35",annual:"$420"}},CHF:{symbol:"Fr",student:{monthly:"Fr 8",annual:"Fr 80"},collaborator:{monthly:"Fr 15",annual:"Fr 180"},professional:{monthly:"Fr 30",annual:"Fr 360"}},SGD:{symbol:"$",student:{monthly:"$12",annual:"$120"},collaborator:{monthly:"$20",annual:"$240"},professional:{monthly:"$40",annual:"$480"}}}}}),e.controller("PlansController",["$scope","$modal","event_tracking","MultiCurrencyPricing","$http","$filter","ipCookie","$location",function(e,t,n,r,o,i,a,s){var l;e.showPlans=!0,e.plans=r.plans,e.currencyCode=r.currencyCode,e.trial_len=7,e.planQueryString="_free_trial_7_days",e.ui={view:"monthly"},e.changeCurreny=function(t,n){t.preventDefault(),e.currencyCode=n},e.getCollaboratorPlanCode=function(){var t=e.ui.view;return"annual"===t?"collaborator-annual":"collaborator".concat(e.planQueryString)},e.signUpNowClicked=function(t,r){"annual"===e.ui.view&&(t="".concat(t,"_annual")),t=c(t,r),n.sendMB("plans-page-start-trial"),n.send("subscription-funnel","sign_up_now_button",t)},e.switchToMonthly=function(t,n){var r="monthly";l(t,r+"-prices",n),e.ui.view=r},e.switchToStudent=function(t,n){var r="student";l(t,r+"-prices",n),e.ui.view=r},e.switchToAnnual=function(t,n){var r="annual";l(t,r+"-prices",n),e.ui.view=r},e.openGroupPlanModal=function(){var e="".concat(window.location.pathname).concat(window.location.search);history.replaceState(null,document.title,e+"#groups"),t.open({templateUrl:"groupPlanModalPurchaseTemplate",controller:"GroupPlansModalPurchaseController"}).result["finally"](function(){return history.replaceState(null,document.title,window.location.pathname)}),n.send("subscription-funnel","plans-page","group-inquiry-potential")},"groups"===s.hash()&&e.openGroupPlanModal();var c=function(e,t){return e};l=function(e,t,r){e.preventDefault();var o=c(t,r);n.send("subscription-funnel","plans-page",o)}}]),e.controller("GroupPlansModalPurchaseController",["$scope","$modal","$location",function(e,t,n){e.options={plan_codes:[{display:"Collaborator",code:"collaborator"},{display:"Professional",code:"professional"}],currencies:[{display:"USD ($)",code:"USD"},{display:"GBP (£)",code:"GBP"},{display:"EUR (€)",code:"EUR"}],currencySymbols:{USD:"$",EUR:"€",GBP:"£"},sizes:[2,3,4,5,10,20,50],usages:[{display:"Enterprise",code:"enterprise"},{display:"Educational",code:"educational"}]},e.prices=window.groupPlans;var r="USD";if(["USD","GBP","EUR"].includes(window.recomendedCurrency)&&(r=window.recomendedCurrency),e.selected={plan_code:"collaborator",currency:r,size:"10",usage:"educational"},n.search()){if(n.search().usage&&e.options.usages.forEach(function(t){t.code===n.search().usage&&(e.selected.usage=t.code)}),n.search().plan&&e.options.plan_codes.forEach(function(t){t.code===n.search().plan&&(e.selected.plan_code=t.code)}),n.search().number){var o=parseInt(n.search().number,10);-1!==e.options.sizes.indexOf(o)&&(e.selected.size=n.search().number)}n.search().currency&&e.options.currencies.forEach(function(t){t.code===n.search().currency&&(e.selected.currency=t.code)})}e.recalculatePrice=function(){var t=e.selected,n=t.usage,r=t.plan_code,o=t.currency,i=t.size,a=e.prices[n][r][o][i],s=e.options.currencySymbols[o];e.displayPrice="".concat(s).concat(a)},e.$watch("selected",e.recalculatePrice,!0),e.recalculatePrice(),e.purchase=function(){var t=e.selected,n=t.plan_code,r=t.size,o=t.usage,i=t.currency;n="group_".concat(n,"_").concat(r,"_").concat(o),window.location="/user/subscription/new?planCode=".concat(n,"&currency=").concat(i)},e.payByInvoice=function(){t.open({templateUrl:"groupPlanModalInquiryTemplate"}),e.$close()}}])}),define("main/user-membership",["base"],function(e){return e.controller("UserMembershipController",["$scope","queuedHttp",function(e,t){e.users=window.users,e.groupSize=window.groupSize,e.paths=window.paths,e.selectedUsers=[],e.inputs={addMembers:{content:"",error:!1,errorMessage:null},removeMembers:{error:!1,errorMessage:null}};var n=function(e){var t=/[\s,]+/,n=e.split(t);return n=_.map(n,function(e){return e=e.trim()}),n=_.select(n,function(e){return-1!==e.indexOf("@")})};return e.addMembers=function(){e.inputs.addMembers.error=!1,e.inputs.addMembers.errorMessage=null;var r=n(e.inputs.addMembers.content);return Array.from(r).map(function(n){return t.post(paths.addMember,{email:n,_csrf:window.csrfToken}).then(function(t){var n=t.data;return null!=n.user&&e.users.push(n.user),e.inputs.addMembers.content=""})["catch"](function(t){var n=t.data;return e.inputs.addMembers.error=!0,e.inputs.addMembers.errorMessage=null!=n.error?n.error.message:void 0})})},e.removeMembers=function(){e.inputs.removeMembers.error=!1,e.inputs.removeMembers.errorMessage=null;for(var n=0,r=Array.from(e.selectedUsers);n<r.length;n++){var o=r[n];!function(n){var r;if(paths.removeInvite&&n.invite&&null==n._id)r="".concat(paths.removeInvite,"/").concat(encodeURIComponent(n.email));else{if(!paths.removeMember||null==n._id)return;r="".concat(paths.removeMember,"/").concat(n._id)}return t({method:"DELETE",url:r,headers:{"X-Csrf-Token":window.csrfToken}}).then(function(){var t=e.users.indexOf(n);if(-1!==t)return e.users.splice(t,1)})["catch"](function(t){var n=t.data;return e.inputs.removeMembers.error=!0,e.inputs.removeMembers.errorMessage=null!=n.error?n.error.message:void 0})}(o)}return e.updateSelectedUsers},e.updateSelectedUsers=function(){return e.selectedUsers=e.users.filter(function(e){return e.selected})}}]),e.controller("UserMembershipListItemController",["$scope",function(e){return e.$watch("user.selected",function(t){return null!=t?e.updateSelectedUsers():void 0})}])}),define("main/scribtex-popup",["base"],function(e){return e.controller("ScribtexPopupController",["$scope","$modal",function(e,t){return t.open({templateUrl:"scribtexModalTemplate"})}])}),function(e){function t(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function n(e,t){return ke.call(e,t)}function r(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function o(e){ye.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function i(e,t){var n=!0;return m(function(){return n&&(o(e),n=!1),t.apply(this,arguments)},t)}function a(e,t){_t[e]||(o(t),_t[e]=!0)}function s(e,t){return function(n){return v(e.call(this,n),t)}}function l(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function c(e,t){var n,r,o=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(o,"months");return 0>t-i?(n=e.clone().add(o-1,"months"),r=(t-i)/(i-n)):(n=e.clone().add(o+1,"months"),r=(t-i)/(n-i)),-(o+r)}function u(e,t,n){var r;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(r=e.isPM(n),r&&12>t&&(t+=12),r||12!==t||(t=0),t):t}function d(){}function f(e,t){t!==!1&&M(e),h(this,e),this._d=new Date(+e._d),bt===!1&&(bt=!0,ye.updateOffset(this),bt=!1)}function p(e){var t=T(e),n=t.year||0,r=t.quarter||0,o=t.month||0,i=t.week||0,a=t.day||0,s=t.hour||0,l=t.minute||0,c=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*c+6e4*l+36e5*s,this._days=+a+7*i,this._months=+o+3*r+12*n,this._data={},this._locale=ye.localeData(),this._bubble()}function m(e,t){for(var r in t)n(t,r)&&(e[r]=t[r]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t){var n,r,o;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),je.length>0)for(n in je)r=je[n],o=t[r],"undefined"!=typeof o&&(e[r]=o);return e}function g(e){return 0>e?Math.ceil(e):Math.floor(e)}function v(e,t,n){for(var r=""+Math.abs(e),o=e>=0;r.length<t;)r="0"+r;return(o?n?"+":"":"-")+r}function _(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function q(e,t){var n;return t=R(t,e),e.isBefore(t)?n=_(e,t):(n=_(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function b(e,t){return function(n,r){var o,i;return null===r||isNaN(+r)||(a(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),i=n,n=r,r=i),n="string"==typeof n?+n:n,o=ye.duration(n,r),y(this,o,e),this}}function y(e,t,n,r){var o=t._milliseconds,i=t._days,a=t._months;r=null==r?!0:r,o&&e._d.setTime(+e._d+o*n),i&&he(e,"Date",me(e,"Date")+i*n),a&&pe(e,me(e,"Month")+a*n),r&&ye.updateOffset(e,i||a)}function w(e){return"[object Array]"===Object.prototype.toString.call(e)}function S(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function C(e,t,n){var r,o=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),a=0;for(r=0;o>r;r++)(n&&e[r]!==t[r]||!n&&P(e[r])!==P(t[r]))&&a++;return a+i}function x(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=dt[e]||ft[t]||t}return e}function T(e){var t,r,o={};for(r in e)n(e,r)&&(t=x(r),t&&(o[t]=e[r]));return o}function k(t){var n,r;if(0===t.indexOf("week"))n=7,r="day";else{if(0!==t.indexOf("month"))return;n=12,r="month"}ye[t]=function(o,i){var a,s,l=ye._locale[t],c=[];if("number"==typeof o&&(i=o,o=e),s=function(e){var t=ye().utc().set(r,e);return l.call(ye._locale,t,o||"")},null!=i)return s(i);for(a=0;n>a;a++)c.push(s(a));return c}}function P(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function E(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function I(e,t,n){return ce(ye([e,11,31+t-n]),t,n).week}function F(e){return D(e)?366:365}function D(e){return e%4===0&&e%100!==0||e%400===0}function M(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ee]<0||e._a[Ee]>11?Ee:e._a[Ie]<1||e._a[Ie]>E(e._a[Pe],e._a[Ee])?Ie:e._a[Fe]<0||e._a[Fe]>24||24===e._a[Fe]&&(0!==e._a[De]||0!==e._a[Me]||0!==e._a[Ae])?Fe:e._a[De]<0||e._a[De]>59?De:e._a[Me]<0||e._a[Me]>59?Me:e._a[Ae]<0||e._a[Ae]>999?Ae:-1,e._pf._overflowDayOfYear&&(Pe>t||t>Ie)&&(t=Ie),e._pf.overflow=t)}function A(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===e)),t._isValid}function U(e){return e?e.toLowerCase().replace("_","-"):e}function j(e){for(var t,n,r,o,i=0;i<e.length;){for(o=U(e[i]).split("-"),t=o.length,n=U(e[i+1]),n=n?n.split("-"):null;t>0;){if(r=O(o.slice(0,t).join("-")))return r;if(n&&n.length>=t&&C(o,n,!0)>=t-1)break;t--}i++}return null}function O(e){var t=null;if(!Ue[e]&&Oe)try{t=ye.locale(),require("./locale/"+e),ye.locale(t)}catch(n){}return Ue[e]}function R(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(ye.isMoment(e)||S(e)?+e:+ye(e))-+n,n._d.setTime(+n._d+r),ye.updateOffset(n,!1),n):ye(e).local()}function $(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function B(e){var t,n,r=e.match(Ne);for(t=0,n=r.length;n>t;t++)r[t]=vt[r[t]]?vt[r[t]]:$(r[t]);return function(o){var i="";for(t=0;n>t;t++)i+=r[t]instanceof Function?r[t].call(o,e):r[t];return i}}function N(e,t){return e.isValid()?(t=L(t,e.localeData()),pt[t]||(pt[t]=B(t)),pt[t](e)):e.localeData().invalidDate()}function L(e,t){function n(e){return t.longDateFormat(e)||e}var r=5;for(Le.lastIndex=0;r>=0&&Le.test(e);)e=e.replace(Le,n),Le.lastIndex=0,r-=1;return e}function H(e,t){var n,r=t._strict;switch(e){case"Q":return Qe;case"DDDD":return tt;case"YYYY":case"GGGG":case"gggg":return r?nt:Ge;case"Y":case"G":case"g":return ot;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?rt:We;case"S":if(r)return Qe;case"SS":if(r)return et;case"SSS":if(r)return tt;case"DDD":return ze;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ve;case"a":case"A":return t._locale._meridiemParse;case"x":return Ke;case"X":return Ze;case"Z":case"ZZ":return Xe;case"T":return Je;case"SSSS":return Ye;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?et:He;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return He;case"Do":return r?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(Z(K(e.replace("\\","")),"i"))}}function z(e){e=e||"";var t=e.match(Xe)||[],n=t[t.length-1]||[],r=(n+"").match(ct)||["-",0,0],o=+(60*r[1])+P(r[2]);
return"+"===r[0]?o:-o}function G(e,t,n){var r,o=n._a;switch(e){case"Q":null!=t&&(o[Ee]=3*(P(t)-1));break;case"M":case"MM":null!=t&&(o[Ee]=P(t)-1);break;case"MMM":case"MMMM":r=n._locale.monthsParse(t,e,n._strict),null!=r?o[Ee]=r:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[Ie]=P(t));break;case"Do":null!=t&&(o[Ie]=P(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=P(t));break;case"YY":o[Pe]=ye.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":o[Pe]=P(t);break;case"a":case"A":n._meridiem=t;break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":o[Fe]=P(t);break;case"m":case"mm":o[De]=P(t);break;case"s":case"ss":o[Me]=P(t);break;case"S":case"SS":case"SSS":case"SSSS":o[Ae]=P(1e3*("0."+t));break;case"x":n._d=new Date(P(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=z(t);break;case"dd":case"ddd":case"dddd":r=n._locale.weekdaysParse(t),null!=r?(n._w=n._w||{},n._w.d=r):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=P(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=ye.parseTwoDigitYear(t)}}function W(e){var n,r,o,i,a,s,l;n=e._w,null!=n.GG||null!=n.W||null!=n.E?(a=1,s=4,r=t(n.GG,e._a[Pe],ce(ye(),1,4).year),o=t(n.W,1),i=t(n.E,1)):(a=e._locale._week.dow,s=e._locale._week.doy,r=t(n.gg,e._a[Pe],ce(ye(),a,s).year),o=t(n.w,1),null!=n.d?(i=n.d,a>i&&++o):i=null!=n.e?n.e+a:a),l=ue(r,o,i,s,a),e._a[Pe]=l.year,e._dayOfYear=l.dayOfYear}function Y(e){var n,r,o,i,a=[];if(!e._d){for(o=X(e),e._w&&null==e._a[Ie]&&null==e._a[Ee]&&W(e),e._dayOfYear&&(i=t(e._a[Pe],o[Pe]),e._dayOfYear>F(i)&&(e._pf._overflowDayOfYear=!0),r=ie(i,0,e._dayOfYear),e._a[Ee]=r.getUTCMonth(),e._a[Ie]=r.getUTCDate()),n=0;3>n&&null==e._a[n];++n)e._a[n]=a[n]=o[n];for(;7>n;n++)e._a[n]=a[n]=null==e._a[n]?2===n?1:0:e._a[n];24===e._a[Fe]&&0===e._a[De]&&0===e._a[Me]&&0===e._a[Ae]&&(e._nextDay=!0,e._a[Fe]=0),e._d=(e._useUTC?ie:oe).apply(null,a),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Fe]=24)}}function V(e){var t;e._d||(t=T(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],Y(e))}function X(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function J(t){if(t._f===ye.ISO_8601)return void ee(t);t._a=[],t._pf.empty=!0;var n,r,o,i,a,s=""+t._i,l=s.length,c=0;for(o=L(t._f,t._locale).match(Ne)||[],n=0;n<o.length;n++)i=o[n],r=(s.match(H(i,t))||[])[0],r&&(a=s.substr(0,s.indexOf(r)),a.length>0&&t._pf.unusedInput.push(a),s=s.slice(s.indexOf(r)+r.length),c+=r.length),vt[i]?(r?t._pf.empty=!1:t._pf.unusedTokens.push(i),G(i,r,t)):t._strict&&!r&&t._pf.unusedTokens.push(i);t._pf.charsLeftOver=l-c,s.length>0&&t._pf.unusedInput.push(s),t._pf.bigHour===!0&&t._a[Fe]<=12&&(t._pf.bigHour=e),t._a[Fe]=u(t._locale,t._a[Fe],t._meridiem),Y(t),M(t)}function K(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,o){return t||n||r||o})}function Z(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(e){var t,n,o,i,a;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)a=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=r(),t._f=e._f[i],J(t),A(t)&&(a+=t._pf.charsLeftOver,a+=10*t._pf.unusedTokens.length,t._pf.score=a,(null==o||o>a)&&(o=a,n=t));m(e,n||t)}function ee(e){var t,n,r=e._i,o=it.exec(r);if(o){for(e._pf.iso=!0,t=0,n=st.length;n>t;t++)if(st[t][1].exec(r)){e._f=st[t][0]+(o[6]||" ");break}for(t=0,n=lt.length;n>t;t++)if(lt[t][1].exec(r)){e._f+=lt[t][0];break}r.match(Xe)&&(e._f+="Z"),J(e)}else e._isValid=!1}function te(e){ee(e),e._isValid===!1&&(delete e._isValid,ye.createFromInputFallback(e))}function ne(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function re(t){var n,r=t._i;r===e?t._d=new Date:S(r)?t._d=new Date(+r):null!==(n=Re.exec(r))?t._d=new Date(+n[1]):"string"==typeof r?te(t):w(r)?(t._a=ne(r.slice(0),function(e){return parseInt(e,10)}),Y(t)):"object"==typeof r?V(t):"number"==typeof r?t._d=new Date(r):ye.createFromInputFallback(t)}function oe(e,t,n,r,o,i,a){var s=new Date(e,t,n,r,o,i,a);return 1970>e&&s.setFullYear(e),s}function ie(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function ae(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function se(e,t,n,r,o){return o.relativeTime(t||1,!!n,e,r)}function le(e,t,n){var r=ye.duration(e).abs(),o=Te(r.as("s")),i=Te(r.as("m")),a=Te(r.as("h")),s=Te(r.as("d")),l=Te(r.as("M")),c=Te(r.as("y")),u=o<mt.s&&["s",o]||1===i&&["m"]||i<mt.m&&["mm",i]||1===a&&["h"]||a<mt.h&&["hh",a]||1===s&&["d"]||s<mt.d&&["dd",s]||1===l&&["M"]||l<mt.M&&["MM",l]||1===c&&["y"]||["yy",c];return u[2]=t,u[3]=+e>0,u[4]=n,se.apply({},u)}function ce(e,t,n){var r,o=n-t,i=n-e.day();return i>o&&(i-=7),o-7>i&&(i+=7),r=ye(e).add(i,"d"),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function ue(e,t,n,r,o){var i,a,s=ie(e,0,1).getUTCDay();return s=0===s?7:s,n=null!=n?n:o,i=o-s+(s>r?7:0)-(o>s?7:0),a=7*(t-1)+(n-o)+i+1,{year:a>0?e:e-1,dayOfYear:a>0?a:F(e-1)+a}}function de(t){var n,r=t._i,o=t._f;return t._locale=t._locale||ye.localeData(t._l),null===r||o===e&&""===r?ye.invalid({nullInput:!0}):("string"==typeof r&&(t._i=r=t._locale.preparse(r)),ye.isMoment(r)?new f(r,!0):(o?w(o)?Q(t):J(t):re(t),n=new f(t),n._nextDay&&(n.add(1,"d"),n._nextDay=e),n))}function fe(e,t){var n,r;if(1===t.length&&w(t[0])&&(t=t[0]),!t.length)return ye();for(n=t[0],r=1;r<t.length;++r)t[r][e](n)&&(n=t[r]);return n}function pe(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),E(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function me(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function he(e,t,n){return"Month"===t?pe(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function ge(e,t){return function(n){return null!=n?(he(this,e,n),ye.updateOffset(this,t),this):me(this,e)}}function ve(e){return 400*e/146097}function _e(e){return 146097*e/400}function qe(e){ye.duration.fn[e]=function(){return this._data[e]}}function be(e){"undefined"==typeof ender&&(we=xe.moment,xe.moment=e?i("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",ye):ye)}for(var ye,we,Se,Ce="2.9.0",xe="undefined"==typeof global||"undefined"!=typeof window&&window!==global.window?this:global,Te=Math.round,ke=Object.prototype.hasOwnProperty,Pe=0,Ee=1,Ie=2,Fe=3,De=4,Me=5,Ae=6,Ue={},je=[],Oe="undefined"!=typeof module&&module&&module.exports,Re=/^\/?Date\((\-?\d+)/i,$e=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Be=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ne=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Le=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,He=/\d\d?/,ze=/\d{1,3}/,Ge=/\d{1,4}/,We=/[+\-]?\d{1,6}/,Ye=/\d+/,Ve=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Xe=/Z|[\+\-]\d\d:?\d\d/gi,Je=/T/i,Ke=/[\+\-]?\d+/,Ze=/[\+\-]?\d+(\.\d{1,3})?/,Qe=/\d/,et=/\d\d/,tt=/\d{3}/,nt=/\d{4}/,rt=/[+-]?\d{6}/,ot=/[+-]?\d+/,it=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,at="YYYY-MM-DDTHH:mm:ssZ",st=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],lt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ct=/([\+\-]|\d\d)/gi,ut=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),dt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ft={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},pt={},mt={s:45,m:45,h:22,d:26,M:11},ht="DDD w W M D d".split(" "),gt="M D H h m s w W".split(" "),vt={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return v(this.year()%100,2)},YYYY:function(){return v(this.year(),4)},YYYYY:function(){return v(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+v(Math.abs(e),6)},gg:function(){return v(this.weekYear()%100,2)},gggg:function(){return v(this.weekYear(),4)},ggggg:function(){return v(this.weekYear(),5)},GG:function(){return v(this.isoWeekYear()%100,2)},GGGG:function(){return v(this.isoWeekYear(),4)},GGGGG:function(){return v(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return P(this.milliseconds()/100)},SS:function(){return v(P(this.milliseconds()/10),2)},SSS:function(){return v(this.milliseconds(),3)},SSSS:function(){return v(this.milliseconds(),3)},Z:function(){var e=this.utcOffset(),t="+";return 0>e&&(e=-e,t="-"),t+v(P(e/60),2)+":"+v(P(e)%60,2)},ZZ:function(){var e=this.utcOffset(),t="+";return 0>e&&(e=-e,t="-"),t+v(P(e/60),2)+v(P(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},_t={},qt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],bt=!1;ht.length;)Se=ht.pop(),vt[Se+"o"]=l(vt[Se],Se);for(;gt.length;)Se=gt.pop(),vt[Se+Se]=s(vt[Se],2);vt.DDDD=s(vt.DDD,3),m(d.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var r,o,i;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;12>r;r++){if(o=ye.utc([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(o,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(o,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(i="^"+this.months(o,"")+"|^"+this.monthsShort(o,""),this._monthsParse[r]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=ye([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var r=this._calendar[e];return"function"==typeof r?r.apply(t,[n]):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var o=this._relativeTime[n];return"function"==typeof o?o(e,t,n,r):o.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return ce(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),ye=function(t,n,o,i){var a;return"boolean"==typeof o&&(i=o,o=e),a={},a._isAMomentObject=!0,a._i=t,a._f=n,a._l=o,a._strict=i,a._isUTC=!1,a._pf=r(),de(a)},ye.suppressDeprecationWarnings=!1,ye.createFromInputFallback=i("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),ye.min=function(){var e=[].slice.call(arguments,0);return fe("isBefore",e)},ye.max=function(){var e=[].slice.call(arguments,0);return fe("isAfter",e)},ye.utc=function(t,n,o,i){var a;return"boolean"==typeof o&&(i=o,o=e),a={},a._isAMomentObject=!0,a._useUTC=!0,a._isUTC=!0,a._l=o,a._i=t,a._f=n,a._strict=i,a._pf=r(),de(a).utc()},ye.unix=function(e){return ye(1e3*e)},ye.duration=function(e,t){var r,o,i,a,s=e,l=null;return ye.isDuration(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(s={},t?s[t]=e:s.milliseconds=e):(l=$e.exec(e))?(r="-"===l[1]?-1:1,s={y:0,d:P(l[Ie])*r,h:P(l[Fe])*r,m:P(l[De])*r,s:P(l[Me])*r,ms:P(l[Ae])*r}):(l=Be.exec(e))?(r="-"===l[1]?-1:1,i=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*r},s={y:i(l[2]),M:i(l[3]),d:i(l[4]),h:i(l[5]),m:i(l[6]),s:i(l[7]),w:i(l[8])}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(a=q(ye(s.from),ye(s.to)),s={},s.ms=a.milliseconds,s.M=a.months),o=new p(s),ye.isDuration(e)&&n(e,"_locale")&&(o._locale=e._locale),o},ye.version=Ce,ye.defaultFormat=at,ye.ISO_8601=function(){},ye.momentProperties=je,ye.updateOffset=function(){},ye.relativeTimeThreshold=function(t,n){return mt[t]===e?!1:n===e?mt[t]:(mt[t]=n,!0)},ye.lang=i("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return ye.locale(e,t)}),ye.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?ye.defineLocale(e,t):ye.localeData(e),n&&(ye.duration._locale=ye._locale=n)),ye._locale._abbr},ye.defineLocale=function(e,t){return null!==t?(t.abbr=e,Ue[e]||(Ue[e]=new d),Ue[e].set(t),ye.locale(e),Ue[e]):(delete Ue[e],null)},ye.langData=i("moment.langData is deprecated. Use moment.localeData instead.",function(e){return ye.localeData(e)}),ye.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return ye._locale;if(!w(e)){if(t=O(e))return t;e=[e]}return j(e)},ye.isMoment=function(e){return e instanceof f||null!=e&&n(e,"_isAMomentObject")},ye.isDuration=function(e){return e instanceof p};for(Se=qt.length-1;Se>=0;--Se)k(qt[Se]);ye.normalizeUnits=function(e){return x(e)},ye.invalid=function(e){var t=ye.utc(NaN);return null!=e?m(t._pf,e):t._pf.userInvalidated=!0,t},ye.parseZone=function(){return ye.apply(null,arguments).parseZone()},ye.parseTwoDigitYear=function(e){return P(e)+(P(e)>68?1900:2e3)},ye.isDate=S,m(ye.fn=f.prototype,{clone:function(){return ye(this)},valueOf:function(){return+this._d-6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=ye(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():N(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):N(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return A(this)},isDSTShifted:function(){return this._a?this.isValid()&&C(this._a,(this._isUTC?ye.utc(this._a):ye(this._a)).toArray())>0:!1},parsingFlags:function(){return m({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.utcOffset(0,e)},local:function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(e){var t=N(this,e||ye.defaultFormat);return this.localeData().postformat(t)},add:b(1,"add"),subtract:b(-1,"subtract"),diff:function(e,t,n){var r,o,i=R(e,this),a=6e4*(i.utcOffset()-this.utcOffset());return t=x(t),"year"===t||"month"===t||"quarter"===t?(o=c(this,i),"quarter"===t?o/=3:"year"===t&&(o/=12)):(r=this-i,o="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-a)/864e5:"week"===t?(r-a)/6048e5:r),n?o:g(o)},from:function(e,t){return ye.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(ye(),e)},calendar:function(e){var t=e||ye(),n=R(t,this).startOf("day"),r=this.diff(n,"days",!0),o=-6>r?"sameElse":-1>r?"lastWeek":0>r?"lastDay":1>r?"sameDay":2>r?"nextDay":7>r?"nextWeek":"sameElse";return this.format(this.localeData().calendar(o,this,ye(t)))},isLeapYear:function(){return D(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=ae(e,this.localeData()),this.add(e-t,"d")):t},month:ge("Month",!0),startOf:function(e){switch(e=x(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=x(t),t===e||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(e,t){var n;return t=x("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=ye.isMoment(e)?e:ye(e),+this>+e):(n=ye.isMoment(e)?+e:+ye(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=x("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=ye.isMoment(e)?e:ye(e),+e>+this):(n=ye.isMoment(e)?+e:+ye(e),+this.clone().endOf(t)<n)},isBetween:function(e,t,n){return this.isAfter(e,n)&&this.isBefore(t,n)},isSame:function(e,t){var n;return t=x(t||"millisecond"),"millisecond"===t?(e=ye.isMoment(e)?e:ye(e),+this===+e):(n=+ye(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:i("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=ye.apply(null,arguments),this>e?this:e}),max:i("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=ye.apply(null,arguments),e>this?this:e}),zone:i("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),utcOffset:function(e,t){var n,r=this._offset||0;return null!=e?("string"==typeof e&&(e=z(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateUtcOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),r!==e&&(!t||this._changeInProgress?y(this,ye.duration(e-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ye.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?r:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&0===this._offset},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(z(this._i)),this},hasAlignedHourOffset:function(e){return e=e?ye(e).utcOffset():0,(this.utcOffset()-e)%60===0},daysInMonth:function(){return E(this.year(),this.month())},dayOfYear:function(e){var t=Te((ye(this).startOf("day")-ye(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=ce(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=ce(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=ce(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return I(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return I(this.year(),e.dow,e.doy)},get:function(e){return e=x(e),this[e]()},set:function(e,t){var n;if("object"==typeof e)for(n in e)this.set(n,e[n]);else e=x(e),"function"==typeof this[e]&&this[e](t);return this},locale:function(t){var n;return t===e?this._locale._abbr:(n=ye.localeData(t),null!=n&&(this._locale=n),this)},lang:i("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return 15*-Math.round(this._d.getTimezoneOffset()/15)}}),ye.fn.millisecond=ye.fn.milliseconds=ge("Milliseconds",!1),ye.fn.second=ye.fn.seconds=ge("Seconds",!1),ye.fn.minute=ye.fn.minutes=ge("Minutes",!1),ye.fn.hour=ye.fn.hours=ge("Hours",!0),ye.fn.date=ge("Date",!0),ye.fn.dates=i("dates accessor is deprecated. Use date instead.",ge("Date",!0)),ye.fn.year=ge("FullYear",!0),ye.fn.years=i("years accessor is deprecated. Use year instead.",ge("FullYear",!0)),ye.fn.days=ye.fn.day,ye.fn.months=ye.fn.month,ye.fn.weeks=ye.fn.week,ye.fn.isoWeeks=ye.fn.isoWeek,ye.fn.quarters=ye.fn.quarter,ye.fn.toJSON=ye.fn.toISOString,ye.fn.isUTC=ye.fn.isUtc,m(ye.duration.fn=p.prototype,{_bubble:function(){var e,t,n,r=this._milliseconds,o=this._days,i=this._months,a=this._data,s=0;a.milliseconds=r%1e3,e=g(r/1e3),a.seconds=e%60,t=g(e/60),a.minutes=t%60,n=g(t/60),a.hours=n%24,o+=g(n/24),s=g(ve(o)),o-=g(_e(s)),i+=g(o/30),o%=30,s+=g(i/12),i%=12,a.days=o,a.months=i,a.years=s},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return g(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*P(this._months/12)},humanize:function(e){var t=le(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=ye.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=ye.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=x(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=x(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*ve(t),"month"===e?n:n/12;switch(t=this._days+Math.round(_e(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:ye.fn.lang,locale:ye.fn.locale,toIsoString:i("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),o=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||o||i?"T":"")+(r?r+"H":"")+(o?o+"M":"")+(i?i+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}}),ye.duration.fn.toString=ye.duration.fn.toISOString;for(Se in ut)n(ut,Se)&&qe(Se.toLowerCase());ye.duration.fn.asMilliseconds=function(){return this.as("ms")},ye.duration.fn.asSeconds=function(){return this.as("s")},ye.duration.fn.asMinutes=function(){return this.as("m")},ye.duration.fn.asHours=function(){return this.as("h")},ye.duration.fn.asDays=function(){return this.as("d")},ye.duration.fn.asWeeks=function(){return this.as("weeks")},ye.duration.fn.asMonths=function(){return this.as("M")},ye.duration.fn.asYears=function(){return this.as("y")},ye.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===P(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Oe?module.exports=ye:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(xe.moment=we),ye}),be(!0)):be()}.call(this),define("main/event",["moment","base","modules/localStorage"],function(e,t){var n="mbEvents",r=0,o=new Date;return t.factory("event_tracking",["$http","localStorage",function(t,i){var a=function(){var e=i(n);return null==e&&(e={},i(n,e)),e},s=function(e){var t=a();return t[e]||!1},l=function(e){var t=a();return t[e]=!0,i(n,t)},c=function(){return t({url:"/editingSession/".concat(window.project_id),method:"PUT",headers:{"X-CSRF-Token":window.csrfToken}})};return{send:function(e,t,n,r){return ga("send","event",e,t,n,r)},sendGAOnce:function(e,t,n,r){return s(t)?void 0:(l(t),this.send(e,t,n,r))},editingSessionHeartbeat:function(){if(o<=new Date){c(),r++;var t=2>=r?30:6>=r?60*(r-2):300;return o=e().add(t,"seconds").toDate()}},sendMB:function(e,n){return null==n&&(n={}),t({url:"/event/".concat(e),method:"POST",data:n,headers:{"X-CSRF-Token":window.csrfToken}})},sendMBSampled:function(e,t){return Math.random()<.01?this.sendMB(e,t):void 0},sendMBOnce:function(e,t){return s(e)?void 0:(l(e),this.sendMB(e,t))},eventInCache:function(e){return s(e)}}}]),$(".navbar a").on("click",function(e){var t=$(e.target).attr("href");return null!=t?ga("send","event","navigation","top menu bar",t):void 0})}),define("main/bonus",["base"],function(e){return e.controller("BonusLinksController",["$scope","$modal",function(e,t){return e.openLinkToUsModal=function(){return t.open({templateUrl:"BonusLinkToUsModal",controller:"BonusModalController"})}}]),e.controller("BonusModalController",["$scope","$modalInstance",function(e,t){return e.cancel=function(){return t.dismiss()}}])}),define("main/system-messages",["base"],function(e){return e.controller("SystemMessagesController",["$scope",function(e){return e.messages=window.systemMessages}]),e.controller("SystemMessageController",["$scope","$sce",function(e,t){return e.hidden=$.localStorage("systemMessage.hide.".concat(e.message._id)),e.htmlContent=e.message.content,e.hide=function(){return e.hidden=!0,$.localStorage("systemMessage.hide.".concat(e.message._id),!0)}}])}),define("main/translations",["base"],function(e){return e.controller("TranslationsPopupController",["$scope","ipCookie",function(e,t){return e.hidei18nNotification=t("hidei18nNotification"),e.dismiss=function(){return t("hidei18nNotification",!0,{expires:180}),e.hidei18nNotification=t("hidei18nNotification")}}])}),define("main/subscription-dashboard",["base"],function(e){var t="/user/subscription/update",n=_.once(function(){return"undefined"!=typeof recurly&&recurly?(recurly.configure(window.recurlyApiKey),!0):!1});e.controller("MetricsEmailController",["$scope","$http",function(e,t){e.institutionEmailSubscription=function(e){var t=_.find(window.managedInstitutions,function(t){return t.v1Id===parseInt(e)});return t.metricsEmail.optedOutUserIds.includes(window.user_id)?"Subscribe":"Unsubscribe"},e.changeInstitutionalEmailSubscription=function(n){return e.subscriptionChanging=!0,t({method:"POST",url:"/institutions/".concat(n,"/emailSubscription"),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(t){window.managedInstitutions=_.map(window.managedInstitutions,function(e){return e.v1Id===parseInt(n)&&(e.metricsEmail.optedOutUserIds=t.data),e}),e.subscriptionChanging=!1})}}]),e.factory("RecurlyPricing",["$q","MultiCurrencyPricing",function(e,t){return{loadDisplayPriceWithTax:function(r,o,i){if(n()){var a=t.plans[o].symbol,s=recurly.Pricing();return e(function(e,t){s.plan(r,{quantity:1}).currency(o).done(function(t){var n=parseFloat(t.next.total),r=n*i;isNaN(r)&&(r=0);var o=n+r;o%1!==0&&(o=o.toFixed(2)),e("".concat(a).concat(o))})})}}}}]),e.controller("ChangePlanFormController",["$scope","$modal","RecurlyPricing",function(e,t,r){n()&&(e.changePlan=function(){return t.open({templateUrl:"confirmChangePlanModalTemplate",controller:"ConfirmChangePlanController",scope:e})},e.$watch("plan",function(t){if(t){var n=t.planCode,o=window.subscription.recurly,i=o.currency,a=o.taxRate;e.price="...",r.loadDisplayPriceWithTax(n,i,a).then(function(t){e.price=t})}}))}]),e.controller("ConfirmChangePlanController",["$scope","$modalInstance","$http",function(e,n,r){return e.confirmChangePlan=function(){var n={plan_code:e.plan.planCode,_csrf:window.csrfToken};return e.inflight=!0,r.post("".concat(t,"?origin=confirmChangePlan"),n).then(function(){return location.reload()})["catch"](function(){return console.log("something went wrong changing plan")})},e.cancel=function(){return n.dismiss("cancel");
}}]),e.controller("LeaveGroupModalController",["$scope","$modalInstance","$http",function(e,t,n){return e.confirmLeaveGroup=function(){return e.inflight=!0,n({url:"/subscription/group/user",method:"DELETE",params:{admin_user_id:e.admin_id,_csrf:window.csrfToken}}).then(function(){return location.reload()})["catch"](function(){return console.log("something went wrong changing plan")})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("GroupMembershipController",["$scope","$modal",function(e,t){e.removeSelfFromGroup=function(n){return e.admin_id=n,t.open({templateUrl:"LeaveGroupModalTemplate",controller:"LeaveGroupModalController",scope:e})}}]),e.controller("RecurlySubscriptionController",["$scope",function(e){var t=n();e.showChangePlanButton=t&&!subscription.groupPlan,e.recurlyLoadError=!t,e.switchToDefaultView=function(){e.showCancellation=!1,e.showChangePlan=!1},e.switchToDefaultView(),e.switchToCancellationView=function(){e.showCancellation=!0,e.showChangePlan=!1},e.switchToChangePlanView=function(){e.showCancellation=!1,e.showChangePlan=!0}}]),e.controller("RecurlyCancellationController",["$scope","RecurlyPricing","$http",function(e,r,o){if(n()){var i=window.subscription,a=new Date;a.setDate(a.getDate()+7);var s=new Date(i.recurly.trial_ends_at),l=s>new Date,c=a>s,u=-1!==i.plan.planCode.indexOf("collaborator")&&-1===i.plan.planCode.indexOf("ann")&&!i.groupPlan,d=l&&c;u&&d?e.showExtendFreeTrial=!0:u&&!d?e.showDowngradeToStudent=!0:e.showBasicCancel=!0;var f=window.subscription.recurly,p=f.currency,m=f.taxRate;e.studentPrice="...",r.loadDisplayPriceWithTax("student",p,m).then(function(t){e.studentPrice=t}),e.downgradeToStudent=function(){var n={plan_code:"student",_csrf:window.csrfToken};return e.inflight=!0,o.post("".concat(t,"?origin=downgradeToStudent"),n).then(function(){return location.reload()})["catch"](function(){return console.log("something went wrong changing plan")})},e.cancelSubscription=function(){var t={_csrf:window.csrfToken};return e.inflight=!0,o.post("/user/subscription/cancel",t).then(function(){return location.href="/user/subscription/canceled"})["catch"](function(){return console.log("something went wrong changing plan")})},e.extendTrial=function(){var t={_csrf:window.csrfToken};return e.inflight=!0,o.put("/user/subscription/extend",t).then(function(){return location.reload()})["catch"](function(){return console.log("something went wrong changing plan")})}}}])}),define("directives/creditCards",["base"],function(e){return e.factory("ccUtils",function(){var e=/(\d{1,4})/g,t=/(?:^|\s)(\d{4})$/,n=[{type:"visa",patterns:[4],format:e,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:e,length:[16],cvcLength:[3],luhn:!0}],r=function(e){e=(e+"").replace(/\D/g,"");for(var t=0,r=Array.from(n);t<r.length;t++)for(var o=r[t],i=0,a=Array.from(o.patterns);i<a.length;i++){var s=a[i],l=s+"";if(e.substr(0,l.length)===l)return o}},o=function(e){for(var t=0,r=Array.from(n);t<r.length;t++){var o=r[t];if(o.type===e)return o}},i=function(e){return e?__guard__(r(e),function(e){return e.type})||null:null},a=function(e){e=e.replace(/\D/g,"");var t=r(e);if(!t)return e;var n=t.length[t.length.length-1];if(e=e.slice(0,n),t.format.global)return __guard__(e.match(t.format),function(e){return e.join(" ")});var o=t.format.exec(e);return null!=o?(o.shift(),o=$.grep(o,function(e){return e}),o.join(" ")):void 0},s=function(e){var t=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);if(!t)return"";var n=t[1]||"",r=t[2]||"",o=t[3]||"";return o.length>0?r=" / ":" /"===r?(n=n.substring(0,1),r=""):2===n.length||r.length>0?r=" / ":1!==n.length||["0","1"].includes(n)||(n="0".concat(n),r=" / "),n+r+o},l=function(e){null==e&&(e="");var t=Array.from(e.split(/[\s\/]+/,2)),n=_slicedToArray(t,2),r=n[0],o=n[1];if(2===(null!=o?o.length:void 0)&&/^\d+$/.test(o)){var i=(new Date).getFullYear();i=i.toString().slice(0,2),o=i+o}return r=parseInt(r,10),o=parseInt(o,10),isNaN(r)||isNaN(o)?void 0:{month:r,year:o}};return{fromNumber:r,fromType:o,cardType:i,formatExpiry:s,formatCardNumber:a,defaultFormat:e,defaultInputFormat:t,parseExpiry:l}}),e.factory("ccFormat",["ccUtils","$filter",function(e,t){var n=function(e){return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:null!=__guard__("undefined"!=typeof document&&null!==document?document.selection:void 0,function(e){return e.createRange})&&document.selection.createRange().text?!0:!1},r=function(e,t){var n;try{n=t.prop("selectionStart")}catch(r){n=null}var o=t.val();if(t.val(e),null!==n&&t.is(":focus")){if(n===o.length&&(n=e.length),o!==e){var i=o.slice(n-1,+n+1||void 0),a=e.slice(n-1,+n+1||void 0),s=e[n];/\d/.test(s)&&i==="".concat(s," ")&&a===" ".concat(s)&&(n+=1)}return t.prop("selectionStart",n),t.prop("selectionEnd",n)}},o=function(e){null==e&&(e="");for(var t="０１２３４５６７８９",n="0123456789",r="",o=e.split(""),i=0,a=Array.from(o);i<a.length;i++){var s=a[i],l=t.indexOf(s);l>-1&&(s=n[l]),r+=s}return r},i=function(e){var t=$(e.currentTarget);return setTimeout(function(){var e=t.val();return e=o(e),e=e.replace(/\D/g,""),r(e,t)})},a=function(t){var n=$(t.currentTarget);return setTimeout(function(){var t=n.val();return t=o(t),t=e.formatCardNumber(t),r(t,n)})},s=function(t){var n,r=String.fromCharCode(t.which);if(/^\d+$/.test(r)){var o=$(t.currentTarget),i=o.val(),a=e.fromNumber(i+r),s=i.replace(/\D/g,"")+r,l=s.length,c=16;if(a&&(c=a.length[a.length.length-1]),!(l>=c||null!=o.prop("selectionStart")&&o.prop("selectionStart")!==i.length))return n=a&&"amex"===a.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,n.test(i)?(t.preventDefault(),setTimeout(function(){return o.val(i+" "+r)})):n.test(i+r)?(t.preventDefault(),setTimeout(function(){return o.val(i+r+" ")})):void 0}},l=function(e){var t=$(e.currentTarget),n=t.val();return 8!==e.which||null!=t.prop("selectionStart")&&t.prop("selectionStart")!==n.length?void 0:/\d\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s$/,""))})):/\s\d?$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d$/,""))})):void 0},c=function(t){t=t.replace(/\D/g,"");var n=e.fromNumber(t);if(!n)return t;var r=n.length[n.length.length-1];if(t=t.slice(0,r),n.format.global)return __guard__(t.match(n.format),function(e){return e.join(" ")});var o=n.format.exec(t);return null!=o?(o.shift(),o=$.grep(o,function(e){return e}),o.join(" ")):void 0},u=function(e){return null!=e?e.replace(/\s/g,""):e},d=function(t){var n=$(t.currentTarget);return setTimeout(function(){var t=n.val();return t=o(t),t=e.formatExpiry(t),r(t,n)})},f=function(e){var t=String.fromCharCode(e.which);if(/^\d+$/.test(t)){var n=$(e.currentTarget),r=n.val()+t;return/^\d$/.test(r)&&!["0","1"].includes(r)?(e.preventDefault(),setTimeout(function(){return n.val("0".concat(r," / "))})):/^\d\d$/.test(r)?(e.preventDefault(),setTimeout(function(){var e=parseInt(r[0],10),t=parseInt(r[1],10);return t>2&&0!==e?n.val("0".concat(e," / ").concat(t)):n.val("".concat(r," / "))})):void 0}},p=function(e){var t=String.fromCharCode(e.which);if(/^\d+$/.test(t)){var n=$(e.currentTarget),r=n.val();return/^\d\d$/.test(r)?n.val("".concat(r," / ")):void 0}},m=function(e){var t=String.fromCharCode(e.which);if("/"===t||" "===t){var n=$(e.currentTarget),r=n.val();return/^\d$/.test(r)&&"0"!==r?n.val("0".concat(r," / ")):void 0}},h=function(e){var t=$(e.currentTarget),n=t.val();return 8!==e.which||null!=t.prop("selectionStart")&&t.prop("selectionStart")!==n.length?void 0:/\d\s\/\s$/.test(n)?(e.preventDefault(),setTimeout(function(){return t.val(n.replace(/\d\s\/\s$/,""))})):void 0},g=function(n){if(null!=n){var r=e.parseExpiry(n);if(null==r)return;var o=new Date(r.year,r.month-1);return t("date")(o,"MM/yyyy")}},v=function(e){var t=$(e.currentTarget);return setTimeout(function(){var e=t.val();return e=o(e),e=e.replace(/\D/g,"").slice(0,4),r(e,t)})},_=function(e){if(e.metaKey||e.ctrlKey)return!0;if(32===e.which)return!1;if(0===e.which)return!0;if(e.which<33)return!0;var t=String.fromCharCode(e.which);return!!/[\d\s]/.test(t)},q=function(t){var r=$(t.currentTarget),o=String.fromCharCode(t.which);if(/^\d+$/.test(o)&&!n(r)){var i=(r.val()+o).replace(/\D/g,""),a=e.fromNumber(i);return a?i.length<=a.length[a.length.length-1]:i.length<=16}},b=function(e){var t=$(e.currentTarget),r=String.fromCharCode(e.which);if(/^\d+$/.test(r)&&!n(t)){var o=t.val()+r;return o=o.replace(/\D/g,""),o.length>6?!1:void 0}},y=function(e){var t=$(e.currentTarget),r=String.fromCharCode(e.which);if(/^\d+$/.test(r)&&!n(t)){var o=t.val()+r;return o.length<=4}},w=function(t){var n=$(t.currentTarget),r=n.val(),o=e.cardType(r)||"unknown";if(!n.hasClass(o)){var i=Array.from(cards).map(function(e){return e.type});return n.removeClass("unknown"),n.removeClass(i.join(" ")),n.addClass(o),n.toggleClass("identified","unknown"!==o),n.trigger("payment.cardType",o)}};return{hasTextSelected:n,replaceFullWidthChars:o,reFormatNumeric:i,reFormatCardNumber:a,formatCardNumber:s,formatBackCardNumber:l,getFormattedCardNumber:c,parseCardNumber:u,reFormatExpiry:d,formatExpiry:f,formatForwardExpiry:p,formatForwardSlash:m,formatBackExpiry:h,parseExpiry:g,reFormatCVC:v,restrictNumeric:_,restrictCardNumber:q,restrictExpiry:b,restrictCVC:y,setCardType:w}}]),e.directive("ccFormatExpiry",["ccFormat",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,o){return n.on("keypress",e.restrictNumeric),n.on("keypress",e.restrictExpiry),n.on("keypress",e.formatExpiry),n.on("keypress",e.formatForwardSlash),n.on("keypress",e.formatForwardExpiry),n.on("keydown",e.formatBackExpiry),n.on("change",e.reFormatExpiry),n.on("input",e.reFormatExpiry),n.on("paste",e.reFormatExpiry),o.$parsers.push(e.parseExpiry),o.$formatters.push(e.parseExpiry)}}}]),e.directive("ccFormatCardNumber",["ccFormat",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,o){return n.on("keypress",e.restrictNumeric),n.on("keypress",e.restrictCardNumber),n.on("keypress",e.formatCardNumber),n.on("keydown",e.formatBackCardNumber),n.on("paste",e.reFormatCardNumber),o.$parsers.push(e.parseCardNumber),o.$formatters.push(e.getFormattedCardNumber)}}}]),e.directive("ccFormatSecCode",["ccFormat",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,o){return n.on("keypress",e.restrictNumeric),n.on("keypress",e.restrictCVC),n.on("paste",e.reFormatCVC),n.on("change",e.reFormatCVC),n.on("input",e.reFormatCVC)}}}])}),define("main/new-subscription",["base","directives/creditCards"],function(e){return e.controller("NewSubscriptionController",["$scope","MultiCurrencyPricing","$http","event_tracking","ccUtils",function(e,t,n,r,o){if("undefined"==typeof recurly||!recurly)return void(e.recurlyLoadError=!0);e.recurlyLoadError=!1,e.currencyCode=t.currencyCode,e.allCurrencies=t.plans,e.availableCurrencies={},e.planCode=window.plan_code,e.switchToStudent=function(){var t=window.plan_code,n=t.replace("collaborator","student");r.sendMB("subscription-form-switch-to-student",{plan:window.plan_code}),r.send("subscription-funnel","subscription-form-switch-to-student",window.plan_code),window.location="/user/subscription/new?planCode=".concat(n,"&currency=").concat(e.currencyCode,"&cc=").concat(e.data.coupon)},r.sendMB("subscription-form",{plan:window.plan_code}),r.send("subscription-funnel","subscription-form-viewed",window.plan_code),e.paymentMethod={value:"credit_card"},e.data={first_name:"",last_name:"",postal_code:"",address1:"",address2:"",state:"",city:"",country:window.countryCode,coupon:window.couponCode},e.validation={},e.processing=!1,e.threeDSecureFlow=!1,e.threeDSecureContainer=document.querySelector(".three-d-secure-container"),e.threeDSecureRecurlyContainer=document.querySelector(".three-d-secure-recurly-container"),recurly.configure({publicKey:window.recurlyApiKey,style:{all:{fontFamily:'"Open Sans", sans-serif',fontSize:"16px",fontColor:"#7a7a7a"},month:{placeholder:"MM"},year:{placeholder:"YY"},cvv:{placeholder:"CVV"}}});var i=recurly.Pricing();window.pricing=i,i.plan(window.plan_code,{quantity:1}).address({country:e.data.country}).tax({tax_code:"digital",vat_number:""}).currency(e.currencyCode).coupon(e.data.coupon).done(),i.on("change",function(){e.planName=i.items.plan.name,e.price=i.price,i.items.plan.trial&&(e.trialLength=i.items.plan.trial.length),e.monthlyBilling=1===i.items.plan.period.length,e.availableCurrencies={};for(var n in i.items.plan.price)t.plans[n]&&(e.availableCurrencies[n]=t.plans[n]);if(i.items&&i.items.coupon&&i.items.coupon.discount&&"percent"===i.items.coupon.discount.type){var r=parseInt(i.price.base.plan.unit);e.normalPrice=r,i.items.coupon.applies_for_months>0&&i.items.coupon.discount.rate&&i.items.coupon.applies_for_months&&(e.discountMonths=i.items.coupon.applies_for_months,e.discountRate=100*i.items.coupon.discount.rate),i.price.taxes[0]&&i.price.taxes[0].rate&&(e.normalPrice+=r*i.price.taxes[0].rate)}e.$apply()}),e.applyCoupon=function(){return i.coupon(e.data.coupon).done()},e.applyVatNumber=function(){return i.tax({tax_code:"digital",vat_number:e.data.vat_number}).done()},e.changeCurrency=function(t){return e.currencyCode=t,i.currency(t).done()},e.inputHasError=function(e){return null==e?!1:e.$touched&&e.$invalid},e.isFormValid=function(t){return"paypal"===e.paymentMethod.value?""!==e.data.country:t.$valid},e.updateCountry=function(){return i.address({country:e.data.country}).done()},e.setPaymentMethod=function(t){e.paymentMethod.value=t,e.validation.errorFields={},e.genericError=""};var a,s=function(t,o,s){if(o&&(a=o),e.validation.errorFields={},null==t){var c={_csrf:window.csrfToken,recurly_token_id:a.id,recurly_three_d_secure_action_result_token_id:s&&s.id,subscriptionDetails:{currencyCode:i.items.currency,plan_code:i.items.plan.code,coupon_code:i.items.coupon?i.items.coupon.code:"",first_name:e.data.first_name,last_name:e.data.last_name,isPaypal:"paypal"===e.paymentMethod.value,address:{address1:e.data.address1,address2:e.data.address2,country:e.data.country,state:e.data.state,postal_code:e.data.postal_code}}};return r.sendMB("subscription-form-submitted",{currencyCode:c.subscriptionDetails.currencyCode,plan_code:c.subscriptionDetails.plan_code,coupon_code:c.subscriptionDetails.coupon_code,isPaypal:c.subscriptionDetails.isPaypal}),r.send("subscription-funnel","subscription-form-submitted",c.subscriptionDetails.plan_code),n.post("/user/subscription/create",c).then(function(){r.sendMB("subscription-submission-success"),r.send("subscription-funnel","subscription-submission-success",c.subscriptionDetails.plan_code),window.location.href="/user/subscription/thank-you"})["catch"](function(t){e.processing=!1;var n=t.data;e.genericError=n&&n.message||"Something went wrong processing the request",n.threeDSecureActionTokenId&&l(n.threeDSecureActionTokenId)})}r.sendMB("subscription-error",t),r.send("subscription-funnel","subscription-error"),e.$evalAsync(function(){e.processing=!1,e.genericError=t.message,_.each(t.fields,function(t){return e.validation.errorFields[t]=!0})})};e.submit=function(){if(e.processing=!0,"paypal"===e.paymentMethod.value){var t={description:e.planName};return recurly.paypal(t,s)}return recurly.token(e.data,s)};var l=function(t){var n=recurly.Risk(),r=n.ThreeDSecure({actionTokenId:t});r.on("error",function(t){e.genericError="Error: ".concat(t.message),e.threeDSecureFlow=!1,e.$apply()}),r.on("token",function(t){s(null,null,t),e.genericError=null,e.threeDSecureFlow=!1,e.processing=!0,e.$apply()}),e.threeDSecureRecurlyContainer.innerHTML="",e.threeDSecureFlow=!0,r.attach(e.threeDSecureRecurlyContainer),window.setTimeout(function(){e.threeDSecureContainer.scrollIntoView()},0)};e.countries=[{code:"AF",name:"Afghanistan"},{code:"AL",name:"Albania"},{code:"DZ",name:"Algeria"},{code:"AS",name:"American Samoa"},{code:"AD",name:"Andorra"},{code:"AO",name:"Angola"},{code:"AI",name:"Anguilla"},{code:"AQ",name:"Antarctica"},{code:"AG",name:"Antigua and Barbuda"},{code:"AR",name:"Argentina"},{code:"AM",name:"Armenia"},{code:"AW",name:"Aruba"},{code:"AC",name:"Ascension Island"},{code:"AU",name:"Australia"},{code:"AT",name:"Austria"},{code:"AZ",name:"Azerbaijan"},{code:"BS",name:"Bahamas"},{code:"BH",name:"Bahrain"},{code:"BD",name:"Bangladesh"},{code:"BB",name:"Barbados"},{code:"BE",name:"Belgium"},{code:"BZ",name:"Belize"},{code:"BJ",name:"Benin"},{code:"BM",name:"Bermuda"},{code:"BT",name:"Bhutan"},{code:"BO",name:"Bolivia"},{code:"BA",name:"Bosnia and Herzegovina"},{code:"BW",name:"Botswana"},{code:"BV",name:"Bouvet Island"},{code:"BR",name:"Brazil"},{code:"BQ",name:"British Antarctic Territory"},{code:"IO",name:"British Indian Ocean Territory"},{code:"VG",name:"British Virgin Islands"},{code:"BN",name:"Brunei"},{code:"BG",name:"Bulgaria"},{code:"BF",name:"Burkina Faso"},{code:"BI",name:"Burundi"},{code:"KH",name:"Cambodia"},{code:"CM",name:"Cameroon"},{code:"CA",name:"Canada"},{code:"IC",name:"Canary Islands"},{code:"CT",name:"Canton and Enderbury Islands"},{code:"CV",name:"Cape Verde"},{code:"KY",name:"Cayman Islands"},{code:"CF",name:"Central African Republic"},{code:"EA",name:"Ceuta and Melilla"},{code:"TD",name:"Chad"},{code:"CL",name:"Chile"},{code:"CN",name:"China"},{code:"CX",name:"Christmas Island"},{code:"CP",name:"Clipperton Island"},{code:"CC",name:"Cocos [Keeling] Islands"},{code:"CO",name:"Colombia"},{code:"KM",name:"Comoros"},{code:"CD",name:"Congo [DRC]"},{code:"CK",name:"Cook Islands"},{code:"CR",name:"Costa Rica"},{code:"HR",name:"Croatia"},{code:"CU",name:"Cuba"},{code:"CY",name:"Cyprus"},{code:"CZ",name:"Czech Republic"},{code:"DK",name:"Denmark"},{code:"DG",name:"Diego Garcia"},{code:"DJ",name:"Djibouti"},{code:"DM",name:"Dominica"},{code:"DO",name:"Dominican Republic"},{code:"NQ",name:"Dronning Maud Land"},{code:"TL",name:"East Timor"},{code:"EC",name:"Ecuador"},{code:"EG",name:"Egypt"},{code:"SV",name:"El Salvador"},{code:"EE",name:"Estonia"},{code:"ET",name:"Ethiopia"},{code:"FK",name:"Falkland Islands [Islas Malvinas]"},{code:"FO",name:"Faroe Islands"},{code:"FJ",name:"Fiji"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GF",name:"French Guiana"},{code:"PF",name:"French Polynesia"},{code:"TF",name:"French Southern Territories"},{code:"FQ",name:"French Southern and Antarctic Territories"},{code:"GA",name:"Gabon"},{code:"GM",name:"Gambia"},{code:"GE",name:"Georgia"},{code:"DE",name:"Germany"},{code:"GH",name:"Ghana"},{code:"GI",name:"Gibraltar"},{code:"GR",name:"Greece"},{code:"GL",name:"Greenland"},{code:"GD",name:"Grenada"},{code:"GP",name:"Guadeloupe"},{code:"GU",name:"Guam"},{code:"GT",name:"Guatemala"},{code:"GG",name:"Guernsey"},{code:"GW",name:"Guinea-Bissau"},{code:"GY",name:"Guyana"},{code:"HT",name:"Haiti"},{code:"HM",name:"Heard Island and McDonald Islands"},{code:"HN",name:"Honduras"},{code:"HK",name:"Hong Kong"},{code:"HU",name:"Hungary"},{code:"IS",name:"Iceland"},{code:"IN",name:"India"},{code:"ID",name:"Indonesia"},{code:"IE",name:"Ireland"},{code:"IM",name:"Isle of Man"},{code:"IL",name:"Israel"},{code:"IT",name:"Italy"},{code:"JM",name:"Jamaica"},{code:"JP",name:"Japan"},{code:"JE",name:"Jersey"},{code:"JT",name:"Johnston Island"},{code:"JO",name:"Jordan"},{code:"KZ",name:"Kazakhstan"},{code:"KE",name:"Kenya"},{code:"KI",name:"Kiribati"},{code:"KW",name:"Kuwait"},{code:"KG",name:"Kyrgyzstan"},{code:"LA",name:"Laos"},{code:"LV",name:"Latvia"},{code:"LS",name:"Lesotho"},{code:"LY",name:"Libya"},{code:"LI",name:"Liechtenstein"},{code:"LT",name:"Lithuania"},{code:"LU",name:"Luxembourg"},{code:"MO",name:"Macau"},{code:"MK",name:"Macedonia [FYROM]"},{code:"MG",name:"Madagascar"},{code:"MW",name:"Malawi"},{code:"MY",name:"Malaysia"},{code:"MV",name:"Maldives"},{code:"ML",name:"Mali"},{code:"MT",name:"Malta"},{code:"MH",name:"Marshall Islands"},{code:"MQ",name:"Martinique"},{code:"MR",name:"Mauritania"},{code:"MU",name:"Mauritius"},{code:"YT",name:"Mayotte"},{code:"FX",name:"Metropolitan France"},{code:"MX",name:"Mexico"},{code:"FM",name:"Micronesia"},{code:"MI",name:"Midway Islands"},{code:"MD",name:"Moldova"},{code:"MC",name:"Monaco"},{code:"MN",name:"Mongolia"},{code:"ME",name:"Montenegro"},{code:"MS",name:"Montserrat"},{code:"MA",name:"Morocco"},{code:"MZ",name:"Mozambique"},{code:"NA",name:"Namibia"},{code:"NR",name:"Nauru"},{code:"NP",name:"Nepal"},{code:"NL",name:"Netherlands"},{code:"AN",name:"Netherlands Antilles"},{code:"NT",name:"Neutral Zone"},{code:"NC",name:"New Caledonia"},{code:"NZ",name:"New Zealand"},{code:"NI",name:"Nicaragua"},{code:"NE",name:"Niger"},{code:"NG",name:"Nigeria"},{code:"NU",name:"Niue"},{code:"NF",name:"Norfolk Island"},{code:"VD",name:"North Vietnam"},{code:"MP",name:"Northern Mariana Islands"},{code:"NO",name:"Norway"},{code:"OM",name:"Oman"},{code:"QO",name:"Outlying Oceania"},{code:"PC",name:"Pacific Islands Trust Territory"},{code:"PK",name:"Pakistan"},{code:"PW",name:"Palau"},{code:"PS",name:"Palestinian Territories"},{code:"PA",name:"Panama"},{code:"PZ",name:"Panama Canal Zone"},{code:"PY",name:"Paraguay"},{code:"YD",name:"People&apos;s Democratic Republic of Yemen"},{code:"PE",name:"Peru"},{code:"PH",name:"Philippines"},{code:"PN",name:"Pitcairn Islands"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"PR",name:"Puerto Rico"},{code:"QA",name:"Qatar"},{code:"RO",name:"Romania"},{code:"RU",name:"Russia"},{code:"RW",name:"Rwanda"},{code:"RE",name:"R&eacute;union"},{code:"BL",name:"Saint Barth&eacute;lemy"},{code:"SH",name:"Saint Helena"},{code:"KN",name:"Saint Kitts and Nevis"},{code:"LC",name:"Saint Lucia"},{code:"MF",name:"Saint Martin"},{code:"PM",name:"Saint Pierre and Miquelon"},{code:"VC",name:"Saint Vincent and the Grenadines"},{code:"WS",name:"Samoa"},{code:"SM",name:"San Marino"},{code:"SA",name:"Saudi Arabia"},{code:"SN",name:"Senegal"},{code:"RS",name:"Serbia"},{code:"CS",name:"Serbia and Montenegro"},{code:"SC",name:"Seychelles"},{code:"SL",name:"Sierra Leone"},{code:"SG",name:"Singapore"},{code:"SK",name:"Slovakia"},{code:"SI",name:"Slovenia"},{code:"SB",name:"Solomon Islands"},{code:"ZA",name:"South Africa"},{code:"GS",name:"South Georgia and the South Sandwich Islands"},{code:"KR",name:"South Korea"},{code:"ES",name:"Spain"},{code:"LK",name:"Sri Lanka"},{code:"SR",name:"Suriname"},{code:"SJ",name:"Svalbard and Jan Mayen"},{code:"SZ",name:"Swaziland"},{code:"SE",name:"Sweden"},{code:"CH",name:"Switzerland"},{code:"ST",name:"S&atilde;o Tom&eacute; and Pr&iacute;ncipe"},{code:"TW",name:"Taiwan"},{code:"TJ",name:"Tajikistan"},{code:"TZ",name:"Tanzania"},{code:"TH",name:"Thailand"},{code:"TG",name:"Togo"},{code:"TK",name:"Tokelau"},{code:"TO",name:"Tonga"},{code:"TT",name:"Trinidad and Tobago"},{code:"TA",name:"Tristan da Cunha"},{code:"TN",name:"Tunisia"},{code:"TR",name:"Turkey"},{code:"TM",name:"Turkmenistan"},{code:"TC",name:"Turks and Caicos Islands"},{code:"TV",name:"Tuvalu"},{code:"UM",name:"U.S. Minor Outlying Islands"},{code:"PU",name:"U.S. Miscellaneous Pacific Islands"},{code:"VI",name:"U.S. Virgin Islands"},{code:"UG",name:"Uganda"},{code:"UA",name:"Ukraine"},{code:"AE",name:"United Arab Emirates"},{code:"GB",name:"United Kingdom"},{code:"US",name:"United States"},{code:"UY",name:"Uruguay"},{code:"UZ",name:"Uzbekistan"},{code:"VU",name:"Vanuatu"},{code:"VA",name:"Vatican City"},{code:"VE",name:"Venezuela"},{code:"VN",name:"Vietnam"},{code:"WK",name:"Wake Island"},{code:"WF",name:"Wallis and Futuna"},{code:"EH",name:"Western Sahara"},{code:"YE",name:"Yemen"},{code:"ZM",name:"Zambia"},{code:"AX",name:"&angst;land Islandscode:"}]}])}),define("main/annual-upgrade",["base"],function(e){return e.controller("AnnualUpgradeController",["$scope","$http","$modal",function(e,t,n){var r="/user/subscription/upgrade-annual";e.upgradeComplete=!1;var o={student:"19.2",collaborator:"36"};return e.$watch(e.planName,function(){return e.yearlySaving=o[e.planName],"annual"===e.planName?e.upgradeComplete=!0:void 0}),e.completeAnnualUpgrade=function(){var n={planName:e.planName,_csrf:window.csrfToken};return e.inflight=!0,t.post(r,n).then(function(){return e.upgradeComplete=!0})["catch"](function(){return console.log("something went wrong changing plan")})}}])}),define("main/announcements",["base"],function(e){return e.controller("AnnouncementsController",["$scope","$http","event_tracking","$window","_",function(e,t,n,r,o){e.announcements=[],e.ui={isOpen:!1,newItems:0};var i=function(){return t.get("/announcements").then(function(t){return e.announcements=t.data,e.ui.newItems=o.filter(e.announcements,function(e){return!e.read}).length})},a=function(){return n.sendMB("announcement-alert-dismissed",{blogPostId:e.announcements[0].id})};return e.logAnnouncementClick=function(){return n.sendMB("announcement-read-more-clicked",{blogPostId:e.announcements[0].id})},i(),e.toggleAnnouncementsUI=function(){return e.ui.isOpen=!e.ui.isOpen,!e.ui.isOpen&&e.ui.newItems?(e.ui.newItems=0,a()):void 0},e.showAll=function(){return e.ui.newItems=0}}])}),define("main/register-users",["base"],function(e){return e.controller("RegisterUsersController",["$scope","queuedHttp",function(e,t){e.users=[],e.inputs={emails:""};var n=function(e){var t=/[\s,]+/,n=e.split(t);return n=_.map(n,function(e){return e=e.trim()}),n=_.select(n,function(e){return-1!==e.indexOf("@")})};return e.registerUsers=function(){var r=n(e.inputs.emails);return e.error=!1,Array.from(r).map(function(n){return t.post("/admin/register",{email:n,_csrf:window.csrfToken}).then(function(t){var n=t.data,r=n;return e.users.push(r),e.inputs.emails=""})["catch"](function(){return e.error=!0})})}}])}),define("main/subscription/team-invite-controller",["base"],function(e){return e.controller("TeamInviteController",["$scope","$http",function(e,t){return e.inflight=!1,hasIndividualRecurlySubscription?e.view="hasIndividualRecurlySubscription":e.view="teamInvite",e.keepPersonalSubscription=function(){return e.view="teamInvite"},e.cancelPersonalSubscription=function(){e.inflight=!0;var n=t.post("/user/subscription/cancel",{_csrf:window.csrfToken});return n.then(function(){return e.inflight=!1,e.view="teamInvite"}),n["catch"](function(){e.inflight=!1,e.cancel_error=!0,console.log("the request failed")})},e.joinTeam=function(){e.inflight=!0;var n=t.put("/subscription/invites/".concat(window.inviteToken,"/"),{_csrf:window.csrfToken});return n.then(function(t){var n=t.status;return e.inflight=!1,e.view="inviteAccepted",200!==n?e.requestSent=!1:void 0}),n["catch"](function(){return console.log("the request failed")})}}])}),function(){"use strict";function e(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function t(e,t,n){var o={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"7 / Server 2008 R2","6.0":"Vista / Server 2008",5.2:"XP 64-bit / Server 2003",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(o=o[/[\d.]+$/.exec(e)])&&(e="Windows "+o),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=r(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function n(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&v>=r)for(;++n<r;)t(e[n],n,e);else o(e,t)}function r(t){return t=c(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:e(t)}function o(e,t){for(var n in e)y.call(e,n)&&t(e[n],n,e)}function i(t){return null==t?e(t):w.call(t).slice(8,-1)}function a(e,t){var n=null!=e?typeof e[t]:"number";return!/^(?:boolean|number|string|undefined)$/.test(n)&&("object"==n?!!e[t]:!0)}function s(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function l(e,t){var r=null;return n(e,function(n,o){r=t(r,n,o,e)}),r}function c(e){return String(e).replace(/^ +| +$/g,"")}function u(e){function n(t){return l(t,function(t,n){return t||RegExp("\\b"+(n.pattern||s(n))+"\\b","i").exec(e)&&(n.label||n)})}function d(t){return l(t,function(t,n,r){return t||(n[X]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(X)]||RegExp("\\b"+s(r)+"(?:\\b|\\w*\\d)","i").exec(e))&&r})}function m(t){return l(t,function(t,n){return t||RegExp("\\b"+(n.pattern||s(n))+"\\b","i").exec(e)&&(n.label||n)})}function h(n){return l(n,function(n,r){var o=r.pattern||s(r);return!n&&(n=RegExp("\\b"+o+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(n=t(n,o,r.label||r)),n})}function g(t){return l(t,function(t,n){var o=n.pattern||s(n);return!t&&(t=RegExp("\\b"+o+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+o+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(o,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=r(t[0].replace(RegExp(o,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function v(t){return l(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}function b(){return this.description||""}var y=f,S=e&&"object"==typeof e&&"String"!=i(e);S&&(y=e,e=null);var C=y.navigator||{},x=C.userAgent||"";e||(e=x);var T,k,P=S||q==p,E=S?!!C.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(w.toString()),I="Object",F=S?I:"ScriptBridgingProxyObject",D=S?I:"Environment",M=S&&y.java?"JavaPackage":i(y.java),A=S?I:"RuntimeObject",U=/\bJava/.test(M)&&y.java,j=U&&i(y.environment)==D,O=U?"a":"α",R=U?"b":"β",$=y.document||{},B=y.operamini||y.opera,N=_.test(N=S&&B?B["[[Class]]"]:i(B))?N:B=null,L=e,H=[],z=null,G=e==x,W=G&&B&&"function"==typeof B.version&&B.version(),Y=n([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=m(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox Mobile",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),X=g([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),J=d({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),K=h(["Windows Phone ","Android","CentOS",{
label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(Y&&(Y=[Y]),J&&!X&&(X=g([J])),(T=/\bGoogle TV\b/.exec(X))&&(X=T[0]),/\bSimulator\b/i.test(e)&&(X=(X?X+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(e)&&H.push("running in Turbo/Uncompressed mode"),/^iP/.test(X)?(V||(V="Safari"),K="iOS"+((T=/ OS ([\d_]+)/i.exec(e))?" "+T[1].replace(/_/g,"."):"")):"Konqueror"!=V||/buntu/i.test(K)?J&&"Google"!=J&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(X))?(V="Android Browser",K=/\bAndroid\b/.test(K)?K:"Android"):"Silk"==V?(/\bMobi/i.test(e)||(K="Android",H.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&H.unshift("accelerated")):"PaleMoon"==V&&(T=/\bFirefox\/([\d.]+)\b/.exec(e))?H.push("identifying as Firefox "+T[1]):"Firefox"==V&&(T=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(K||(K="Firefox OS"),X||(X=T[1])):(!V||(T=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(V)))&&(V&&!X&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(T+"/")+8))&&(V=null),(T=X||J||K)&&(X||J||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(K))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(K)?K:T)+" Browser")):K="Kubuntu",W||(W=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",s(V),"(?:Firefox|Minefield|NetFront)"])),(T="iCab"==Y&&parseFloat(W)>3&&"WebKit"||/\bOpera\b/.test(V)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(Y)&&"WebKit"||!Y&&/\bMSIE\b/i.test(e)&&("Mac OS"==K?"Tasman":"Trident")||"WebKit"==Y&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(Y=[T]),"IE"==V&&(T=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(V+=" Mobile",K="Windows Phone "+(/\+$/.test(T)?T:T+".x"),H.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(V="IE Mobile",K="Windows Phone 8.x",H.unshift("desktop mode"),W||(W=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=V&&"Trident"==Y&&(T=/\brv:([\d.]+)/.exec(e))&&(V&&H.push("identifying as "+V+(W?" "+W:"")),V="IE",W=T[1]),G){if(a(y,"global"))if(U&&(T=U.lang.System,L=T.getProperty("os.arch"),K=K||T.getProperty("os.name")+" "+T.getProperty("os.version")),P&&a(y,"system")&&(T=[y.system])[0]){K||(K=T[0].os||null);try{T[1]=y.require("ringo/engine").version,W=T[1].join("."),V="RingoJS"}catch(Z){T[0].global.system==y.system&&(V="Narwhal")}}else"object"==typeof y.process&&(T=y.process)?(V="Node.js",L=T.arch,K=T.platform,W=/[\d.]+/.exec(T.version)[0]):j&&(V="Rhino");else i(T=y.runtime)==F?(V="Adobe AIR",K=T.flash.system.Capabilities.os):i(T=y.phantom)==A?(V="PhantomJS",W=(T=T.version||null)&&T.major+"."+T.minor+"."+T.patch):"number"==typeof $.documentMode&&(T=/\bTrident\/(\d+)/i.exec(e))&&(W=[W,$.documentMode],(T=+T[1]+4)!=W[1]&&(H.push("IE "+W[1]+" mode"),Y&&(Y[1]=""),W[1]=T),W="IE"==V?String(W[1].toFixed(1)):W[0]);K=K&&r(K)}W&&(T=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(W)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(G&&C.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(z=/b/i.test(T)?"beta":"alpha",W=W.replace(RegExp(T+"\\+?$"),"")+("beta"==z?R:O)+(/\d+\+?/.exec(T)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS)\b/.test(K)?V="Firefox Mobile":"Maxthon"==V&&W?W=W.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(X)?(K=null,"Xbox 360"==X&&/\bIEMobile\b/.test(e)&&H.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||X||/Browser|Mobi/.test(V))||"Windows CE"!=K&&!/Mobi/i.test(e)?"IE"==V&&G&&null===y.external?H.unshift("platform preview"):(/\bBlackBerry\b/.test(X)||/\bBB10\b/.test(e))&&(T=(RegExp(X.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||W)?(T=[T,/BB10/.test(e)],K=(T[1]?(X=null,J="BlackBerry"):"Device Software")+" "+T[0],W=null):this!=o&&"Wii"!=X&&(G&&B||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(K)||"IE"==V&&(K&&!/^Win/.test(K)&&W>5.5||/\bWindows XP\b/.test(K)&&W>8||8==W&&!/\bTrident\b/.test(e)))&&!_.test(T=u.call(o,e.replace(_,"")+";"))&&T.name&&(T="ing as "+T.name+((T=T.version)?" "+T:""),_.test(V)?(/\bIE\b/.test(T)&&"Mac OS"==K&&(K=null),T="identify"+T):(T="mask"+T,V=N?r(N.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(T)&&(K=null),G||(W=null)),Y=["Presto"],H.push(T)):V+=" Mobile",(T=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(T=[parseFloat(T.replace(/\.(\d)$/,".0$1")),T],"Safari"==V&&"+"==T[1].slice(-1)?(V="WebKit Nightly",z="alpha",W=T[1].slice(0,-1)):(W==T[1]||W==(T[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1]))&&(W=null),T[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==T[0]&&537.36==T[2]&&parseFloat(T[1])>=28&&"WebKit"==Y&&(Y=["Blink"]),G&&(E||T[1])?(Y&&(Y[1]="like Chrome"),T=T[1]||(T=T[0],530>T?1:532>T?2:532.05>T?3:533>T?4:534.03>T?5:534.07>T?6:534.1>T?7:534.13>T?8:534.16>T?9:534.24>T?10:534.3>T?11:535.01>T?12:535.02>T?"13+":535.07>T?15:535.11>T?16:535.19>T?17:536.05>T?18:536.1>T?19:537.01>T?20:537.11>T?"21+":537.13>T?23:537.18>T?24:537.24>T?25:537.36>T?26:"Blink"!=Y?"27":"28")):(Y&&(Y[1]="like Safari"),T=T[0],T=400>T?1:500>T?2:526>T?3:533>T?4:534>T?"4+":535>T?5:537>T?6:538>T?7:601>T?8:"8"),Y&&(Y[1]+=" "+(T+="number"==typeof T?".x":/[.+]/.test(T)?"":"+")),"Safari"==V&&(!W||parseInt(W)>45)&&(W=T)),"Opera"==V&&(T=/\bzbov|zvav$/.exec(K))?(V+=" ",H.unshift("desktop mode"),"zvav"==T?(V+="Mini",W=null):V+="Mobile",K=K.replace(RegExp(" *"+T+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(Y&&Y[1])&&(H.unshift("desktop mode"),V="Chrome Mobile",W=null,/\bOS X\b/.test(K)?(J="Apple",K="iOS 4.3+"):K=null),W&&0==W.indexOf(T=/[\d.]+$/.exec(K))&&e.indexOf("/"+T+"-")>-1&&(K=c(K.replace(T,""))),Y&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(K)&&/\bSafari\b/.test(Y[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(V)&&Y[1])&&(T=Y[Y.length-1])&&H.push(T),H.length&&(H=["("+H.join("; ")+")"]),J&&X&&X.indexOf(J)<0&&H.push("on "+J),X&&H.push((/^on /.test(H[H.length-1])?"":"on ")+X),K&&(T=/ ([\d.+]+)$/.exec(K)||(k=/^[a-z]+ ([\d.+]+) \//i.exec(K)),K={architecture:32,family:T&&!k?K.replace(T[0],""):K,version:T?T[1]:null,toString:function(){var e=this.version;return this.family+(e&&!k?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(T=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(L))&&!/\bi686\b/i.test(L)&&(K&&(K.architecture=64,K.family=K.family.replace(RegExp(" *"+T),"")),V&&(/\bWOW64\b/i.test(e)||G&&/\w(?:86|32)$/.test(C.cpuClass||C.platform)&&!/\bWin64; x64\b/i.test(e))&&H.unshift("32-bit")),e||(e=null);var Q={};return Q.description=e,Q.layout=Y&&Y[0],Q.manufacturer=J,Q.name=V,Q.prerelease=z,Q.product=X,Q.ua=e,Q.version=V&&W,Q.os=K||{architecture:null,family:null,version:null,toString:function(){return"null"}},Q.parse=u,Q.toString=b,Q.version&&H.unshift(W),Q.name&&H.unshift(V),K&&V&&(K!=String(K).split(" ")[0]||K!=V.split(" ")[0]&&!X)&&H.push(X?"("+K+")":"on "+K),H.length&&(Q.description=H.join(" ")),Q}var d={"function":!0,object:!0},f=d[typeof window]&&window||this,p=f,m=d[typeof exports]&&exports,h=d[typeof module]&&module&&!module.nodeType&&module,g=m&&h&&"object"==typeof global&&global;!g||g.global!==g&&g.window!==g&&g.self!==g||(f=g);var v=Math.pow(2,53)-1,_=/\bOpera/,q=this,b=Object.prototype,y=b.hasOwnProperty,w=b.toString;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("libs/platform",[],function(){return u()}):m&&h?o(u(),function(e,t){m[t]=e}):f.platform=u()}.call(this),define("main/contact-us",["base","libs/platform"],function(e,t){return e.controller("GroupPlanContactController",["$scope","$modal","$http",function(e,t,n){return e.form={},e.sent=!1,e.sending=!1,e.error=!1,e.contactUs=function(){if(null==e.form.email)return void console.log("email not set");e.sending=!0;var t=(Math.floor(65536*(1+Math.random())).toString(32),{_csrf:window.csrfToken,name:e.form.name||e.form.email,email:e.form.email,labels:"".concat(e.form.source," accounts"),message:"Please contact me with more details",subject:"".concat(e.form.name," - Group Enquiry - ").concat(e.form.position," - ").concat(e.form.university),inbox:"accounts"}),r=n.post("/support",t);return r["catch"](function(){return e.error=!0,e.$apply()}),r.then(function(t){return e.sent=!0,event_tracking.send("subscription-funnel","plans-page","group-inquiry-sent"),e.error=200!==t.status,e.$apply()})}}])}),define("directives/mathjax",["base"],function(e){return e.directive("mathjax",["$compile","$parse",function(e,t){return{link:function(n,r,o){if(MathJax&&MathJax.Hub){if(!t(o.mathjaxAllowHtml)(n)){var i=r.html(),a=e("<span ng-non-bindable></span>")({});r.html("").append(a),a.html(i)}if("no-single-dollar"!==o.delimiter){var s=MathJax.Hub.config&&MathJax.Hub.config.tex2jax.inlineMath,l=_.find(s,function(e){return"$"===e[0]&&"$"===e[1]});l||MathJax.Hub.Config({tex2jax:{inlineMath:s.concat([["$","$"]])}})}setTimeout(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,r.get(0)])},0)}}}}])}),define("services/algolia-search",["base"],function(e){return e.factory("algoliaSearch",function(){var e,t;if(null!=(null!=window.sharelatex?window.sharelatex.algolia:void 0)&&null!=__guard__(null!=window.sharelatex.algolia?window.sharelatex.algolia.indexes:void 0,function(e){return e.wiki})){var n=new AlgoliaSearch(null!=window.sharelatex.algolia?window.sharelatex.algolia.app_id:void 0,null!=window.sharelatex.algolia?window.sharelatex.algolia.api_key:void 0);t=n.initIndex(__guard__(null!=window.sharelatex.algolia?window.sharelatex.algolia.indexes:void 0,function(e){return e.wiki})),e=n.initIndex(__guard__(null!=window.sharelatex.algolia?window.sharelatex.algolia.indexes:void 0,function(e){return e.kb}))}var r={searchWiki:t?t.search.bind(t):null,searchKB:e?e.search.bind(e):null};return r})}),define("main/learn",["base","directives/mathjax","services/algolia-search"],function(e){return e.controller("SearchWikiController",["$scope","algoliaSearch","_","$modal",function(e,t,n,r){e.hits=[],e.hits_total=0,e.config_hits_per_page=20,e.processingSearch=!1,e.clearSearchText=function(){return e.searchQueryText="",i([])},e.safeApply=function(t){var n=e.$root.$$phase;return"$apply"===n||"$digest"===n?e.$eval(t):e.$apply(t)};var o=function(e){var t=e.kb?"how-to/":"latex/",n=encodeURIComponent(e.pageName.replace(/\s/g,"_")),r="";e.sectionName&&""!==e.sectionName&&(r="#"+e.sectionName.replace(/\s/g,"_"));var o=e._highlightResult.sectionName,i=e._highlightResult.pageName.value;o&&o.value&&""!==o&&(i+=" - "+o.value);var a=e._highlightResult.content.value;a=a.replace(/\n\n+/g,"\n\n");for(var s=a.split("\n"),l=[],c=0,u=Array.from(s);c<u.length;c++){var d=u[c];/^\[edit\]/.test(d)||(a+=d+"\n",/<em>/.test(d)&&l.push(d))}a=l.join("\n...\n");var f={name:i,url:"/learn/".concat(t).concat(n).concat(r),content:a};return f},i=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.safeApply(function(){e.hits=t,e.hits_total=n})};e.search=function(){e.processingSearch=!0;var r=e.searchQueryText;return null==r||0===r.length?void i([]):t.searchWiki(r,function(t,r){if(e.processingSearch=!1,0===r.hits.length)return i([]);var a=n.map(r.hits,o);return i(a,r.nbHits)},{hitsPerPage:e.config_hits_per_page})}}]),e.controller("LearnController",function(){})}),define("main/affiliations/components/affiliationForm",["base"],function(e){var t=function(e,t,n,r){var o=this;o.roles=[],o.departments=[],o.countries=[],o.universities=[];var i=[];o.addUniversityToSelection=function(e){return{name:e,isUserSuggested:!0}},o.handleFreeformInputChange=function(e,t){if(null!=e.search&&""!==e.search){var n=e.search;if(null!=(null!=e.tagging?e.tagging.fct:void 0)&&(n=e.tagging.fct(e.search)),null!=t){var r=_.find(e.items,function(n){return n[t]===e.search});null!=r&&(n=r)}return e.searchInput.scope().$broadcast("uis:select",n)}},r.getCountries().then(function(e){return o.countries=e}),r.getDefaultRoleHints().then(function(e){return o.roles=e}),r.getDefaultDepartmentHints().then(function(e){return i=e}),e.$watch("$ctrl.affiliationData.country",function(e,t){return null!=e&&e!==t?(o.affiliationData.university=null,o.affiliationData.role=null,o.affiliationData.department=null,r.getUniversitiesFromCountry(e).then(function(e){return o.universities=e})):void 0}),e.$watch("$ctrl.affiliationData.university",function(e,t){return null!=e&&e!==t&&(null!=e.departments?e.departments.length:void 0)>0?o.departments=_.uniq(e.departments):o.departments=i})};return t.$inject=["$scope","$element","$attrs","UserAffiliationsDataService"],e.component("affiliationForm",{bindings:{affiliationData:"=",showUniversityAndCountry:"<",showRoleAndDepartment:"<"},controller:t,templateUrl:"affiliationFormTpl"})}),define("main/affiliations/controllers/UserAffiliationsController",["base"],function(e){return e.controller("UserAffiliationsController",["$scope","UserAffiliationsDataService","$q","_",function(e,t,n,r){e.userEmails=[];var o=/([^@]+)@(.+)/,i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\ ".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA -Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a=function(e){var t=null!=e?e.match(o):void 0;return null!=t?{local:t[1],domain:t[2]}:{local:null,domain:null}};e.getEmailSuggestion=function(r){var o=a(r);return e.ui.isValidEmail=i.test(r),e.ui.isBlacklistedEmail=!1,e.ui.showManualUniversitySelectionUI=!1,null!=o.domain?(e.ui.isBlacklistedEmail=t.isDomainBlacklisted(o.domain),t.getUniversityDomainFromPartialDomainInput(o.domain).then(function(t){var r=a(e.newAffiliation.email);return r.domain===t.hostname?(e.newAffiliation.university=t.university,e.newAffiliation.department=t.department):(e.newAffiliation.university=null,e.newAffiliation.department=null),n.resolve("".concat(o.local,"@").concat(t.hostname))})["catch"](function(){return e.newAffiliation.university=null,e.newAffiliation.department=null,n.reject(null)})):(e.newAffiliation.university=null,e.newAffiliation.department=null,n.reject(null))},e.selectUniversityManually=function(){return e.newAffiliation.university=null,e.newAffiliation.department=null,e.ui.showManualUniversitySelectionUI=!0},e.changeAffiliation=function(n){return null!=__guard__(null!=n.affiliation?n.affiliation.institution:void 0,function(e){return e.id})&&t.getUniversityDetails(n.affiliation.institution.id).then(function(t){return e.affiliationToChange.university=t}),e.affiliationToChange.email=n.email,e.affiliationToChange.role=n.affiliation.role,e.affiliationToChange.department=n.affiliation.department},e.saveAffiliationChange=function(n){return n.affiliation.role=e.affiliationToChange.role,n.affiliation.department=e.affiliationToChange.department,s(),d(t.addRoleAndDepartment(n.email,n.affiliation.role,n.affiliation.department)).then(function(){return setTimeout(function(){return f()})})},e.cancelAffiliationChange=function(e){return s()},e.isChangingAffiliation=function(t){return e.affiliationToChange.email===t},e.showAddEmailForm=function(){return e.ui.showAddEmailUI=!0},e.addNewEmail=function(){var n;return n=null==e.newAffiliation.university?t.addUserEmail(e.newAffiliation.email):e.newAffiliation.university.isUserSuggested?t.addUserAffiliationWithUnknownUniversity(e.newAffiliation.email,e.newAffiliation.university.name,e.newAffiliation.country.code,e.newAffiliation.role,e.newAffiliation.department):t.addUserAffiliation(e.newAffiliation.email,e.newAffiliation.university.id,e.newAffiliation.role,e.newAffiliation.department),e.ui.isAddingNewEmail=!0,e.ui.showAddEmailUI=!1,d(n).then(function(){return l(),c(),setTimeout(function(){return f()})})["finally"](function(){return e.ui.isAddingNewEmail=!1})},e.setDefaultUserEmail=function(n){return d(t.setDefaultUserEmail(n.email)).then(function(){for(var t=0,r=Array.from(e.userEmails||[]);t<r.length;t++){var o=r[t];o["default"]=!1}return n["default"]=!0})},e.removeUserEmail=function(n){return e.userEmails=e.userEmails.filter(function(e){return e!==n}),d(t.removeUserEmail(n.email))},e.resendConfirmationEmail=function(n){return e.ui.isResendingConfirmation=!0,d(t.resendConfirmationEmail(n.email))["finally"](function(){return e.ui.isResendingConfirmation=!1})},e.acknowledgeError=function(){return u(),f()};var s=function(){return e.affiliationToChange={email:"",university:null,role:null,department:null}},l=function(){return e.newAffiliation={email:"",country:null,university:null,role:null,department:null}},c=function(){return e.ui.showAddEmailUI=!1,e.ui.isValidEmail=!1,e.ui.isBlacklistedEmail=!1,e.ui.showManualUniversitySelectionUI=!1},u=function(){return e.ui={hasError:!1,errorMessage:"",showChangeAffiliationUI:!1,isMakingRequest:!1,isLoadingEmails:!1,isAddingNewEmail:!1,isResendingConfirmation:!1},s(),l(),c()};u();var d=function(t){return e.ui.hasError=!1,e.ui.isMakingRequest=!0,t["catch"](function(t){return e.ui.hasError=!0,e.ui.errorMessage=__guard__(null!=t?t.data:void 0,function(e){return e.message})})["finally"](function(){return e.ui.isMakingRequest=!1}),t},f=function(){return e.ui.isLoadingEmails=!0,d(t.getUserEmails()).then(function(t){return e.userEmails=t})["finally"](function(){return e.ui.isLoadingEmails=!1})};return f()}])}),define("main/affiliations/factories/UserAffiliationsDataService",["base"],function(e){for(var t=[{code:"af",name:"Afghanistan"},{code:"ax",name:"Åland Islands"},{code:"al",name:"Albania"},{code:"dz",name:"Algeria"},{code:"as",name:"American Samoa"},{code:"ad",name:"Andorra"},{code:"ao",name:"Angola"},{code:"ai",name:"Anguilla"},{code:"aq",name:"Antarctica"},{code:"ag",name:"Antigua and Barbuda"},{code:"ar",name:"Argentina"},{code:"am",name:"Armenia"},{code:"aw",name:"Aruba"},{code:"au",name:"Australia"},{code:"at",name:"Austria"},{code:"az",name:"Azerbaijan"},{code:"bs",name:"Bahamas"},{code:"bh",name:"Bahrain"},{code:"bd",name:"Bangladesh"},{code:"bb",name:"Barbados"},{code:"by",name:"Belarus"},{code:"be",name:"Belgium"},{code:"bz",name:"Belize"},{code:"bj",name:"Benin"},{code:"bm",name:"Bermuda"},{code:"bt",name:"Bhutan"},{code:"bo",name:"Bolivia"},{code:"bq",name:"Bonaire, Saint Eustatius and Saba"},{code:"ba",name:"Bosnia and Herzegovina"},{code:"bw",name:"Botswana"},{code:"bv",name:"Bouvet Island"},{code:"br",name:"Brazil"},{code:"io",name:"British Indian Ocean Territory"},{code:"vg",name:"British Virgin Islands"},{code:"bn",name:"Brunei"},{code:"bg",name:"Bulgaria"},{code:"bf",name:"Burkina Faso"},{code:"bi",name:"Burundi"},{code:"kh",name:"Cambodia"},{code:"cm",name:"Cameroon"},{code:"ca",name:"Canada"},{code:"cv",name:"Cabo Verde"},{code:"ky",name:"Cayman Islands"},{code:"cf",name:"Central African Republic"},{code:"td",name:"Chad"},{code:"cl",name:"Chile"},{code:"cn",name:"China"},{code:"cx",name:"Christmas Island"},{code:"cc",name:"Cocos (Keeling) Islands"},{code:"co",name:"Colombia"},{code:"km",name:"Comoros"},{code:"cg",name:"Congo"},{code:"ck",name:"Cook Islands"},{code:"cr",name:"Costa Rica"},{code:"ci",name:"Côte d'Ivoire"},{code:"hr",name:"Croatia"},{code:"cu",name:"Cuba"},{code:"cw",name:"Curaçao"},{code:"cy",name:"Cyprus"},{code:"cz",name:"Czech Republic"},{code:"kp",name:"Democratic People's Republic of Korea"},{code:"cd",name:"Democratic Republic of the Congo"},{code:"dk",name:"Denmark"},{code:"dj",name:"Djibouti"},{code:"dm",name:"Dominica"},{code:"do",name:"Dominican Republic"},{code:"ec",name:"Ecuador"},{code:"eg",name:"Egypt"},{code:"sv",name:"El Salvador"},{code:"gq",name:"Equatorial Guinea"},{code:"er",name:"Eritrea"},{code:"ee",name:"Estonia"},{code:"et",name:"Ethiopia"},{code:"fk",name:"Falkland Islands (Malvinas)"},{code:"fo",name:"Faroe Islands"},{code:"fj",name:"Fiji"},{code:"fi",name:"Finland"},{code:"fr",name:"France"},{code:"gf",name:"French Guiana"},{code:"pf",name:"French Polynesia"},{code:"tf",name:"French Southern Territories"},{code:"ga",name:"Gabon"},{code:"gm",name:"Gambia"},{code:"ge",name:"Georgia"},{code:"de",name:"Germany"},{code:"gh",name:"Ghana"},{code:"gi",name:"Gibraltar"},{code:"gr",name:"Greece"},{code:"gl",name:"Greenland"},{code:"gd",name:"Grenada"},{code:"gp",name:"Guadeloupe"},{code:"gu",name:"Guam"},{code:"gt",name:"Guatemala"},{code:"gg",name:"Guernsey"},{code:"gn",name:"Guinea"},{code:"gw",name:"Guinea-Bissau"},{code:"gy",name:"Guyana"},{code:"ht",name:"Haiti"},{code:"hm",name:"Heard Island and McDonald Islands"},{code:"va",name:"Holy See (Vatican City)"},{code:"hn",name:"Honduras"},{code:"hk",name:"Hong Kong"},{code:"hu",name:"Hungary"},{code:"is",name:"Iceland"},{code:"in",name:"India"},{code:"id",name:"Indonesia"},{code:"ir",name:"Iran"},{code:"iq",name:"Iraq"},{code:"ie",name:"Ireland"},{code:"im",name:"Isle of Man"},{code:"il",name:"Israel"},{code:"it",name:"Italy"},{code:"jm",name:"Jamaica"},{code:"jp",name:"Japan"},{code:"je",name:"Jersey"},{code:"jo",name:"Jordan"},{code:"kz",name:"Kazakhstan"},{code:"ke",name:"Kenya"},{code:"ki",name:"Kiribati"},{code:"xk",name:"Kosovo"},{code:"kw",name:"Kuwait"},{code:"kg",name:"Kyrgyzstan"},{code:"la",name:"Laos"},{code:"lv",name:"Latvia"},{code:"lb",name:"Lebanon"},{code:"ls",name:"Lesotho"},{code:"lr",name:"Liberia"},{code:"ly",name:"Libya"},{code:"li",name:"Liechtenstein"},{code:"lt",name:"Lithuania"},{code:"lu",name:"Luxembourg"},{code:"mo",name:"Macao"},{code:"mk",name:"Macedonia"},{code:"mg",name:"Madagascar"},{code:"mw",name:"Malawi"},{code:"my",name:"Malaysia"},{code:"mv",name:"Maldives"},{code:"ml",name:"Mali"},{code:"mt",name:"Malta"},{code:"mh",name:"Marshall Islands"},{code:"mq",name:"Martinique"},{code:"mr",name:"Mauritania"},{code:"mu",name:"Mauritius"},{code:"yt",name:"Mayotte"},{code:"mx",name:"Mexico"},{code:"fm",name:"Micronesia"},{code:"md",name:"Moldova"},{code:"mc",name:"Monaco"},{code:"mn",name:"Mongolia"},{code:"me",name:"Montenegro"},{code:"ms",name:"Montserrat"},{code:"ma",name:"Morocco"},{code:"mz",name:"Mozambique"},{code:"mm",name:"Myanmar"},{code:"na",name:"Namibia"},{code:"nr",name:"Nauru"},{code:"np",name:"Nepal"},{code:"nl",name:"Netherlands"},{code:"an",name:"Netherlands Antilles"},{code:"nc",name:"New Caledonia"},{code:"nz",name:"New Zealand"},{code:"ni",name:"Nicaragua"},{code:"ne",name:"Niger"},{code:"ng",name:"Nigeria"},{code:"nu",name:"Niue"},{code:"nf",name:"Norfolk Island"},{code:"mp",name:"Northern Mariana Islands"},{code:"no",name:"Norway"},{code:"om",name:"Oman"},{code:"pk",name:"Pakistan"},{code:"pw",name:"Palau"},{code:"ps",name:"Palestine"},{code:"pa",name:"Panama"},{code:"pg",name:"Papua New Guinea"},{code:"py",name:"Paraguay"},{code:"pe",name:"Peru"},{code:"ph",name:"Philippines"},{code:"pn",name:"Pitcairn"},{code:"pl",name:"Poland"},{code:"pt",name:"Portugal"},{code:"pr",name:"Puerto Rico"},{code:"qa",name:"Qatar"},{code:"kr",name:"Republic of Korea"},{code:"re",name:"Réunion"},{code:"ro",name:"Romania"},{code:"ru",name:"Russia"},{code:"rw",name:"Rwanda"},{code:"bl",name:"Saint Barthélemy"},{code:"sh",name:"Saint Helena, Ascension and Tristan da Cunha"},{code:"kn",name:"Saint Kitts and Nevis"},{code:"lc",name:"Saint Lucia"},{code:"mf",name:"Saint Martin"},{code:"pm",name:"Saint Pierre and Miquelon"},{code:"vc",name:"Saint Vincent and the Grenadines"},{code:"ws",name:"Samoa"},{code:"sm",name:"San Marino"},{code:"st",name:"Sao Tome and Principe"},{code:"sa",name:"Saudi Arabia"},{code:"sn",name:"Senegal"},{code:"rs",name:"Serbia"},{code:"sc",name:"Seychelles"},{code:"sl",name:"Sierra Leone"},{code:"sg",name:"Singapore"},{code:"sx",name:"Sint Maarten"},{code:"sk",name:"Slovakia"},{code:"si",name:"Slovenia"},{code:"sb",name:"Solomon Islands"},{code:"so",name:"Somalia"},{code:"za",name:"South Africa"},{code:"gs",name:"South Georgia and the South Sandwich Islands"},{code:"ss",name:"South Sudan"},{code:"es",name:"Spain"},{code:"lk",name:"Sri Lanka"},{code:"sd",name:"Sudan"},{code:"sr",name:"Suriname"},{code:"sj",name:"Svalbard and Jan Mayen"},{code:"sz",name:"Swaziland"},{code:"se",name:"Sweden"},{code:"ch",name:"Switzerland"},{code:"sy",name:"Syria"},{code:"tw",name:"Taiwan"},{code:"tj",name:"Tajikistan"},{code:"tz",name:"Tanzania"},{code:"th",name:"Thailand"},{code:"tl",name:"Timor-Leste"},{code:"tg",name:"Togo"},{code:"tk",name:"Tokelau"},{code:"to",name:"Tonga"},{code:"tt",name:"Trinidad and Tobago"},{code:"tn",name:"Tunisia"},{code:"tr",name:"Turkey"},{code:"tm",name:"Turkmenistan"},{code:"tc",name:"Turks and Caicos Islands"},{code:"tv",name:"Tuvalu"},{code:"vi",name:"U.S. Virgin Islands"},{code:"ug",name:"Uganda"},{code:"ua",name:"Ukraine"},{code:"ae",name:"United Arab Emirates"},{code:"gb",name:"United Kingdom"},{code:"us",name:"United States of America"},{code:"um",name:"United States Minor Outlying Islands"},{code:"uy",name:"Uruguay"},{code:"uz",name:"Uzbekistan"},{code:"vu",name:"Vanuatu"},{code:"ve",name:"Venezuela"},{code:"vn",name:"Vietnam"},{code:"wf",name:"Wallis and Futuna"},{code:"eh",name:"Western Sahara"},{code:"ye",name:"Yemen"},{code:"zm",name:"Zambia"},{code:"zw",name:"Zimbabwe"}],n={},r={},o=["Undergraduate Student","Masters Student (MSc, MA, ...)","Doctoral Student (PhD, EngD, ...)","Postdoc","Lecturer","Senior Lecturer","Reader","Associate Professor ","Assistant Professor ","Professor","Emeritus Professor"],i=["Aeronautics & Astronautics","Anesthesia","Anthropology","Applied Physics","Art & Art History","Biochemistry","Bioengineering","Biology","Business School Library","Business, Graduate School of","Cardiothoracic Surgery","Chemical and Systems Biology","Chemical Engineering","Chemistry","Civil & Environmental Engineering","Classics","Communication","Comparative Literature","Comparative Medicine","Computer Science","Dermatology","Developmental Biology","Earth System Science","East Asian Languages and Cultures","Economics","Education, School of","Electrical Engineering","Energy Resources Engineering","English","French and Italian","Genetics","Geological Sciences","Geophysics","German Studies","Health Research & Policy","History","Iberian & Latin American Cultures","Law Library","Law School","Linguistics","Management Science & Engineering","Materials Science & Engineering","Mathematics","Mechanical Engineering","Medical Library","Medicine","Microbiology & Immunology","Molecular & Cellular Physiology","Music","Neurobiology","Neurology & Neurological Sciences","Neurosurgery","Obstetrics and Gynecology","Ophthalmology","Orthopaedic Surgery","Otolaryngology (Head and Neck Surgery)","Pathology","Pediatrics","Philosophy","Physics","Political Science","Psychiatry and Behavioral Sciences","Psychology","Radiation Oncology","Radiology","Religious Studies","Slavic Languages and Literature","Sociology","University Libraries","Statistics","Structural Biology","Surgery","Theater and Performance Studies","Urology"],a={"overleaf.com":!0},s=["br","cn","co","co.jp","co.uk","com","com.au","de","fr","in","info","io","net","no","ru","se","us","com.tw","com.br","pl","it","co.in","com.mx"],l=["gmail","googlemail","icloud","me","yahoo","ymail","yahoomail","hotmail","live","msn","outlook","gmx","mail","aol","163","mac","qq","o2","libero","126"],c=0,u=Array.from(l);c<u.length;c++)for(var d=u[c],f=0,p=Array.from(s);f<p.length;f++){var m=p[f];a["".concat(d,".").concat(m)]=!0}return e.factory("UserAffiliationsDataService",["$http","$q","_",function(e,s,l){var c=function(){return s.resolve(t)},u=function(){return s.resolve(o)},d=function(){return s.resolve(i)},f=function(){return e.get("/user/emails").then(function(e){return e.data})},p=function(){return f().then(function(e){return l.find(e,function(e){return e["default"]})})},m=function(t){var r;return r=null!=n[t.code]?n[t.code]:e.get("/institutions/list",{params:{country_code:t.code}}).then(function(e){return n[t.code]=e.data}),s.resolve(r)},h=function(t){return null!=r[t]?s.resolve(r[t]):e.get("/institutions/domains",{params:{hostname:t,limit:1}}).then(function(e){var t=e.data[0];return null==t||C(t.hostname)?s.reject(null):(r[t.hostname]=t,s.resolve(t))})},g=function(t){return e.get("/institutions/list/".concat(t)).then(function(e){return e.data})},v=function(t){return e.post("/user/emails",{email:t,_csrf:window.csrfToken})},_=function(t,n,r,o,i){return e.post("/user/emails",{email:t,university:{name:n,country_code:r},role:o,department:i,_csrf:window.csrfToken})},q=function(t,n,r,o){return e.post("/user/emails",{email:t,university:{id:n},role:r,department:o,_csrf:window.csrfToken})},b=function(t,n,r){return e.post("/user/emails/endorse",{email:t,role:n,department:r,_csrf:window.csrfToken})},y=function(t){return e.post("/user/emails/default",{email:t,_csrf:window.csrfToken})},w=function(t){return e.post("/user/emails/delete",{email:t,_csrf:window.csrfToken})},S=function(t){return e.post("/user/emails/resend_confirmation",{email:t,_csrf:window.csrfToken})},C=function(e){return e.toLowerCase()in a};return{getCountries:c,getDefaultRoleHints:u,getDefaultDepartmentHints:d,getUserEmails:f,getUserDefaultEmail:p,getUniversitiesFromCountry:m,getUniversityDomainFromPartialDomainInput:h,getUniversityDetails:g,addUserEmail:v,addUserAffiliationWithUnknownUniversity:_,addUserAffiliation:q,addRoleAndDepartment:b,setDefaultUserEmail:y,removeUserEmail:w,resendConfirmationEmail:S,isDomainBlacklisted:C}}])}),define("main/oauth/controllers/UserOauthController",["base"],function(e){return e.controller("UserOauthController",["$http","$scope","$q",function(e,t,n){var r=function(){t.ui={hasError:!1,errorMessage:""},t.providers=window.oauthProviders,t.thirdPartyIds=window.thirdPartyIds},o=function(e,n){t.providers[e].ui.hasError=!0,t.providers[e].ui.errorMessage=n&&n.data&&n.data.message?n.data.message:"error"};t.unlink=function(n){if(window.ExposedSettings.isOverleaf){t.providers[n].ui={hasError:!1,isProcessing:!0};var r={_csrf:window.csrfToken,link:!1,providerId:n};e.post("/user/oauth-unlink",r)["catch"](function(e){t.providers[n].ui.isProcessing=!1,o(n,e)}).then(function(e){t.providers[n].ui.isProcessing=!1,200===e.status?t.thirdPartyIds[n]=null:o(n,e)})}},r()}])}),define("main/keys",["base"],function(e){return e.constant("Keys",{ENTER:13,TAB:9,ESCAPE:27,SPACE:32,BACKSPACE:8,UP:38,DOWN:40,LEFT:37,RIGHT:39,PERIOD:190,COMMA:188,END:35})}),define("main/importing",["base"],function(e){e.controller("ImportingController",["$interval","$scope","$timeout","$window",function(e,t,n,r){e(function(){t.state.load_progress+=5,t.state.load_progress>100&&(t.state.load_progress=20)},500),n(function(){r.location.reload()},5e3),t.state={load_progress:20}}])});var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},o=function(){},i=r.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;e>o;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-8*(o%4)&255)<<24-8*((r+o)%4);else if(65535<n.length)for(o=0;e>o;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;t>r;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++){var o=t[r>>>2]>>>24-8*(r%4)&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new a.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));
return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new a.init(n,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,s=o/(4*i),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*i,o=e.min(4*t,o),t){for(var l=0;t>l;l+=i)this._doProcessBlock(r,l);l=r.splice(0,t),n.sigBytes-=o}return new a.init(l,o)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=d.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){function t(e,t,n,r,o,i,a){return e=e+(t&n|~t&r)+o+a,(e<<i|e>>>32-i)+t}function n(e,t,n,r,o,i,a){return e=e+(t&r|n&~r)+o+a,(e<<i|e>>>32-i)+t}function r(e,t,n,r,o,i,a){return e=e+(t^n^r)+o+a,(e<<i|e>>>32-i)+t}function o(e,t,n,r,o,i,a){return e=e+(n^(t|~r))+o+a,(e<<i|e>>>32-i)+t}for(var i=CryptoJS,a=i.lib,s=a.WordArray,l=a.Hasher,a=i.algo,c=[],u=0;64>u;u++)c[u]=4294967296*e.abs(e.sin(u+1))|0;a=a.MD5=l.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var a=0;16>a;a++){var s=i+a,l=e[s];e[s]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var a=this._hash.words,s=e[i+0],l=e[i+1],u=e[i+2],d=e[i+3],f=e[i+4],p=e[i+5],m=e[i+6],h=e[i+7],g=e[i+8],v=e[i+9],_=e[i+10],q=e[i+11],b=e[i+12],y=e[i+13],w=e[i+14],S=e[i+15],C=a[0],x=a[1],T=a[2],k=a[3],C=t(C,x,T,k,s,7,c[0]),k=t(k,C,x,T,l,12,c[1]),T=t(T,k,C,x,u,17,c[2]),x=t(x,T,k,C,d,22,c[3]),C=t(C,x,T,k,f,7,c[4]),k=t(k,C,x,T,p,12,c[5]),T=t(T,k,C,x,m,17,c[6]),x=t(x,T,k,C,h,22,c[7]),C=t(C,x,T,k,g,7,c[8]),k=t(k,C,x,T,v,12,c[9]),T=t(T,k,C,x,_,17,c[10]),x=t(x,T,k,C,q,22,c[11]),C=t(C,x,T,k,b,7,c[12]),k=t(k,C,x,T,y,12,c[13]),T=t(T,k,C,x,w,17,c[14]),x=t(x,T,k,C,S,22,c[15]),C=n(C,x,T,k,l,5,c[16]),k=n(k,C,x,T,m,9,c[17]),T=n(T,k,C,x,q,14,c[18]),x=n(x,T,k,C,s,20,c[19]),C=n(C,x,T,k,p,5,c[20]),k=n(k,C,x,T,_,9,c[21]),T=n(T,k,C,x,S,14,c[22]),x=n(x,T,k,C,f,20,c[23]),C=n(C,x,T,k,v,5,c[24]),k=n(k,C,x,T,w,9,c[25]),T=n(T,k,C,x,d,14,c[26]),x=n(x,T,k,C,g,20,c[27]),C=n(C,x,T,k,y,5,c[28]),k=n(k,C,x,T,u,9,c[29]),T=n(T,k,C,x,h,14,c[30]),x=n(x,T,k,C,b,20,c[31]),C=r(C,x,T,k,p,4,c[32]),k=r(k,C,x,T,g,11,c[33]),T=r(T,k,C,x,q,16,c[34]),x=r(x,T,k,C,w,23,c[35]),C=r(C,x,T,k,l,4,c[36]),k=r(k,C,x,T,f,11,c[37]),T=r(T,k,C,x,h,16,c[38]),x=r(x,T,k,C,_,23,c[39]),C=r(C,x,T,k,y,4,c[40]),k=r(k,C,x,T,s,11,c[41]),T=r(T,k,C,x,d,16,c[42]),x=r(x,T,k,C,m,23,c[43]),C=r(C,x,T,k,v,4,c[44]),k=r(k,C,x,T,b,11,c[45]),T=r(T,k,C,x,S,16,c[46]),x=r(x,T,k,C,u,23,c[47]),C=o(C,x,T,k,s,6,c[48]),k=o(k,C,x,T,h,10,c[49]),T=o(T,k,C,x,w,15,c[50]),x=o(x,T,k,C,p,21,c[51]),C=o(C,x,T,k,b,6,c[52]),k=o(k,C,x,T,d,10,c[53]),T=o(T,k,C,x,_,15,c[54]),x=o(x,T,k,C,l,21,c[55]),C=o(C,x,T,k,g,6,c[56]),k=o(k,C,x,T,S,10,c[57]),T=o(T,k,C,x,m,15,c[58]),x=o(x,T,k,C,y,21,c[59]),C=o(C,x,T,k,f,6,c[60]),k=o(k,C,x,T,q,10,c[61]),T=o(T,k,C,x,u,15,c[62]),x=o(x,T,k,C,v,21,c[63]);a[0]=a[0]+C|0,a[1]=a[1]+x|0,a[2]=a[2]+T|0,a[3]=a[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var i=e.floor(r/4294967296);for(n[(o+64>>>9<<4)+15]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[(o+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)o=n[r],n[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=l._createHelper(a),i.HmacMD5=l._createHmacHelper(a)}(Math),define("libs/md5",function(){}),define("analytics/AbTestingManager",["base","libs/md5"],function(e){var t=["sl_abt_multi_currency_editor_eu-eu","sl_abt_multi_currency_eu-eu","sl_abt_multi_currency_editor_eu-usd","sl_abt_multi_currency_eu-usd","sl_abt_trial_len_14d","sl_abt_trial_len_7d","sl_abt_trial_len_30d","sl_utt","sl_utt_trial_len","sl_utt_multi_currency"];return e.factory("abTestManager",["$http","ipCookie",function(e,n){var r,o;_.each(t,function(e){return n.remove(e)});var i=function(e,t){var n="sl_abt_".concat(e,"_").concat(t);return n},a=function(e,t){var r=i(e,t),o=n(r);return o},s=function(e,t,r){var o=i(e,t);return n(o,{step:r},{expires:100,path:"/"}),ga("send","event","ab_tests","".concat(e,":").concat(t),"step-".concat(r))},l=function(e,t){return null==e&&0!==t?!1:0===t?!0:e+1===t?!0:!1},c=function(e){var t="sl_utt_".concat(e),r=n(t);null==r&&(r=Math.random(),n(t,r,{expires:365,path:"/"}));var o=CryptoJS.MD5("".concat(r,":").concat(e));return o};return{processTestWithStep:o=function(e,t,n){var r=__guard__(a(e,t),function(e){return e.step});return l(r,n)?s(e,t,n):void 0},getABTestBucket:r=function(e,t){var n=c(e),r=parseInt(n.toString().slice(0,2),16)%((null!=t?t.length:void 0)||2);return t[r]}}}]),e.controller("AbTestController",["$scope","abTestManager",function(e,t){_.keys(window.ab);return _.each(window.ab,function(e){return t.processTestWithStep(e.testName,e.bucket,e.step)})}])}),define("directives/autoSubmitForm",["base"],function(e){e.directive("autoSubmitForm",function(){return{link:function(e,t){t.submit()}}})}),define("directives/asyncForm",["base","libs/passfield"],function(e){e.directive("asyncForm",["$http","validateCaptcha","validateCaptchaV3",function(e,t,n){return{controller:["$scope",function(e){return this.getEmail=function(){return e.email},this}],link:function(r,o,i){var a,s=i.asyncForm;r[i.name].response=a={},r[i.name].inflight=!1;var l=function(e){return null==e&&(e=function(e){}),i.captchaActionName&&n(i.captchaActionName),null!=i.captcha?t(e):e()},c=function(e){for(var t={},n=0,l=Array.from(o.serializeArray());n<l.length;n++){var c=l[n];t[c.name]=c.value}null!=e&&(t["g-recaptcha-response"]=e),r[i.name].inflight=!0;var u=d(o.attr("method"));return u(o.attr("action"),t,{disableAutoLoginRedirect:!0}).then(function(e){var t=e.data,n=e.headers;r[i.name].inflight=!1,a.success=!0,a.error=!1;var o=r[i.onSuccess];if(o)return void o(e);if(null!=t.redir)return ga("send","event",s,"success"),window.location=t.redir;if(null!=t.message)return a.message=t.message,"error"===t.message.type?(a.success=!1,a.error=!0,ga("send","event",s,"failure",t.message)):ga("send","event",s,"success");if(r.$eval(i.asyncFormDownloadResponse)){var l=new Blob([t],{type:n("Content-Type")});location.href=URL.createObjectURL(l)}})["catch"](function(e){var t,n,o;c=e.data,o=e.status,n=e.headers,t=e.config,r[i.name].inflight=!1,a.success=!1,a.error=!0,a.status=o,a.data=c;var l=r[i.onError];return l?void l(e):(400===o&&c.accountLinkingError?a.message={text:c.accountLinkingError,type:"error"}:400===o?a.message={text:"Invalid Request. Please correct the data and try again.",type:"error"}:403===o?a.message={text:"Session error. Please check you have cookies enabled. If the problem persists, try clearing your cache and cookies.",type:"error"}:429===o?a.message={text:"Too many attempts. Please wait for a while and try again.",type:"error"}:a.message={text:(null!=c.message?c.message.text:void 0)||c.message||"Something went wrong talking to the server :(. Please try again.",type:"error"},ga("send","event",s,"failure",c.message))})},u=function(){return l(function(e){return c(e)})},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"post",n={post:e.post,get:e.get};return n[t.toLowerCase()]};return o.on("submit",function(e){return e.preventDefault(),u()}),i.autoSubmit?u():void 0}}}]),e.directive("formMessages",function(){return{restrict:"E",template:"<div class=\"alert\" ng-class=\"{\n  'alert-danger': form.response.message.type == 'error',\n  'alert-success': form.response.message.type != 'error'\n}\" ng-show=\"!!form.response.message\" ng-bind-html=\"form.response.message.text\">\n</div>\n<div ng-transclude></div>",transclude:!0,scope:{form:"=for"}}})}),define("directives/complexPassword",["base","libs/passfield"],function(e){e.directive("complexPassword",function(){return{require:["^asyncForm","ngModel"],link:function(e,t,n,r){PassField.Config.blackList=[];var o={pattern:"",length:{min:6,max:72},allowEmpty:!1,allowAnyChars:!1,isMasked:!0,showToggle:!1,showGenerate:!1,showTip:!1,showWarn:!1,checkMode:PassField.CheckModes.STRICT,chars:{digits:"1234567890",letters:"abcdefghijklmnopqrstuvwxyz",letters_up:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",symbols:"@#$%^&*()-_=+[]{};:<>/?!£€.,"}},i=_.defaults(window.passwordStrengthOptions||{},o);1===i.length.min&&(i.acceptRate=0),i.length.max>72&&(i.length.max=72),i.length.max>0&&(i.length.max+=1);var a=new PassField.Field("passwordField",i),s=Array.from(r),l=_slicedToArray(s,2),c=l[0],u=l[1];u.$parsers.unshift(function(t){var n=a.validatePass(),r=c.getEmail()||window.usersEmail;if(n){if("string"==typeof r&&""!==r){var o=r.split("@")[0];(-1!==t.indexOf(r)||-1!==t.indexOf(o))&&(n=!1,e.complexPasswordErrorMessage="Password can not contain email address")}}else e.complexPasswordErrorMessage=a.getPassValidationMessage();return null!=i.length.max&&t.length>=i.length.max&&(n=!1,e.complexPasswordErrorMessage="Maximum password length ".concat(i.length.max-1," exceeded")),null!=i.length.min&&t.length<i.length.min&&(n=!1,e.complexPasswordErrorMessage="Password too short, minimum ".concat(i.length.min)),u.$setValidity("complexPassword",n),t})}}})}),define("directives/stopPropagation",["base"],function(e){return e.directive("stopPropagation",["$http",function(e){return{restrict:"A",link:function(e,t,n){return t.bind(n.stopPropagation,function(e){return e.stopPropagation()})}}}]),e.directive("preventDefault",["$http",function(e){return{restrict:"A",link:function(e,t,n){return t.bind(n.preventDefault,function(e){return e.preventDefault()})}}}])}),define("directives/focus",["base"],function(e){var t;e.directive("focusWhen",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){return t.$watch(r.focusWhen,function(t){return t?e(function(){return n.focus()}):void 0})}}}]),e.directive("focusOn",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){return e.$on(n.focusOn,function(){return t.focus()})}}}]),e.directive("selectWhen",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){return t.$watch(r.selectWhen,function(t){return t?e(function(){return n.select()}):void 0})}}}]),e.directive("selectOn",["$timeout",function(e){return{restrict:"A",link:function(e,t,n){return e.$on(n.selectOn,function(){return t.select()})}}}]),e.directive("selectNameWhen",["$timeout",function(e){return{restrict:"A",link:function(n,r,o){return n.$watch(o.selectNameWhen,function(n){return n?e(function(){return t(r)}):void 0})}}}]),e.directive("selectNameOn",function(){return{restrict:"A",link:function(e,n,r){return e.$on(r.selectNameOn,function(){return t(n)})}}}),e.directive("focus",["$timeout",function(e){return{scope:{trigger:"@focus"},link:function(t,n){return t.$watch("trigger",function(t){return"true"===t?e(function(){return n[0].focus()}):void 0})}}}]),t=function(e){e.focus();var t=e.val();if(null!=e[0].setSelectionRange){var n=t.lastIndexOf(".");return-1===n&&(n=t.length),e[0].setSelectionRange(0,n)}}}),define("directives/equals",["base"],function(e){return e.directive("equals",function(){return{require:"ngModel",link:function(e,t,n,r){var o="#".concat(n.equals);return t.add(o).on("keyup",function(){return e.$apply(function(){var e=t.val()===$(o).val();return r.$setValidity("areEqual",e)})})}}})});var isInViewport=function(e){var t=e.offset().top,n=t+e.outerHeight(),r=$(window).scrollTop(),o=r+$(window).height();return n>r&&o>t};define("directives/eventTracking",["base"],function(e){return e.directive("eventTracking",["event_tracking",function(e){return{scope:{eventTracking:"@",eventSegmentation:"=?"},link:function(t,n,r){var o=r.eventTrackingGa||!1,i=r.eventTrackingMb||!1,a=r.eventTrackingSendOnce?"sendMBOnce":"sendMB",s=r.eventTrackingSendOnce?"sendGAOnce":"send",l=t.eventSegmentation||{};l.page=window.location.pathname;var c=function(n){return i&&e[a](t.eventTracking,l),o&&e[s](r.eventTrackingGa,r.eventTrackingAction||t.eventTracking,r.eventTrackingLabel||""),n?$(window).unbind("resize scroll"):void 0};if("load"===r.eventTrackingTrigger)return c();if("click"===r.eventTrackingTrigger)return n.on("click",function(e){return c()});if("hover"===r.eventTrackingTrigger){var u=null,d=500;return r.eventHoverAmt&&(d=parseInt(r.eventHoverAmt,10)),n.on("mouseenter",function(){u=setTimeout(function(){return c()},d)}).on("mouseleave",function(){return clearTimeout(u)})}return"scroll"!==r.eventTrackingTrigger||e.eventInCache(t.eventTracking)?void 0:$(window).on("resize scroll",function(){return _.throttle(isInViewport(n)&&!e.eventInCache(t.eventTracking)?c(!0):void 0,500)})}}}])}),function(global){var qq=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(null==e.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t,n){var r=new RegExp("(^| )"+t+"( |$)");return r.test(e.className)||!(!n||!r.test(e.parentNode.className))},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,n){var r,o=[];return n&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(r=e.getElementsByTagName("*"),qq.each(r,function(e,n){qq(n).hasClass(t)&&o.push(n)}),n?o[0]:o)},getFirstByClass:function(t){return qq(e).getByClass(t,!0)},children:function(){for(var t=[],n=e.firstChild;n;)1===n.nodeType&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?null==/^false$/i.exec(e.getAttribute(t)):!1:(n=e[t],void 0===n?!1:null==/^false$/i.exec(n))}}};!function(){"use strict";qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r,o,i=function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})};return n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),r=new Uint8Array(t),qq.each(n,function(e,t){r[e]=t.charCodeAt(0)}),i(t,o)},qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qq.isFunction=function(e){return"function"==typeof e},qq.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qq.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qq.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(e,t){var o=n.substring(0,r),i=n.substring(r+2);return n=o+t+i,r=n.indexOf("{}",r+t.length),0>r?!1:void 0}),n},qq.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qq.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type)?!0:e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type)?!0:!1},qq.isBlob=function(e){return window.Blob&&"[object Blob]"===Object.prototype.toString.call(e)?!0:void 0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(e,n){var r=n.toString(16);r.length<2&&(r="0"+r),t+=r}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),o=new FileReader,i=new qq.Promise;return o.onload=function(){i.success(qq.arrayBufferToHex(o.result))},o.onerror=i.failure,o.readAsArrayBuffer(r),i},qq.extend=function(e,t,n){return qq.each(t,function(t,r){n&&qq.isObject(r)?(void 0===e[t]&&(e[t]={}),qq.extend(e[t],r,!0)):e[t]=r}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(t,r){void 0!==e[t]&&(n[t]=e[t]),e[t]=r}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;for(0>n&&(n+=r);r>n;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&(r=t(e.key(n),e.getItem(e.key(n))),r!==!1);n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&(r=t(n,e[n]),r!==!1);n++);else if(qq.isString(e))for(n=0;n<e.length&&(r=t(n,e.charAt(n)),r!==!1);n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&(r=t(n,e[n]),r===!1))break},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],o="&",i=function(e,n){var o=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;"undefined"!==o&&"undefined"!==n&&r.push("object"==typeof e?qq.obj2url(e,o,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(o)+"="+encodeURIComponent(e()):encodeURIComponent(o)+"="+encodeURIComponent(e))};return!n&&t?(o=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e?qq.each(e,function(e,t){i(t,e)}):"undefined"!=typeof e&&null!==e&&"object"==typeof e?qq.each(e,function(e,t){i(t,e)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(o):r.join(o).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(e,r){e=n?n+"["+e+"]":e,qq.isObject(r)?qq.obj2FormData(r,t,e):qq.isFunction(r)?t.append(e,r()):t.append(e,r)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,r){n=document.createElement("input"),n.setAttribute("name",e),n.setAttribute("value",r),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;return t>0?e.substr(t,e.length-t):void 0},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define("fineuploader",[],function(){return qq}):"undefined"!=typeof module&&module.exports?module.exports=qq:global.qq=qq}(),function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.15.4",qq.supportedFeatures=function(){"use strict";function e(){var e,t=!0;try{e=document.createElement("input"),e.type="file",qq(e).hide(),e.disabled&&(t=!1)}catch(n){t=!1}return t}function t(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function n(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function r(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return void 0!==e.withCredentials}return!1}function o(){return void 0!==window.XDomainRequest}function i(){return r()?!0:o()}function a(){return void 0!==document.createElement("input").webkitdirectory}function s(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(e){return!1}}function l(){var e=document.createElement("span");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&!qq.android()&&!qq.ios()}var c,u,d,f,p,m,h,g,v,_,q,b,y,w,S;return c=e(),f=c&&qq.isXhrUploadSupported(),u=f&&!qq.androidStock(),d=f&&l(),p=d&&t(),m=f&&qq.isFileChunkingSupported(),h=f&&m&&s(),g=f&&n(),v=c&&(void 0!==window.postMessage||f),q=r(),_=o(),b=i(),y=a(),w=f&&void 0!==window.FileReader,S=function(){return f?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:f,blobUploading:u,canDetermineSize:f,chunking:m,deleteFileCors:b,deleteFileCorsXdr:_,deleteFileCorsXhr:q,dialogElement:!!window.HTMLDialogElement,fileDrop:d,folderDrop:p,folderSelection:y,imagePreviews:w,imageValidation:w,itemSizeValidation:f,pause:m,progressBar:S,resume:h,scaling:w&&u,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:c,uploadCors:v,uploadCustomHeaders:f,uploadNonMultipart:f,uploadViaPaste:g}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],r=[],o=[],i=0;qq.extend(this,{then:function(o,a){return 0===i?(o&&n.push(o),a&&r.push(a)):-1===i?a&&a.apply(null,t):o&&o.apply(null,e),this},done:function(n){return 0===i?o.push(n):n.apply(null,void 0===t?e:t),this},success:function(){return i=1,e=arguments,n.length&&qq.each(n,function(t,n){n.apply(null,e)}),o.length&&qq.each(o,function(t,n){n.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,r.length&&qq.each(r,function(e,n){n.apply(null,t)}),o.length&&qq.each(o,function(e,n){n.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){"use strict";function t(){var e=document.createElement("input");return e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,r),e.setAttribute("title",a.title),o.setMultiple(a.multiple,e),a.folders&&qq.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),a.acceptFiles&&e.setAttribute("accept",a.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",a.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(e).css({height:"100%"}),a.element.appendChild(e),i.attach(e,"change",function(){a.onChange(e)}),i.attach(e,"mouseover",function(){qq(a.element).addClass(a.hoverClass)}),i.attach(e,"mouseout",function(){qq(a.element).removeClass(a.hoverClass)}),i.attach(e,"focus",function(){qq(a.element).addClass(a.focusClass)}),i.attach(e,"blur",function(){qq(a.element).removeClass(a.focusClass)}),e}var n,r,o=this,i=new qq.DisposeSupport,a={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(e){},title:null};qq.extend(a,e),r=qq.getUniqueId(),qq(a.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return n},getButtonId:function(){return r},setMultiple:function(e,t){var n=t||this.getInput();a.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?n.setAttribute("multiple",""):e?n.setAttribute("multiple",""):n.removeAttribute("multiple")},setAcceptFiles:function(e){e!==a.acceptFiles&&n.setAttribute("accept",e)},reset:function(){n.parentNode&&qq(n).remove(),qq(a.element).removeClass(a.focusClass),n=null,n=t()}}),n=t()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){"use strict";function t(e){if(qq.isArray(e)){var t=[];return qq.each(e,function(e,n){t.push(o[n])}),t}return o[e]}function n(e){if(qq.isArray(e)){var t=[];return qq.each(e,function(e,n){t.push(o[i[n]])}),t}return o[i[e]]}function r(e){var t=[],n=[].concat(e);return qq.each(n,function(e,n){var r=a[n];void 0!==r&&qq.each(r,function(e,n){t.push(o[n])})}),t}var o=[],i={},a={},s={},l={};qq.extend(this,{addFile:function(t){var n=t.status||qq.status.SUBMITTING,r=o.push({name:t.name,originalName:t.name,uuid:t.uuid,size:null==t.size?-1:t.size,status:n})-1;return t.batchId&&(o[r].batchId=t.batchId,void 0===l[t.batchId]&&(l[t.batchId]=[]),l[t.batchId].push(r)),t.proxyGroupId&&(o[r].proxyGroupId=t.proxyGroupId,void 0===s[t.proxyGroupId]&&(s[t.proxyGroupId]=[]),s[t.proxyGroupId].push(r)),o[r].id=r,i[t.uuid]=r,void 0===a[n]&&(a[n]=[]),a[n].push(r),t.onBeforeStatusChange&&t.onBeforeStatusChange(r),e.onStatusChange(r,null,n),r},retrieve:function(e){return qq.isObject(e)&&o.length?void 0!==e.id?t(e.id):void 0!==e.uuid?n(e.uuid):e.status?r(e.status):void 0:qq.extend([],o,!0)},reset:function(){o=[],i={},a={},l={}},setStatus:function(t,n){var r=o[t].status,i=qq.indexOf(a[r],t);a[r].splice(i,1),o[t].status=n,void 0===a[n]&&(a[n]=[]),a[n].push(t),e.onStatusChange(t,r,n)},uuidChanged:function(e,t){var n=o[e].uuid;o[e].uuid=t,i[t]=e,delete i[n]},updateName:function(e,t){o[e].name=t},updateSize:function(e,t){o[e].size=t},setParentId:function(e,t){o[e].parentId=t},getIdsInProxyGroup:function(e){var t=o[e].proxyGroupId;return t?s[t]:[]},getIdsInBatch:function(e){var t=o[e].batchId;return l[t]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(e,n){t._addCannedFile(n)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var r=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,o=qq.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},r,d)},this),i=qq.bind(function(e){this._handleNewFile(e,r,d)},this),a=qq.bind(function(e){var t=qq.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},r,d)},this),s=qq.bind(function(e){var t=e.quality&&e.quality/100,n=qq.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:n,name:e.name},r,d)},this),l=qq.bind(function(e){if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files),n=this;qq.each(t,function(e,t){n._handleNewFile(t,r,d)})}else this._handleNewFile(e,r,d)},this),c=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},u=this,d=[];this._currentBatchId=r,e&&(c(),qq.each(e,function(e,t){qq.isFileOrInput(t)?l(t):qq.isBlob(t)?o(t):qq.isObject(t)?t.blob&&t.name?i(t):t.canvas&&t.name&&s(t):t.tagName&&"canvas"===t.tagName.toLowerCase()?a(t):u.log(t+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+d.length+" files."),this._prepareItemsForUpload(d,t,n));
},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(e,n){t.cancel(n)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return qq.supportedFeatures.pause&&this._options.chunking.enabled?t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1):!1},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,r,o){var i,a,s=new qq.Promise;return this._imageGenerator?(i=this._thumbnailUrls[e],a={customResizeFunction:o,maxSize:n>0?n:null,scale:n>0},!r&&qq.supportedFeatures.imagePreviews&&(i=this.getFile(e)),null==i?s.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(i,t,a).then(function(e){s.success(e)},function(e,t){s.failure({container:e,error:t||"Problem generating thumbnail"})})):s.failure({container:t,error:"Missing image generator module"}),s},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&void 0!==t.parentId&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qq.log("[Fine Uploader "+qq.version+"] "+e,t):qq.log("[Fine Uploader "+qq.version+"] "+e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n)throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var r="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(r),new qq.Error(r)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r),e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},r=e,o={},i=t,a=function(e){return qq.isObject(e)?qq.extend({},e):e},s=function(){return qq.isFunction(i)?i():i},l=function(e,t){i&&qq.isObject(t)&&qq.extend(t,s()),o[e]&&qq.extend(t,o[e])};return{set:function(e,t){null==t?(n={},r=a(e)):n[t]=a(e)},get:function(e){var t;return t=null!=e&&n[e]?n[e]:a(r),l(e,t),a(t)},addReadOnly:function(e,t){qq.isObject(n)&&(null===e?qq.isFunction(t)?i=t:(i=i||{},qq.extend(i,t)):(o[e]=o[e]||{},qq.extend(o[e],t)))},remove:function(e){return delete n[e]},reset:function(){n={},o={},r=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r),e._options.callbacks.onStatusChange(t,n,r),e._maybeAllComplete(t,r),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,r)},0)}})},_createUploadButton:function(e){function t(){return qq.supportedFeatures.ajaxUploading?r._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&r._isAllowedExtension(i,".mov")?!1:void 0===e.multiple?r._options.multiple:e.multiple:!1}var n,r=this,o=e.accept||this._options.validation.acceptFiles,i=e.allowedExtensions||this._options.validation.allowedExtensions;return n=new qq.UploadButton({acceptFiles:o,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:t(),name:this._options.request.inputName,onChange:function(e){r._onInputChange(e)},title:null==e.title?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){n.dispose()}),r._buttons.push(n),n},_createUploadHandler:function(e,t){var n=this,r={},o={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,o,i){0>o||0>i||(r[e]?(r[e].loaded!==o||r[e].total!==i)&&(n._onProgress(e,t,o,i),n._options.callbacks.onProgress(e,t,o,i)):(n._onProgress(e,t,o,i),n._options.callbacks.onProgress(e,t,o,i)),r[e]={loaded:o,total:i})},onComplete:function(e,t,o,i){delete r[e];var a,s=n.getUploads({id:e}).status;s!==qq.status.UPLOAD_SUCCESSFUL&&s!==qq.status.UPLOAD_FAILED&&(a=n._onComplete(e,t,o,i),a instanceof qq.Promise?a.done(function(){n._options.callbacks.onComplete(e,t,o,i)}):n._options.callbacks.onComplete(e,t,o,i))},onCancel:function(e,t,r){var o=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:o.failure,onSuccess:function(){r.then(function(){n._onCancel(e,t)}),o.success()},identifier:e}),o},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t),n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,r){n._onUploadChunk(e,r),n._options.callbacks.onUploadChunk(e,t,r)},onUploadChunkSuccess:function(e,t,r,o){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,r){return n._options.callbacks.onResume(e,t,r)},onAutoRetry:function(e,t,r,o){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'"),n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch};return qq.each(this._options.request,function(e,t){o[e]=t}),o.customHeaders=this._customHeadersStore,e&&qq.each(e,function(e,t){o[e]=t}),new qq.UploadHandlerController(o,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(0===e)return e+this._options.text.sizeSymbols[0];var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,o=qq.extend({},e._options.validation,!0),i=qq.extend({},n);void 0===r&&(r=e._options.multiple),i.validation&&qq.extend(o,n.validation,!0),qq.extend(i,{multiple:r,validation:o},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,n,r=e;if(r instanceof qq.BlobProxy&&(r=r.referenceBlob),r&&!qq.isBlob(r)){if(qq.isFile(r))return r.qqButtonId;if("input"===r.tagName.toLowerCase()&&"file"===r.type.toLowerCase())return r.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=r.getElementsByTagName("input"),qq.each(t,function(e,t){return"file"===t.getAttribute("type")?(n=t,!1):void 0}),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(e,r){n.push(t._getValidationDescriptor(r))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;n&&n!==this._defaultButtonId&&(r=this._extraButtonSpecs[n]),r.multiple=!1,null===r.validation.acceptFiles?r.validation.acceptFiles=e:r.validation.acceptFiles+=","+e,qq.each(this._buttons,function(e,t){return t.getButtonId()===n?(t.setMultiple(r.multiple),t.setAcceptFiles(r.acceptFiles),!1):void 0})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(n){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(n)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var r=this,o=qq.getUniqueId(),i=-1,a=qq.getFilename(e),s=e.blob||e,l=this._customNewFileHandler?this._customNewFileHandler:qq.bind(r._handleNewFileGeneric,r);!qq.isInput(s)&&s.size>=0&&(i=s.size),l(s,a,o,i,n,t,this._options.request.uuidName,{uploadData:r._uploadData,paramsStore:r._paramsStore,addFileToHandler:function(e,t){r._handler.add(e,t),r._netUploadedOrQueued++,r._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,r,o,i){var a=this._uploadData.addFile({uuid:n,name:t,size:r,batchId:i});this._handler.add(a,e),this._trackButton(a),this._netUploadedOrQueued++,o.push({id:a,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;null==r&&(r=this._options.paste.defaultName),r+="."+n,this.addFiles({name:r,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),t&&void 0!==t.withCredentials?this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t):this._options.callbacks.onError(e,n,"Delete request failed",t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return qq.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(e,r){if(qq.isString(r)){var o=new RegExp("\\."+r+"$","i");if(null!=t.match(o))return n=!0,!1}}),n):!0},_itemError:function(e,t,n){function r(e,t){a=a.replace(e,t)}var o,i,a=this._options.messages[e],s=[],l=[].concat(t),c=l[0],u=this._getButtonId(n),d=this._getValidationBase(u);return qq.each(d.allowedExtensions,function(e,t){qq.isString(t)&&s.push(t)}),o=s.join(", ").toLowerCase(),r("{file}",this._options.formatFileName(c)),r("{extensions}",o),r("{sizeLimit}",this._formatSize(d.sizeLimit)),r("{minSizeLimit}",this._formatSize(d.minSizeLimit)),i=a.match(/(\{\w+\})/g),null!==i&&qq.each(i,function(e,t){r(t,l[e])}),this._options.callbacks.onError(null,c,a,void 0),a},_manualRetry:function(e,t){return this._onBeforeManualRetry(e)?(this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0):void 0},_maybeAllComplete:function(e,t){var n=this,r=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),0===r&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success)if(r&&200!==r.status&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r);else{var o=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,o,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,o){var i=this;if(t.length>n)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=i._getValidationDescriptor(t[n]),a=i._getButtonId(t[n].file),s=i._getButton(a);i._handleCheckedCallback({name:"onValidate",callback:qq.bind(i._options.callbacks.onValidate,i,e,s),onSuccess:qq.bind(i._onValidateCallbackSuccess,i,t,n,r,o),onFailure:qq.bind(i._onValidateCallbackFailure,i,t,n,r,o),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;n<t.length;n++)i._fileOrBlobRejected(t[n].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,r,o){var i=this;if(i._preventRetries[e]=n[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e,t,n)){var a=1e3*i._options.retry.autoAttemptDelay;return i._maybeParseAndSendUploadError.apply(i,arguments),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),i._retryTimeouts[e]=setTimeout(function(){i.log("Starting retry for "+t+"..."),o?o(e):i._handler.retry(e)},a),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t,n=this._currentItemLimit;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(t=this.getName(e),this._options.callbacks.onManualRetry(e,t)===!1?!1:n>0&&this._netUploadedOrQueued+1>n?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,r){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,r),n.success?!0:!1},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e);n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,r){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,r)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var r,o=this.getUuid(e);return t&&(r=qq.bind(t,this,e,o,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:r||qq.bind(this._deleteHandler.sendDelete,this,e,o,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,r,o){var i,a=this._currentItemLimit,s=this._netUploadedOrQueued;0===a||a>=s?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],o),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,a),this._batchError(i))},_onValidateCallbackFailure:function(e,t,n,r){var o=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,n,r)},_onValidateCallbackSuccess:function(e,t,n,r){var o=this,i=t+1,a=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],a).then(function(){o._upload(e[t].id,n,r),o._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,n,r)},function(){o._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,r)})},_prepareItemsForUpload:function(e,t,n){if(0===e.length)return void this._itemError("noFilesError");var r=this._getValidationDescriptors(e),o=this._getButtonId(e[0].file),i=this._getButton(o);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,i),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,i),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){return e.getInProgress()?(t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave):void 0})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,n){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(t,!0,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,n){var r=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&r.status!==qq.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;t=qq.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var r=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);t=this.getUploads({status:qq.status.SUBMITTING}).length,t&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){n._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var n=this,r=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),o=t.name,i=t.size,a=this._getButtonId(e.file),s=this._getValidationBase(a),l=new qq.Promise;return l.then(function(){},function(){n._fileOrBlobRejected(e.id,o)}),qq.isFileOrInput(r)&&!this._isAllowedExtension(s.allowedExtensions,o)?(this._itemError("typeError",o,r),l.failure()):this._options.validation.allowEmpty||0!==i?i>0&&s.sizeLimit&&i>s.sizeLimit?(this._itemError("sizeError",o,r),l.failure()):i>0&&i<s.minSizeLimit?(this._itemError("minSizeError",o,r),l.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)?new qq.ImageValidation(r,qq.bind(n.log,n)).validate(s.image).then(l.success,function(e){n._itemError(e+"ImageError",o,r),l.failure()}):l.success(),l):(this._itemError("emptyError",o,r),l.failure())},_wrapCallbacks:function(){var e,t,n;e=this,t=function(t,n,r){var o;try{return n.apply(e,r)}catch(i){o=i.message||i.toString(),e.log("Caught exception in '"+t+"' callback - "+o,"error")}};for(n in this._options.callbacks)!function(){var r,o;r=n,o=e._options.callbacks[r],e._options.callbacks[r]=function(){return t(r,o,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,r){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onResume:function(e,t,n){},onProgress:function(e,t,n,r){},onTotalProgress:function(e,t){},onError:function(e,t,n,r){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),
this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0})),this._currentItemLimit=this._options.validation.itemLimit},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){"use strict";function t(){return qq.indexOf(["GET","POST","HEAD"],w.method)>=0}function n(e){var t=!1;return qq.each(t,function(e,n){return qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0?(t=!0,!1):void 0}),t}function r(e){return w.cors.expected&&void 0===e.withCredentials}function o(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&(e=qq.createXhrInstance(),void 0===e.withCredentials&&(e=new XDomainRequest,e.onload=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onprogress=function(){})),e}function i(e,t){var n=y[e].xhr;return n||(n=t?t:w.cors.expected?o():qq.createXhrInstance(),y[e].xhr=n),n}function a(e){var t,n=qq.indexOf(b,e),r=w.maxConnections;delete y[e],b.splice(n,1),b.length>=r&&r>n&&(t=b[r-1],c(t))}function s(e,t){var n=i(e),o=w.method,s=t===!0;a(e),s?_(o+" request for "+e+" has failed","error"):r(n)||g(n.status)||(s=!0,_(o+" request for "+e+" has failed - response code "+n.status,"error")),w.onComplete(e,n,s)}function l(e){var t,n=y[e].additionalParams,r=w.mandatedParams;return w.paramsStore.get&&(t=w.paramsStore.get(e)),n&&qq.each(n,function(e,n){t=t||{},t[e]=n}),r&&qq.each(r,function(e,n){t=t||{},t[e]=n}),t}function c(e,t){var n,o=i(e,t),a=w.method,s=l(e),c=y[e].payload;return w.onSend(e),n=u(e,s,y[e].additionalQueryParams),r(o)?(o.onload=p(e),o.onerror=m(e)):o.onreadystatechange=d(e),f(e),o.open(a,n,!0),w.cors.expected&&w.cors.sendCredentials&&!r(o)&&(o.withCredentials=!0),h(e),_("Sending "+a+" request for "+e),c?o.send(c):q||!s?o.send():s&&w.contentType&&w.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?o.send(qq.obj2url(s,"")):s&&w.contentType&&w.contentType.toLowerCase().indexOf("application/json")>=0?o.send(JSON.stringify(s)):o.send(s),o}function u(e,t,n){var r=w.endpointStore.get(e),o=y[e].addToPath;return void 0!=o&&(r+="/"+o),q&&t&&(r=qq.obj2url(t,r)),n&&(r=qq.obj2url(n,r)),r}function d(e){return function(){4===i(e).readyState&&s(e)}}function f(e){var t=w.onProgress;t&&(i(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}function p(e){return function(){s(e)}}function m(e){return function(){s(e,!0)}}function h(e){var o=i(e),a=w.customHeaders,s=y[e].additionalHeaders||{},l=w.method,c={};r(o)||(w.acceptHeader&&o.setRequestHeader("Accept",w.acceptHeader),w.allowXRequestedWithAndCacheControl&&(w.cors.expected&&t()&&!n(a)||(o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Cache-Control","no-cache"))),!w.contentType||"POST"!==l&&"PUT"!==l||o.setRequestHeader("Content-Type",w.contentType),qq.extend(c,qq.isFunction(a)?a(e):a),qq.extend(c,s),qq.each(c,function(e,t){o.setRequestHeader(e,t)}))}function g(e){return qq.indexOf(w.successfulResponseCodes[w.method],e)>=0}function v(e,t,n,r,o,i,a){y[e]={addToPath:n,additionalParams:r,additionalQueryParams:o,additionalHeaders:i,payload:a};var s=b.push(e);return s<=w.maxConnections?c(e,t):void 0}var _,q,b=[],y={},w={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};if(qq.extend(w,e),_=w.log,qq.indexOf(w.validMethods,w.method)<0)throw new Error("'"+w.method+"' is not a supported method for this type of request!");q="GET"===w.method||"DELETE"===w.method,qq.extend(this,{initTransport:function(e){var t,n,r,o,i,a;return{withPath:function(e){return t=e,this},withParams:function(e){return n=e,this},withQueryParams:function(e){return a=e,this},withHeaders:function(e){return r=e,this},withPayload:function(e){return o=e,this},withCacheBuster:function(){return i=!0,this},send:function(s){return i&&qq.indexOf(["GET","DELETE"],w.method)>=0&&(n.qqtimestamp=(new Date).getTime()),v(e,s,t,n,a,r,o)}}},canceled:function(e){a(e)}})},qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},r=t.onCancel,o=t.getName;qq.extend(this,{add:function(e,t){n[e]=t,n[e].temp={}},cancel:function(e){var t=this,i=new qq.Promise,a=r(e,o(e),i);a.then(function(){t.isValid(e)&&(n[e].canceled=!0,t.expunge(e)),i.success()})},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return void 0!==n[e]},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})},qq.UploadHandlerController=function(e,t){"use strict";var n,r,o,i=this,a=!1,s=!1,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onAutoRetry:function(e,t,n,r){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},c={done:function(e,t,n,r){var i=o._getChunkData(e,t);o._getFileState(e).attemptingResume=!1,delete o._getFileState(e).temp.chunkProgress[t],o._getFileState(e).loaded+=i.size,l.onUploadChunkSuccess(e,o._getChunkDataForCallback(i),n,r)},finalize:function(e){var t=l.getSize(e),n=l.getName(e);r("All chunks have been uploaded for "+e+" - finalizing...."),o.finalizeChunks(e).then(function(i,a){r("Finalize successful for "+e);var s=f.normalizeResponse(i,!0);l.onProgress(e,n,t,t),o._maybeDeletePersistedChunkData(e),f.cleanup(e,s,a)},function(t,o){var i=f.normalizeResponse(t,!1);r("Problem finalizing chunks for file ID "+e+" - "+i.error,"error"),i.reset&&c.reset(e),l.onAutoRetry(e,n,i,o)||f.cleanup(e,i,o)})},handleFailure:function(e,t,n,i){var a=l.getName(t);r("Chunked upload request failed for "+t+", chunk "+e),o.clearCachedChunk(t,e);var d,p=f.normalizeResponse(n,!1);p.reset?c.reset(t):(d=qq.indexOf(o._getFileState(t).chunking.inProgress,e),d>=0&&(o._getFileState(t).chunking.inProgress.splice(d,1),o._getFileState(t).chunking.remaining.unshift(e))),o._getFileState(t).temp.ignoreFailure||(s&&(o._getFileState(t).temp.ignoreFailure=!0,r(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(o._getXhrs(t))),JSON.stringify(o._getFileState(t).chunking.inProgress))),qq.each(o._getXhrs(t),function(e,n){r(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",t,e,n.readyState)),n.abort(),n._cancelled=!0}),o.moveInProgressToRemaining(t),u.free(t,!0)),l.onAutoRetry(t,a,p,i)||f.cleanup(t,p,i))},hasMoreParts:function(e){return!!o._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=o._getFileState(e).chunking.remaining.shift();return t>=o._getTotalChunks(e)&&(t=null),t},reset:function(e){r("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),o._maybeDeletePersistedChunkData(e),o.reevaluateChunking(e),o._getFileState(e).loaded=0},sendNext:function(e){var t=l.getSize(e),n=l.getName(e),i=c.nextPart(e),a=o._getChunkData(e,i),d=o._getFileState(e).attemptingResume,p=o._getFileState(e).chunking.inProgress||[];null==o._getFileState(e).loaded&&(o._getFileState(e).loaded=0),d&&l.onResume(e,n,a)===!1&&(c.reset(e),i=c.nextPart(e),a=o._getChunkData(e,i),d=!1),null==i&&0===p.length?c.finalize(e):(r(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,i,a.start+1,a.end,t)),l.onUploadChunk(e,n,o._getChunkDataForCallback(a)),p.push(i),o._getFileState(e).chunking.inProgress=p,s&&u.open(e,i),s&&u.available()&&o._getFileState(e).chunking.remaining.length&&c.sendNext(e),0===a.blob.size?(r(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",i,e),"error"),c.handleFailure(i,e,"File is no longer available",null)):o.uploadChunk(e,i,d).then(function(t,n){r("Chunked upload request succeeded for "+e+", chunk "+i),o.clearCachedChunk(e,i);var a=o._getFileState(e).chunking.inProgress||[],s=f.normalizeResponse(t,!0),l=qq.indexOf(a,i);r(qq.format("Chunk {} for file {} uploaded successfully.",i,e)),c.done(e,i,s,n),l>=0&&a.splice(l,1),o._maybePersistChunkedState(e),c.hasMoreParts(e)||0!==a.length?c.hasMoreParts(e)?c.sendNext(e):r(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(a))):c.finalize(e)},function(t,n){c.handleFailure(i,e,t,n)}).done(function(){o.clearXhr(e,i)}))}},u={_open:[],_openChunks:{},_waiting:[],available:function(){var e=l.maxConnections,t=0,n=0;return qq.each(u._openChunks,function(e,r){t++,n+=r.length}),e-(u._open.length-t+n)},free:function(e,t){var n,i=!t,a=qq.indexOf(u._waiting,e),s=qq.indexOf(u._open,e);delete u._openChunks[e],f.getProxyOrBlob(e)instanceof qq.BlobProxy&&(r("Generated blob upload has ended for "+e+", disposing generated blob."),delete o._getFileState(e).file),a>=0?u._waiting.splice(a,1):i&&s>=0&&(u._open.splice(s,1),n=u._waiting.shift(),n>=0&&(u._open.push(n),f.start(n)))},getWaitingOrConnected:function(){var e=[];return qq.each(u._openChunks,function(t,n){n&&n.length&&e.push(parseInt(t))}),qq.each(u._open,function(t,n){u._openChunks[n]||e.push(parseInt(n))}),e=e.concat(u._waiting)},isUsingConnection:function(e){return qq.indexOf(u._open,e)>=0},open:function(e,t){return null==t&&u._waiting.push(e),u.available()?(null==t?(u._waiting.pop(),u._open.push(e)):!function(){var n=u._openChunks[e]||[];n.push(t),u._openChunks[e]=n}(),!0):!1},reset:function(){u._waiting=[],u._open=[]}},d={send:function(e,t){o._getFileState(e).loaded=0,r("Sending simple upload request for "+e),o.uploadFile(e).then(function(n,o){r("Simple upload request succeeded for "+e);var i=f.normalizeResponse(n,!0),a=l.getSize(e);l.onProgress(e,t,a,a),f.maybeNewUuid(e,i),f.cleanup(e,i,o)},function(n,o){r("Simple upload request failed for "+e);var i=f.normalizeResponse(n,!1);l.onAutoRetry(e,t,i,o)||f.cleanup(e,i,o)})}},f={cancel:function(e){r("Cancelling "+e),l.paramsStore.remove(e),u.free(e)},cleanup:function(e,t,n){var r=l.getName(e);l.onComplete(e,r,t,n),o._getFileState(e)&&o._clearXhrs&&o._clearXhrs(e),u.free(e)},getProxyOrBlob:function(e){return o.getProxy&&o.getProxy(e)||o.getFile&&o.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";o=new e[n+"UploadHandler"](l,{getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:r,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged}),o._removeExpiredChunkingRecords&&o._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return l.isQueued(e)},maybeDefer:function(e,t){return t&&!o.getFile(e)&&t instanceof qq.BlobProxy?(l.onUploadPrep(e),r("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){r("Generated an on-demand blob for "+e),o.updateBlob(e,t),l.setSize(e,t.size),o.reevaluateChunking(e),f.maybeSendDeferredFiles(e)},function(t){var o={};t&&(o.error=t),r(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),l.onComplete(e,l.getName(e),qq.extend(o,n),null),f.maybeSendDeferredFiles(e),u.free(e)}),!1):f.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=l.getIdsInProxyGroup(e),n=!1;return t&&t.length?(r("Maybe ready to upload proxy group file "+e),qq.each(t,function(t,r){if(f.isDeferredEligibleForUpload(r)&&o.getFile(r))n=r===e,f.now(r);else if(f.isDeferredEligibleForUpload(r))return!1})):(n=!0,f.now(e)),n},maybeNewUuid:function(e,t){void 0!==t.newUuid&&l.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var n=e;return qq.isObject(e)||(n={},qq.isString(e)&&!t&&(n.error=e)),n.success=t,n},now:function(e){var t=l.getName(e);if(!i.isValid(e))throw new qq.Error(e+" is not a valid file ID to upload!");l.onUpload(e,t),a&&o._shouldChunkThisFile(e)?c.sendNext(e):d.send(e,t)},start:function(e){var t=f.getProxyOrBlob(e);return t?f.maybeDefer(e,t):(f.now(e),!0)}};qq.extend(this,{add:function(e,t){o.add.apply(this,arguments)},upload:function(e){return u.open(e)?f.start(e):!1},retry:function(e){return s&&(o._getFileState(e).temp.ignoreFailure=!1),u.isUsingConnection(e)?f.start(e):i.upload(e)},cancel:function(e){var t=o.cancel(e);qq.isGenericPromise(t)?t.then(function(){f.cancel(e)}):t!==!1&&f.cancel(e)},cancelAll:function(){var e,t=u.getWaitingOrConnected();if(t.length)for(e=t.length-1;e>=0;e--)i.cancel(t[e]);u.reset()},getFile:function(e){return o.getProxy&&o.getProxy(e)?o.getProxy(e).referenceBlob:o.getFile&&o.getFile(e)},isProxied:function(e){return!(!o.getProxy||!o.getProxy(e))},getInput:function(e){return o.getInput?o.getInput(e):void 0},reset:function(){r("Resetting upload handler"),i.cancelAll(),u.reset(),o.reset()},expunge:function(e){return i.isValid(e)?o.expunge(e):void 0},isValid:function(e){return o.isValid(e)},getResumableFilesData:function(){return o.getResumableFilesData?o.getResumableFilesData():[]},getThirdPartyFileId:function(e){return i.isValid(e)?o.getThirdPartyFileId(e):void 0},pause:function(e){return i.isResumable(e)&&o.pause&&i.isValid(e)&&o.pause(e)?(u.free(e),o.moveInProgressToRemaining(e),!0):!1},isResumable:function(e){return!!o.isResumable&&o.isResumable(e)}}),qq.extend(l,e),r=l.log,a=l.chunking.enabled&&qq.supportedFeatures.chunking,s=a&&l.chunking.concurrent.enabled,n=function(){var e={};return e[l.preventRetryParam]=!0,e}(),f.initHandler()},qq.WindowReceiveMessage=function(e){"use strict";var t={log:function(e,t){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(e,t){var r=function(e){t(e.data)};window.postMessage?n[e]=qq(window).attach("message",r):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];t&&t()}}})},qq.FormUploadHandler=function(e){"use strict";function t(e){delete u[e],f&&(clearTimeout(d[e]),delete d[e],g.stopReceivingMessages(e));var t=document.getElementById(a._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())}function n(e){return e.split("_")[0]}function r(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}function o(e,t){var r=e.id,o=n(r),i=m(o);c[i]=t,u[o]=qq(e).attach("load",function(){a.getInput(o)&&(h("Received iframe load event for CORS upload request (iframe name "+r+")"),d[r]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+r;h(e,"error"),t({error:e})},1e3))}),g.receiveMessage(r,function(e){h("Received the following window message: '"+e+"'");var t,o=(n(r),a._parseJsonResponse(e)),i=o.uuid;i&&c[i]?(h("Handling response for iframe name "+r),clearTimeout(d[r]),delete d[r],a._detachLoadEvent(r),t=c[i],delete c[i],g.stopReceivingMessages(r),t(o)):i||h("'"+e+"' does not contain a UUID - ignoring.")})}var i=e.options,a=this,s=e.proxy,l=qq.getUniqueId(),c={},u={},d={},f=i.isCors,p=i.inputName,m=s.getUuid,h=s.log,g=new qq.WindowReceiveMessage({log:h});qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,n){e.add(t,{input:n}),n.setAttribute("name",p),n.parentNode&&qq(n).remove()},expunge:function(n){t(n),e.expunge(n)},isValid:function(t){return e.isValid(t)&&void 0!==a._getFileState(t).input}}}),qq.extend(this,{getInput:function(e){return a._getFileState(e).input},_attachLoadEvent:function(e,t){var n;f?o(e,t):u[e.id]=qq(e).attach("load",function(){if(h("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(r){h("Error when attempting to access iframe during handling of upload response ("+r.message+")","error"),n={success:!1}}t(n)}})},_createIframe:function(e){var t=a._getIframeName(e);return r(t)},_detachLoadEvent:function(e){void 0!==u[e]&&(u[e](),delete u[e])},_getIframeName:function(e){return e+"_"+l},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,r=e.params,o=e.paramsInBody,i=e.targetName,a=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),s=n;return o?qq.obj2Inputs(r,a):s=qq.obj2url(r,n),a.setAttribute("action",s),a.setAttribute("target",i),a.style.display="none",document.body.appendChild(a),a},_parseJsonResponse:function(e){var t={};try{t=qq.parseJson(e)}catch(n){h("Error when attempting to parse iframe upload response ("+n.message+")","error")}return t}})},qq.XhrUploadHandler=function(e){"use strict";function t(e){qq.each(n._getXhrs(e),function(t,r){var o=n._getAjaxRequester(e,t);r.onreadystatechange=null,r.upload.onprogress=null,r.abort(),o&&o.canceled&&o.canceled(e)})}var n=this,r=e.options.namespace,o=e.proxy,i=e.options.chunking,a=e.options.resume,s=i&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,l=a&&e.options.resume.enabled&&s&&qq.supportedFeatures.resume,c=o.getName,u=o.getSize,d=o.getUuid,f=o.getEndpoint,p=o.getDataByUuid,m=o.onUuidChanged,h=o.onProgress,g=o.log;qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,r){if(qq.isFile(r)||qq.isBlob(r))e.add(t,{file:r});else{if(!(r instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(t,{proxy:r})}n._initTempState(t),l&&n._maybePrepareForResume(t)},expunge:function(r){t(r),n._maybeDeletePersistedChunkData(r),n._clearXhrs(r),e.expunge(r)}}}),qq.extend(this,{clearCachedChunk:function(e,t){delete n._getFileState(e).temp.cachedChunks[t]},clearXhr:function(e,t){var r=n._getFileState(e).temp;r.xhrs&&delete r.xhrs[t],r.ajaxRequesters&&delete r.ajaxRequesters[t]},finalizeChunks:function(e,t){var r=n._getTotalChunks(e)-1,o=n._getXhr(e,r);return t?(new qq.Promise).success(t(o),o):(new qq.Promise).success({},o)},getFile:function(e){return n.isValid(e)&&n._getFileState(e).file},getProxy:function(e){return n.isValid(e)&&n._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return n._iterateResumeRecords(function(t,r){n.moveInProgressToRemaining(null,r.chunking.inProgress,r.chunking.remaining);var o={name:r.name,remaining:r.chunking.remaining,size:r.size,uuid:r.uuid};r.key&&(o.key=r.key),e.push(o)}),e},isResumable:function(e){return!!i&&n.isValid(e)&&!n._getFileState(e).notResumable},moveInProgressToRemaining:function(e,t,r){var o=t||n._getFileState(e).chunking.inProgress,i=r||n._getFileState(e).chunking.remaining;o&&(g(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(o))),o.reverse(),qq.each(o,function(e,t){i.unshift(t)}),o.length=0)},pause:function(e){return n.isValid(e)?(g(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,c(e))),n._getFileState(e).paused=!0,t(e),!0):void 0},reevaluateChunking:function(e){if(i&&n.isValid(e)){var t,r,o=n._getFileState(e);if(delete o.chunking,o.chunking={},t=n._getTotalChunks(e),t>1||i.mandatory){for(o.chunking.enabled=!0,o.chunking.parts=t,o.chunking.remaining=[],r=0;t>r;r++)o.chunking.remaining.push(r);n._initTempState(e)}else o.chunking.enabled=!1}},updateBlob:function(e,t){n.isValid(e)&&(n._getFileState(e).file=t)},_clearXhrs:function(e){var t=n._getFileState(e).temp;qq.each(t.ajaxRequesters,function(e){delete t.ajaxRequesters[e]}),qq.each(t.xhrs,function(e){delete t.xhrs[e]})},_createXhr:function(e,t){return n._registerXhr(e,t,qq.createXhrInstance())},_getAjaxRequester:function(e,t){var r=null==t?-1:t;return n._getFileState(e).temp.ajaxRequesters[r]},_getChunkData:function(e,t){var r=i.partSize,o=u(e),a=n.getFile(e),s=r*t,l=s+r>=o?o:s+r,c=n._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,f=d[t]||qq.sliceBlob(a,s,l);return d[t]=f,{part:t,start:s,end:l,count:c,blob:f,size:l-s}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t="5.0",n=c(e),o=u(e),a=i.partSize,s=f(e);return qq.format("qq{}resume{}-{}-{}-{}-{}",r,t,n,o,a,s)},_getMimeType:function(e){return n.getFile(e).type},_getPersistableData:function(e){return n._getFileState(e).chunking},_getTotalChunks:function(e){if(i){var t=u(e),n=i.partSize;return Math.ceil(t/n)}},_getXhr:function(e,t){var r=null==t?-1:t;return n._getFileState(e).temp.xhrs[r]},_getXhrs:function(e){return n._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){l&&qq.each(localStorage,function(t,n){if(0===t.indexOf(qq.format("qq{}resume",r))){var o=JSON.parse(n);e(t,o)}})},_initTempState:function(e){n._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){n._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var t;return l&&n.isResumable(e)&&(t=n._getLocalStorageId(e),t&&localStorage.getItem(t))?(localStorage.removeItem(t),!0):!1},_maybePrepareForResume:function(e){var t,r,o=n._getFileState(e);l&&void 0===o.key&&(t=n._getLocalStorageId(e),r=localStorage.getItem(t),r&&(r=JSON.parse(r),p(r.uuid)?n._markNotResumable(e):(g(qq.format("Identified file with ID {} and name of {} as resumable.",e,c(e))),m(e,r.uuid),o.key=r.key,o.chunking=r.chunking,o.loaded=r.loaded,o.attemptingResume=!0,n.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var t,r,o=n._getFileState(e);if(l&&n.isResumable(e)){t=n._getLocalStorageId(e),r={name:c(e),size:u(e),uuid:d(e),key:o.key,chunking:o.chunking,loaded:o.loaded,lastUpdated:Date.now()};try{localStorage.setItem(t,JSON.stringify(r))}catch(i){g(qq.format("Unable to save resume data for '{}' due to error: '{}'.",e,i.toString()),"warn")}}},_registerProgressHandler:function(e,t,r){var o=n._getXhr(e,t),i=c(e),a={simple:function(t,n){var r=u(e);t===n?h(e,i,r,r):h(e,i,t>=r?r-1:t,r)},chunked:function(o,a){var s=n._getFileState(e).temp.chunkProgress,l=n._getFileState(e).loaded,c=o,d=a,f=u(e),p=c-(d-r),m=l;s[t]=p,qq.each(s,function(e,t){m+=t}),h(e,i,m,f)}};o.upload.onprogress=function(e){if(e.lengthComputable){var t=null==r?"simple":"chunked";a[t](e.loaded,e.total)}}},_registerXhr:function(e,t,r,o){var i=null==t?-1:t,a=n._getFileState(e).temp;return a.xhrs=a.xhrs||{},a.ajaxRequesters=a.ajaxRequesters||{},a.xhrs[i]=r,o&&(a.ajaxRequesters[i]=o),r},_removeExpiredChunkingRecords:function(){var e=a.recordsExpireIn;n._iterateResumeRecords(function(t,n){var r=new Date(n.lastUpdated);r.setDate(r.getDate()+e),r.getTime()<=Date.now()&&(g("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var t=n._getFileState(e);return t.chunking||n.reevaluateChunking(e),t.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){"use strict";function t(){return"POST"===r.method.toUpperCase()?{_method:"DELETE"}:{}}var n,r={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(r,e),n=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:r.method,endpointStore:r.endpointStore,paramsStore:r.paramsStore,mandatedParams:t(),maxConnections:r.maxConnections,customHeaders:function(e){return r.customHeaders.get(e)},log:r.log,onSend:r.onDelete,onComplete:r.onDeleteComplete,cors:r.cors})),qq.extend(this,{sendDelete:function(e,t,o){var i=o||{};r.log("Submitting delete file request for "+e),"DELETE"===r.method?n.initTransport(e).withPath(t).withParams(i).send():(i[r.uuidParamName]=t,n.initTransport(e).withParams(i).send())}})},function(){function e(e){var t,n=e.naturalWidth,r=e.naturalHeight,o=document.createElement("canvas");return n*r>1048576?(o.width=o.height=1,t=o.getContext("2d"),t.drawImage(e,-n+1,0),0===t.getImageData(0,0,1,1).data[3]):!1}function t(e,t,n){var r,o,i,a,s=document.createElement("canvas"),l=0,c=n,u=n;for(s.width=1,s.height=n,r=s.getContext("2d"),r.drawImage(e,0,0),o=r.getImageData(0,0,1,n).data;u>l;)i=o[4*(u-1)+3],0===i?c=u:l=u,u=c+l>>1;return a=u/n,0===a?1:a}function n(e,t,n,r){var i=document.createElement("canvas"),a=n.mime||"image/jpeg",s=new qq.Promise;return o(e,t,i,n,r).then(function(){s.success(i.toDataURL(a,n.quality||.8))}),s}function r(e){var t=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");return e.origHeight*e.origWidth>t?{newHeight:Math.round(Math.sqrt(t*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(t*(e.origWidth/e.origHeight)))}:void 0}function o(n,o,s,l,c){var u,d=n.naturalWidth,f=n.naturalHeight,p=l.width,m=l.height,h=s.getContext("2d"),g=new qq.Promise;return h.save(),l.resize?i({blob:o,canvas:s,image:n,imageHeight:f,imageWidth:d,orientation:l.orientation,resize:l.resize,targetHeight:m,targetWidth:p}):(qq.supportedFeatures.unlimitedScaledImageSize||(u=r({origWidth:p,origHeight:m}),u&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",p,m,u.newWidth,u.newHeight),"warn"),p=u.newWidth,m=u.newHeight)),a(s,p,m,l.orientation),qq.ios()?!function(){e(n)&&(d/=2,f/=2);var r,o,i,a=1024,s=document.createElement("canvas"),l=c?t(n,d,f):1,u=Math.ceil(a*p/d),g=Math.ceil(a*m/f/l),v=0,_=0;for(s.width=s.height=a,r=s.getContext("2d");f>v;){for(o=0,i=0;d>o;)r.clearRect(0,0,a,a),r.drawImage(n,-o,-v),h.drawImage(s,0,0,a,a,i,_,u,g),o+=a,i+=u;v+=a,_+=g}h.restore(),s=r=null}():h.drawImage(n,0,0,p,m),s.qqImageRendered&&s.qqImageRendered(),g.success(),g)}function i(e){var t=e.blob,n=e.image,r=e.imageHeight,o=e.imageWidth,i=e.orientation,s=new qq.Promise,l=e.resize,c=document.createElement("canvas"),u=c.getContext("2d"),d=e.canvas,f=e.targetHeight,p=e.targetWidth;return a(c,o,r,i),d.height=f,d.width=p,u.drawImage(n,0,0),l({blob:t,height:f,image:n,sourceCanvas:c,targetCanvas:d,width:p}).then(function(){d.qqImageRendered&&d.qqImageRendered(),s.success()},s.failure),s}function a(e,t,n,r){switch(r){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var o=e.getContext("2d");switch(r){case 2:o.translate(t,0),o.scale(-1,1);break;case 3:o.translate(t,n),o.rotate(Math.PI);break;case 4:o.translate(0,n),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-n);break;case 7:o.rotate(.5*Math.PI),o.translate(t,-n),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-t,0)}}function s(e,t){var n=this;window.Blob&&e instanceof Blob&&!function(){var t=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!r)throw Error("No createObjectURL function found to create blob url");t.src=r.createObjectURL(e),n.blob=e,e=t}(),e.naturalWidth||e.naturalHeight||(e.onload=function(){var e=n.imageLoadListeners;e&&(n.imageLoadListeners=null,setTimeout(function(){for(var t=0,n=e.length;n>t;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}s.prototype.render=function(e,t){t=t||{};var r,i=this,a=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,l=t.width,c=t.height,u=t.maxWidth,d=t.maxHeight,f=!this.blob||"image/jpeg"===this.blob.type,p=e.tagName.toLowerCase();return this.imageLoadListeners?void this.imageLoadListeners.push(function(){i.render(e,t)}):(l&&!c?c=s*l/a<<0:c&&!l?l=a*c/s<<0:(l=a,c=s),u&&l>u&&(l=u,c=s*l/a<<0),d&&c>d&&(c=d,l=a*c/s<<0),r={width:l,height:c},qq.each(t,function(e,t){r[e]=t}),"img"===p?!function(){var t=e.src;n(i.srcImage,i.blob,r,f).then(function(n){e.src=n,t===e.src&&e.onload()})}():"canvas"===p&&o(this.srcImage,this.blob,e,r,f),void("function"==typeof this.onrender&&this.onrender(e)))},qq.MegaPixImage=s}(),qq.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function n(e){return"canvas"===e.tagName.toLowerCase()}function r(){return void 0!==(new Image).crossOrigin}function o(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function i(e){var t=e.split("/"),n=t[t.length-1].split("?")[0],r=qq.getExtension(n);switch(r=r&&r.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function a(e){var t,n,r,o=document.createElement("a");return o.href=e,t=o.protocol,r=o.port,n=o.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()?!0:n.toLowerCase()!==window.location.hostname.toLowerCase()?!0:r===window.location.port||qq.ie()?!1:!0}function s(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}function l(e,t){e.qqImageRendered=function(){t.success(e)}}function c(r,o){var i=t(r)||n(r);return t(r)?s(r,o):n(r)?l(r,o):(o.failure(r),e(qq.format("Element container of type {} is not supported!",r.tagName),"error")),i}function u(t,n,r){var o=new qq.Promise,i=new qq.Identify(t,e),a=r.maxSize,s=null==r.orient?!0:r.orient,l=function(){n.onerror=null,n.onload=null,e("Could not render preview, file may be too large!","error"),o.failure(n,"Browser cannot render image!")};return i.isPreviewable().then(function(i){var u={parse:function(){return(new qq.Promise).success()}},d=s?new qq.Exif(t,e):u,f=new qq.MegaPixImage(t,l);c(n,o)&&d.parse().then(function(e){var t=e&&e.Orientation;f.render(n,{maxWidth:a,maxHeight:a,orientation:t,mime:i,resize:r.customResizeFunction})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),f.render(n,{maxWidth:a,maxHeight:a,mime:i,resize:r.customResizeFunction})})},function(){e("Not previewable"),o.failure(n,"Not previewable")}),o}function d(e,t,n,r,o){var s=new Image,l=new qq.Promise;c(s,l),a(e)&&(s.crossOrigin="anonymous"),s.src=e,l.then(function(){c(t,n);var a=new qq.MegaPixImage(s);a.render(t,{maxWidth:r,maxHeight:r,mime:i(e),resize:o})},n.failure)}function f(e,t,n,r){c(t,n),qq(t).css({maxWidth:r+"px",maxHeight:r+"px"}),t.src=e}function p(e,i,s){var l=new qq.Promise,u=s.scale,p=u?s.maxSize:null;return u&&t(i)?o()?a(e)&&!r()?f(e,i,l,p):d(e,i,l,p):f(e,i,l,p):n(i)?d(e,i,l,p):c(i,l)&&(i.src=e),l}qq.extend(this,{generate:function(t,n,r){return qq.isString(t)?(e("Attempting to update thumbnail based on server response."),p(t,n,r||{})):(e("Attempting to draw client-side image preview."),
u(t,n,r||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=a,this._testing.determineMimeOfFileName=i},qq.Exif=function(e,t){"use strict";function n(e){for(var t=0,n=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function r(t,n){var o=t,i=n;return void 0===o&&(o=2,i=new qq.Promise),qq.readBlobToHex(e,o,4).then(function(e){var t,n=/^ffe([0-9])/.exec(e);n?"1"!==n[1]?(t=parseInt(e.slice(4,8),16),r(o+t+2,i)):i.success(o):i.failure("No EXIF header to be found!")}),i}function o(){var t=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(e){0!==e.indexOf("ffd8")?t.failure("Not a valid JPEG!"):r().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}function i(t){var n=new qq.Promise;return qq.readBlobToHex(e,t+10,2).then(function(e){n.success("4949"===e)}),n}function a(t,r){var o=new qq.Promise;return qq.readBlobToHex(e,t+18,2).then(function(e){return r?o.success(n(e)):void o.success(parseInt(e,16))}),o}function s(t,n){var r=t+20,o=12*n;return qq.readBlobToHex(e,r,o)}function l(e){for(var t=[],n=0;n+24<=e.length;)t.push(e.slice(n,n+24)),n+=24;return t}function c(e,t){var r=16,o=qq.extend([],u),i={};return qq.each(t,function(t,a){var s,l,c,u=a.slice(0,4),f=e?n(u):parseInt(u,16),p=o.indexOf(f);return p>=0&&(l=d[f].name,c=d[f].bytes,s=a.slice(r,r+2*c),i[l]=e?n(s):parseInt(s,16),o.splice(p,1)),0===o.length?!1:void 0}),i}var u=[274],d={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var n=new qq.Promise,r=function(e){t(qq.format("EXIF header parse failed: '{}' ",e)),n.failure(e)};return o().then(function(o){t(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),i(o).then(function(e){t(qq.format("EXIF Byte order is {} endian",e?"little":"big")),a(o,e).then(function(i){t(qq.format("Found {} APP1 directory entries",i)),s(o,i).then(function(r){var o=l(r),i=c(e,o);t("Successfully parsed some EXIF tags"),n.success(i)},r)},r)},r)},r),n}}),this._testing={},this._testing.parseLittleEndian=n},qq.Identify=function(e,t){"use strict";function n(e,t){var n=!1,r=[].concat(e);return qq.each(r,function(e,r){return 0===t.indexOf(r)?(n=!0,!1):void 0}),n}qq.extend(this,{isPreviewable:function(){var r=this,o=new qq.Promise,i=!1,a=void 0===e.name?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",a)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(e){qq.each(r.PREVIEWABLE_MIME_TYPES,function(t,r){return n(r,e)?(("image/tiff"!==t||qq.supportedFeatures.tiffPreviews)&&(i=!0,o.success(t)),!1):void 0}),t(qq.format("'{}' is {} able to be rendered in this browser",a,i?"":"NOT")),i||o.failure()},function(){t("Error reading file w/ name '"+a+"'.  Not able to be rendered in this browser."),o.failure()})):o.failure(),o},isPreviewableSync:function(){var n=e.type,r=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,o=!1,i=void 0===e.name?"blob":e.name;return r&&(o="image/tiff"===n?qq.supportedFeatures.tiffPreviews:!0),!o&&t(i+" is not previewable in this browser per the blob's type attr"),o}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){"use strict";function n(e){var t=!1;return qq.each(e,function(e,n){return n>0?(t=!0,!1):void 0}),t}function r(){var n=new qq.Promise;return new qq.Identify(e,t).isPreviewable().then(function(){var r=new Image,o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o?(r.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),n.failure()},r.onload=function(){n.success({width:this.width,height:this.height})},r.src=o.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),n.failure())},n.failure),n}function o(e,t){var n;return qq.each(e,function(e,r){if(r>0){var o=/(max|min)(Width|Height)/.exec(e),i=o[2].charAt(0).toLowerCase()+o[2].slice(1),a=t[i];switch(o[1]){case"min":if(r>a)return n=e,!1;break;case"max":if(a>r)return n=e,!1}}}),n}this.validate=function(e){var i=new qq.Promise;return t("Attempting to validate image."),n(e)?r().then(function(t){var n=o(e,t);n?i.failure(n):i.success()},i.success):i.success(),i}},qq.Session=function(e){"use strict";function t(e){return qq.isArray(e)?!0:void r.log("Session response is not an array.","error")}function n(e,n,o,i){var a=!1;n=n&&t(e),n&&qq.each(e,function(e,t){if(null==t.uuid)a=!0,r.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==t.name)a=!0,r.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return r.addFileRecord(t),!0}catch(n){a=!0,r.log(n.message,"error")}return!1}),i[n&&!a?"success":"failure"](e,o)}var r={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};qq.extend(r,e,!0),this.refresh=function(){var e=new qq.Promise,t=function(t,r,o){n(t,r,o,e)},o=qq.extend({},r),i=new qq.SessionAjaxRequester(qq.extend(o,{onComplete:t}));return i.queryServer(),e}},qq.SessionAjaxRequester=function(e){"use strict";function t(e,t,n){var o=null;if(null!=t.responseText)try{o=qq.parseJson(t.responseText)}catch(i){r.log("Problem parsing session response: "+i.message,"error"),n=!0}r.onComplete(o,!n,t)}var n,r={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(r,e),n=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return r.endpoint}},customHeaders:r.customHeaders,log:r.log,onComplete:t,cors:r.cors})),qq.extend(this,{queryServer:function(){var e=qq.extend({},r.params);r.log("Session query request."),n.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qq.Scaler=function(e,t){"use strict";var n=e.customResizer,r=e.sendOriginal,o=e.orient,i=e.defaultType,a=e.defaultQuality/100,s=e.failureText,l=e.includeExif,c=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&c.length>0,getFileRecords:function(e,u,d){var f=this,p=[],m=d.blob?d.blob:d,h=new qq.Identify(m,t);return h.isPreviewableSync()?(qq.each(c,function(e,r){var c=f._determineOutputType({defaultType:i,requestedType:r.type,refType:m.type});p.push({uuid:qq.getUniqueId(),name:f._getName(u,{name:r.name,type:c,refType:m.type}),blob:new qq.BlobProxy(m,qq.bind(f._generateScaledImage,f,{customResizeFunction:n,maxSize:r.maxSize,orient:o,type:c,quality:a,failedText:s,includeExif:l,log:t}))})}),p.push({uuid:e,name:u,size:m.size,blob:r?m:null})):p.push({uuid:e,name:u,size:m.size,blob:m}),p},handleNewFile:function(e,t,n,r,o,i,a,s){var l=this,c=(e.qqButtonId||e.blob&&e.blob.qqButtonId,[]),u=null,d=s.addFileToHandler,f=s.uploadData,p=s.paramsStore,m=qq.getUniqueId();qq.each(l.getFileRecords(n,t,e),function(e,t){var n,r=t.size;t.blob instanceof qq.BlobProxy&&(r=-1),n=f.addFile({uuid:t.uuid,name:t.name,size:r,batchId:i,proxyGroupId:m}),t.blob instanceof qq.BlobProxy?c.push(n):u=n,t.blob?(d(n,t.blob),o.push({id:n,file:t.blob})):f.setStatus(n,qq.status.REJECTED)}),null!==u&&(qq.each(c,function(e,t){var n={qqparentuuid:f.retrieve({id:u}).uuid,qqparentsize:f.retrieve({id:u}).size};n[a]=f.retrieve({id:t}).uuid,f.setParentId(t,u),p.addReadOnly(t,n)}),c.length&&!function(){var e={};e[a]=f.retrieve({id:u}).uuid,p.addReadOnly(u,e)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var r=new qq.Promise,o=n.log,i=n.getFile(e),a=n.uploadData.retrieve({id:e}),s=a&&a.name,l=a&&a.uuid,c={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},u=new qq.Scaler(c,o);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&i?qq.bind(function(){var t=u.getFileRecords(l,s,i)[0];t&&t.blob instanceof qq.BlobProxy?t.blob.create().then(r.success,r.failure):(o(e+" is not a scalable image!","error"),r.failure())},this)():(r.failure(),o("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),r},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,r=e.refType;return n||t?t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?qq.supportedFeatures.tiffPreviews?t:n:t:n:"image/jpeg"!==r?"image/png":r},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),r=t.type||"image/png",o=t.refType,i="",a=qq.getExtension(e),s="";return t.name&&t.name.trim().length&&(s=" ("+t.name+")"),n>=0?(i=e.substr(0,n),o!==r&&(a=r.split("/")[1]),i+=s+"."+a):i=e+s,i},_getSortedSizes:function(e){"use strict";return e=qq.extend([],e),e.sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var n=this,r=e.customResizeFunction,o=e.log,i=e.maxSize,a=e.orient,s=e.type,l=e.quality,c=e.failedText,u=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===s,d=new qq.Promise,f=new qq.ImageGenerator(o),p=document.createElement("canvas");return o("Attempting to generate scaled version for "+t.name),f.generate(t,p,{maxSize:i,orient:a,customResizeFunction:r}).then(function(){var e=p.toDataURL(s,l),r=function(){o("Success generating scaled version for "+t.name);var n=qq.dataUriToBlob(e);d.success(n)};u?n._insertExifHeader(t,e,o).then(function(t){e=t,r()},function(){o("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),r()}):r()},function(){o("Failed attempt to generate scaled version for "+t.name,"error"),d.failure(c)}),d},_insertExifHeader:function(e,t,n){"use strict";var r=new FileReader,o=new qq.Promise,i="";return r.onload=function(){i=r.result,o.success(qq.ExifRestorer.restore(i,t))},r.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),o.failure()},r.readAsDataURL(e),o},_dataUriToBlob:function(e){"use strict";var t,n,r,o;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),qq.each(t,function(e,t){o[e]=t.charCodeAt(0)}),this._createBlob(r,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(e){var t,n,r,o,i,a="",s="",l="",c=0;do t=e[c++],n=e[c++],s=e[c++],r=t>>2,o=(3&t)<<4|n>>4,i=(15&n)<<2|s>>6,l=63&s,isNaN(n)?i=l=64:isNaN(s)&&(l=64),a=a+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(l),t=n=s="",r=o=i=l="";while(c<e.length);return a},e.restore=function(e,t){var n="data:image/jpeg;base64,";if(!e.match(n))return t;var r=this.decode64(e.replace(n,"")),o=this.slice2Segments(r),i=this.exifManipulation(t,o);return n+this.encode64(i)},e.exifManipulation=function(e,t){var n=this.getExifArray(t),r=this.insertExif(e,n),o=new Uint8Array(r);return o},e.getExifArray=function(e){for(var t,n=0;n<e.length;n++)if(t=e[n],255==t[0]&225==t[1])return t;return[]},e.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),r=this.decode64(n),o=r.indexOf(255,3),i=r.slice(0,o),a=r.slice(o),s=i;return s=s.concat(t),s=s.concat(a)},e.slice2Segments=function(e){for(var t=0,n=[];;){if(255==e[t]&218==e[t+1])break;if(255==e[t]&216==e[t+1])t+=2;else{var r=256*e[t+2]+e[t+3],o=t+r+2,i=e.slice(t,o);n.push(i),t=o}if(t>e.length)break}return n},e.decode64=function(e){var t,n,r,o,i,a="",s="",l=0,c=[],u=/[^A-Za-z0-9\+\/\=]/g;if(u.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=this.KEY_STR.indexOf(e.charAt(l++)),o=this.KEY_STR.indexOf(e.charAt(l++)),i=this.KEY_STR.indexOf(e.charAt(l++)),s=this.KEY_STR.indexOf(e.charAt(l++)),t=r<<2|o>>4,n=(15&o)<<4|i>>2,a=(3&i)<<6|s,c.push(t),64!=i&&c.push(n),64!=s&&c.push(a),t=n=a="",r=o=i=s="";while(l<e.length);return c},e}(),qq.TotalProgress=function(e,t){"use strict";var n={},r=0,o=0,i=-1,a=-1,s=function(t,n){(t!==i||n!==a)&&e(t,n),i=t,a=n},l=function(e,t){var n=!0;return qq.each(e,function(e,r){return qq.indexOf(t,r)>=0?(n=!1,!1):void 0}),n},c=function(e){f(e,-1,-1),delete n[e]},u=function(e,t,n){(0===t.length||l(t,n))&&(s(o,o),this.reset())},d=function(e){var r=t(e);r>0&&(f(e,0,r),n[e]={loaded:0,total:r})},f=function(e,t,i){var a=n[e]?n[e].loaded:0,l=n[e]?n[e].total:0;-1===t&&-1===i?(r-=a,o-=l):(t&&(r+=t-a),i&&(o+=i-l)),s(r,o)};qq.extend(this,{onAllComplete:u,onStatusChange:function(e,t,n){n===qq.status.CANCELED||n===qq.status.REJECTED?c(e):n===qq.status.SUBMITTING&&d(e)},onIndividualProgress:function(e,t,r){f(e,t,r),n[e]={loaded:t,total:r}},onNewSize:function(e){d(e)},reset:function(){n={},r=0,o=0}})},qq.PasteSupport=function(e){"use strict";function t(e){return e.type&&0===e.type.indexOf("image/")}function n(){i=qq(o.targetElement).attach("paste",function(e){var n=e.clipboardData;n&&qq.each(n.items,function(e,n){if(t(n)){var r=n.getAsFile();o.callbacks.pasteReceived(r)}})})}function r(){i&&i()}var o,i;o={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},qq.extend(o,e),n(),qq.extend(this,{reset:function(){r()}})},qq.FormSupport=function(e,t,n){"use strict";function r(e){e.getAttribute("action")&&(s.newEndpoint=e.getAttribute("action"))}function o(e,t){return!e.checkValidity||e.checkValidity()?!0:(n("Form did not pass validation checks - will not upload.","error"),void t())}function i(e){var n=e.submit;qq(e).attach("submit",function(r){r=r||window.event,r.preventDefault?r.preventDefault():r.returnValue=!1,o(e,n)&&t()}),e.submit=function(){o(e,n)&&t()}}function a(e){return e&&(qq.isString(e)&&(e=document.getElementById(e)),e&&(n("Attaching to form element."),r(e),l&&i(e))),e}var s=this,l=e.interceptSubmit,c=e.element,u=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:u,attachedToForm:!1,getFormInputsAsObject:function(){return null==c?null:s._form2Obj(c)}}),c=a(c),this.attachedToForm=!!c},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){var t=["button","image","reset","submit"];return qq.indexOf(t,e.toLowerCase())<0},r=function(e){return qq.indexOf(["checkbox","radio"],e.toLowerCase())>=0},o=function(e){return r(e.type)&&!e.checked?!0:e.disabled&&"hidden"!==e.type.toLowerCase()},i=function(e){var t=null;return qq.each(qq(e).children(),function(e,n){return"option"===n.tagName.toLowerCase()&&n.selected?(t=n.value,!1):void 0}),t};return qq.each(e.elements,function(e,r){if(!qq.isInput(r,!0)&&"textarea"!==r.tagName.toLowerCase()||!n(r.type)||o(r)){if("select"===r.tagName.toLowerCase()&&!o(r)){var a=i(r);null!==a&&(t[r.name]=a)}}else t[r.name]=r.value}),t}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){"use strict";function n(e,t){var n,r,i;try{r=t.contentDocument||t.contentWindow.document,i=r.body.innerHTML,s("converting iframe's innerHTML to JSON"),s("innerHTML = "+i),i&&i.match(/^<pre/i)&&(i=r.body.firstChild.firstChild.nodeValue),n=o._parseJsonResponse(i)}catch(a){s("Error when attempting to parse form upload response ("+a.message+")","error"),n={success:!1}}return n}function r(t,n){var r=e.paramsStore.get(t),s="get"===e.method.toLowerCase()?"GET":"POST",l=e.endpointStore.get(t),c=i(t);return r[e.uuidName]=a(t),r[e.filenameParam]=c,o._initFormForUpload({method:s,endpoint:l,params:r,paramsInBody:e.paramsInBody,targetName:n.name})}var o=this,i=t.getName,a=t.getUuid,s=t.log;this.uploadFile=function(t){var i,a=o.getInput(t),l=o._createIframe(t),c=new qq.Promise;return i=r(t,l),i.appendChild(a),o._attachLoadEvent(l,function(r){s("iframe loaded");var i=r?r:n(t,l);o._detachLoadEvent(t),e.cors.expected||qq(l).remove(),i.success?c.success(i):c.failure(i)}),s("Sending upload request for "+t),i.submit(),qq(i).remove(),c},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:i,getUuid:a,log:s}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){"use strict";var n=this,r=t.getName,o=t.getSize,i=t.getUuid,a=t.log,s=e.forceMultipart||e.paramsInBody,l=function(t,n,i){var a=o(t),l=r(t);n[e.chunking.paramNames.partIndex]=i.part,n[e.chunking.paramNames.partByteOffset]=i.start,n[e.chunking.paramNames.chunkSize]=i.size,n[e.chunking.paramNames.totalParts]=i.count,n[e.totalFileSizeName]=a,s&&(n[e.filenameParam]=l)},c=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,log:a}),u=function(e,t){var n=new qq.Promise;return t.onreadystatechange=function(){if(4===t.readyState){var r=p(e,t);r.success?n.success(r.response,t):n.failure(r.response,t)}},n},d=function(t){var a=e.paramsStore.get(t),s=r(t),l=o(t);return a[e.uuidName]=i(t),a[e.filenameParam]=s,a[e.totalFileSizeName]=l,a[e.chunking.paramNames.totalParts]=n._getTotalChunks(t),a},f=function(e,t){return qq.indexOf([200,201,202,203,204],e.status)<0||!t.success||t.reset},p=function(e,t){var n;return a("xhr - server response received for "+e),a("responseText = "+t.responseText),n=m(!0,t),{success:!f(t,n),response:n}},m=function(e,t){var n={};try{a(qq.format("Received response status {} with body: {}",t.status,t.responseText)),n=qq.parseJson(t.responseText)}catch(r){e&&a("Error when attempting to parse xhr response text ("+r.message+")","error")}return n},h=function(t){var r=new qq.Promise;return c.complete(t,n._createXhr(t),d(t),e.customHeaders.get(t)).then(function(e){r.success(m(!1,e),e)},function(e){r.failure(m(!1,e),e)}),r},g=function(t,n,a,l){var c=new FormData,u=e.method,d=e.endpointStore.get(l),f=r(l),p=o(l);return t[e.uuidName]=i(l),t[e.filenameParam]=f,s&&(t[e.totalFileSizeName]=p),e.paramsInBody||(s||(t[e.inputName]=f),d=qq.obj2url(t,d)),n.open(u,d,!0),e.cors.expected&&e.cors.sendCredentials&&(n.withCredentials=!0),s?(e.paramsInBody&&qq.obj2FormData(t,c),c.append(e.inputName,a),c):a},v=function(t,r){var o=e.customHeaders.get(t),i=n.getFile(t);r.setRequestHeader("Accept","application/json"),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"),s||(r.setRequestHeader("Content-Type","application/octet-stream"),r.setRequestHeader("X-Mime-Type",i.type)),qq.each(o,function(e,t){r.setRequestHeader(e,t)})};qq.extend(this,{uploadChunk:function(t,r,i){var a,s,c,d=n._getChunkData(t,r),f=n._createXhr(t,r);o(t);return a=u(t,f),n._registerProgressHandler(t,r,d.size),c=e.paramsStore.get(t),l(t,c,d),i&&(c[e.resume.paramNames.resuming]=!0),s=g(c,f,d.blob,t),v(t,f),f.send(s),a},uploadFile:function(t){var r,o,i,a,s=n.getFile(t);return o=n._createXhr(t),n._registerProgressHandler(t),r=u(t,o),i=e.paramsStore.get(t),a=g(i,o,s,t),v(t,o),o.send(a),r}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(t){return{finalizeChunks:function(n){return e.chunking.success.endpoint?h(n):t.finalizeChunks(n,qq.bind(m,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,n="POST",r={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){}},o={},i={get:function(e){return r.endpoint}};qq.extend(r,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:[n],method:n,endpointStore:i,allowXRequestedWithAndCacheControl:!1,cors:r.cors,log:r.log,onComplete:function(e,t,n){var r=o[e];delete o[e],n?r.failure(t):r.success(t)}})),qq.extend(this,{complete:function(e,n,i,a){var s=new qq.Promise;return r.log("Submitting All Chunks Done request for "+e),o[e]=s,t.initTransport(e).withParams(i).withHeaders(a).send(n),s}})},qq.DragAndDrop=function(e){"use strict";function t(e,t){var n=Array.prototype.slice.call(e);c.callbacks.dropLog("Grabbed "+e.length+" dropped files."),t.dropDisabled(!1),c.callbacks.processingDroppedFilesComplete(n,t.getElement())}function n(e){var t=new qq.Promise;return e.isFile?e.file(function(n){var r=e.name,o=e.fullPath,i=o.indexOf(r);o=o.substr(0,i),"/"===o.charAt(0)&&(o=o.substr(1)),n.qqPath=o,p.push(n),t.success()},function(n){c.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error"),t.failure()}):e.isDirectory&&r(e).then(function(e){var r=e.length;qq.each(e,function(e,o){n(o).done(function(){r-=1,0===r&&t.success()})}),e.length||t.success()},function(n){c.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error"),t.failure()}),t}function r(e,t,n,o){var i=o||new qq.Promise,a=t||e.createReader();return a.readEntries(function(t){var o=n?n.concat(t):t;t.length?setTimeout(function(){r(e,a,o,i)},0):i.success(o)},i.failure),i}function o(e,t){var r=[],o=new qq.Promise;return c.callbacks.processingDroppedFiles(),t.dropDisabled(!0),e.files.length>1&&!c.allowMultipleItems?(c.callbacks.processingDroppedFilesComplete([]),c.callbacks.dropError("tooManyFilesError",""),t.dropDisabled(!1),o.failure()):(p=[],qq.isFolderDropSupported(e)?qq.each(e.items,function(e,t){var i=t.webkitGetAsEntry();i&&(i.isFile?p.push(t.getAsFile()):r.push(n(i).done(function(){r.pop(),0===r.length&&o.success()})))}):p=e.files,0===r.length&&o.success()),o}function i(e){var n=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:u,element:e,onEnter:function(t){qq(e).addClass(c.classes.dropActive),t.stopPropagation()},onLeaveNotDescendants:function(t){qq(e).removeClass(c.classes.dropActive)},onDrop:function(e){o(e.dataTransfer,n).then(function(){t(p,n)},function(){c.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return m.addDisposer(function(){n.dispose()}),qq(e).hasAttribute(d)&&qq(e).hide(),f.push(n),n}function a(e){var t;return qq.each(e.dataTransfer.types,function(e,n){return"Files"===n?(t=!0,!1):void 0}),t}function s(e){return qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function l(){var e=c.dropZoneElements,t=function(){setTimeout(function(){qq.each(e,function(e,t){qq(t).hasAttribute(d)&&qq(t).hide(),qq(t).removeClass(c.classes.dropActive)})},10)};qq.each(e,function(t,n){var r=i(n);e.length&&qq.supportedFeatures.fileDrop&&m.attach(document,"dragenter",function(t){!r.dropDisabled()&&a(t)&&qq.each(e,function(e,t){t instanceof HTMLElement&&qq(t).hasAttribute(d)&&qq(t).css({display:"block"})})})}),m.attach(document,"dragleave",function(e){s(e)&&t()}),m.attach(qq(document).children()[0],"mouseenter",function(e){t()}),m.attach(document,"drop",function(e){a(e)&&(e.preventDefault(),t())}),m.attach(document,u,t)}var c,u="qq-hidezones",d="qq-hide-dropzone",f=[],p=[],m=new qq.DisposeSupport;c={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(c,e,!0),l(),qq.extend(this,{setupExtraDropzone:function(e){c.dropZoneElements.push(e),i(e)},removeDropzone:function(e){var t,n=c.dropZoneElements;for(t in n)if(n[t]===e)return n.splice(t,1)},dispose:function(){m.dispose(),qq.each(f,function(e,t){t.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){"use strict";function t(){return qq.safari()||qq.firefox()&&qq.windows()}function n(e){u||(t?d.attach(document,"dragover",function(e){e.preventDefault()}):d.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),u=!0)}function r(e){if(!qq.supportedFeatures.fileDrop)return!1;var t,n=e.dataTransfer,r=qq.safari();return t=qq.ie()&&qq.supportedFeatures.fileDrop?!0:"none"!==n.effectAllowed,n&&t&&(n.files&&n.files.length||!r&&n.types.contains&&n.types.contains("Files")||n.types.includes&&n.types.includes("Files"))}function o(e){return void 0!==e&&(c=e),c}function i(){function e(){t=document.createEvent("Event"),t.initEvent(s.HIDE_ZONES_EVENT_NAME,!0,!0)}var t;if(window.CustomEvent)try{t=new CustomEvent(s.HIDE_ZONES_EVENT_NAME)}catch(n){e()}else e();document.dispatchEvent(t)}function a(){d.attach(l,"dragover",function(e){if(r(e)){var t=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;"move"===t||"linkMove"===t?e.dataTransfer.dropEffect="move":e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()}}),d.attach(l,"dragenter",function(e){if(!o()){if(!r(e))return;s.onEnter(e)}}),d.attach(l,"dragleave",function(e){if(r(e)){s.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(t)||s.onLeaveNotDescendants(e)}}),d.attach(l,"drop",function(e){if(!o()){if(!r(e))return;e.preventDefault(),e.stopPropagation(),s.onDrop(e),i()}})}var s,l,c,u,d=new qq.DisposeSupport;s={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(s,e),l=s.element,n(),a(),qq.extend(this,{dropDisabled:function(e){return o(e)},dispose:function(){d.dispose()},getElement:function(){return l}}),this._testing={},this._testing.isValidFileDrag=r},function(){"use strict";qq.uiPublicApi={addInitialFiles:function(e){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){return this._dnd?this._dnd.removeDropzone(e):void 0},getItemByFileId:function(e){return this._templating.isHiddenForever(e)?void 0:this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}},qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,r=n.getDropZone();return r&&t.push(r),new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,r){n.hideDropProcessing(),qq.each(t,function(e,t){t.qqDropTarget=r}),t.length&&e.addFiles(t,null,null)},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,n){var r=qq(t.getEditInput(e)),o=qq(t.getFileContainer(e));n?(r.addClass("qq-editing"),t.hideFilename(e),t.hideEditIcon(e)):(r.removeClass("qq-editing"),t.showFilename(e),t.showEditIcon(e)),o.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e)),t===qq.status.UPLOAD_RETRYING&&n===qq.status.UPLOADING?(this._templating.hideRetry(e),this._templating.setStatusText(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.retrying)):n===qq.status.UPLOAD_FAILED&&this._templating.hidePause(e)},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,r){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,r),0===r||100===Math.round(n/r*100)?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,r)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,r){
function o(t){s&&(a.setStatusText(e),qq(s).removeClass(l._classes.retrying),a.hideProgress(e),l.getUploads({id:e}).status!==qq.status.UPLOAD_FAILED&&a.hideCancel(e),a.hideSpinner(e),t.success?l._markFileAsSuccessful(e):(qq(s).addClass(l._classes.fail),a.showCancel(e),a.isRetryPossible()&&!l._preventRetries[e]&&(qq(s).addClass(l._classes.retryable),a.showRetry(e)),l._controlFailureTextDisplay(e,t)))}var i=this._parent.prototype._onComplete.apply(this,arguments),a=this._templating,s=a.getFileContainer(e),l=this;return i instanceof qq.Promise?i.done(function(e){o(e)}):o(n),i},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qq(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,n,r;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],n=this._options.retry.maxAutoAttempts,r=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t),r=r.replace(/\{maxAuto\}/g,n),this._templating.setStatusText(e,r),qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var r,o=this.getName(e),i=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,o),a=(this.getUuid(e),arguments),s=this;r=this._options.showConfirm(i),qq.isGenericPromise(r)?r.then(function(){s._sendDeleteRequest.apply(s,a)}):r!==!1&&s._sendDeleteRequest.apply(s,a)},_addToList:function(e,t,n){var r,o,i=0,a=this._handler.isProxied(e)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(i=this._filesInBatchAddedToUi-1),r={index:i}),n||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(o=this.getUploads({id:e}),this._handledProxyGroup=this._handledProxyGroup||o.proxyGroupId,o.proxyGroupId===this._handledProxyGroup&&o.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),n?(this._templating.addFileToCache(e,this._options.formatFileName(t),r,a),this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(e,this._options.formatFileName(t),r,a),this._templating.generatePreview(e,this.getFile(e),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(e)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var r=this.getSize(e),o=this._formatSize(r);r>=0&&(void 0!==t&&void 0!==n&&(o=this._formatProgress(t,n)),this._templating.updateSize(e,o))},_formatProgress:function(e,t){function n(e,t){r=r.replace(e,t)}var r=this._options.text.formatProgress;return n("{percent}",Math.round(e/t*100)),n("{total_size}",this._formatSize(t)),r},_controlFailureTextDisplay:function(e,t){var n,r,o;n=this._options.failedUploadTextDisplay.mode,r=this._options.failedUploadTextDisplay.responseProperty,"custom"===n?(o=t[r],o||(o=this._options.text.failUpload),this._templating.setStatusText(e,o),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,o)):"default"===n?this._templating.setStatusText(e,this._options.text.failUpload):"none"!==n&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&this._templating.showCancel(e)},_itemError:function(e,t,n){var r=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(r)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e],n=this.getUploads({id:e}).status;n===qq.status.DELETED||!t&&!this._options.thumbnails.placeholders.waitUntilResponse&&qq.supportedFeatures.imagePreviews||this._templating.updateThumbnail(e,t,this._options.thumbnails.customResizer)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),qq.FineUploader=function(e,t){"use strict";var n=this;this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(e){return n._templating.hasDialog("alert")?n._templating.showDialog("alert",e):void setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return n._templating.hasDialog("confirm")?n._templating.showDialog("confirm",e):window.confirm(e)},showPrompt:function(e,t){return n._templating.hasDialog("prompt")?n._templating.showDialog("prompt",e,t):window.prompt(e,t)}},!0),qq.extend(this._options,e,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(e){"use strict";var t,n,r,o,i,a,s,l,c="qq-file-id",u="qq-file-id-",d="qq-max-size",f="qq-server-scale",p="qq-hide-dropzone",m="qq-drop-area-text",h="qq-in-progress",g="qq-hidden-forever",v={content:document.createDocumentFragment(),map:{}},_=!1,q=0,b=!1,y=[],w=-1,S={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},C={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},x={},T=new qq.Promise,k=new qq.Promise,P=function(){var e=S.placeholders.thumbnailNotAvailable,n=S.placeholders.waitingForThumbnail,r={maxSize:w,scale:l};s&&(e?S.imageGenerator.generate(e,new Image,r).then(function(e){T.success(e)},function(){T.failure(),t("Problem loading 'not available' placeholder image at "+e,"error")}):T.failure(),n?S.imageGenerator.generate(n,new Image,r).then(function(e){k.success(e)},function(){k.failure(),t("Problem loading 'waiting for thumbnail' placeholder image at "+n,"error")}):k.failure())},E=function(e){var t=new qq.Promise;return k.then(function(n){V(n,e),e.src?t.success():(e.src=n.src,e.onload=function(){e.onload=null,te(e),t.success()})},function(){Y(e),t.success()}),t},I=function(e,n,r){var o=W(e);return t("Generating new thumbnail for "+e),n.qqThumbnailId=e,S.imageGenerator.generate(n,o,r).then(function(){q++,te(o),x[e].success()},function(){x[e].failure(),S.placeholders.waitUntilUpdate||X(e,o)})},F=function(){if(y.length){b=!0;var e=y.shift();e.update?Q(e):Z(e)}else b=!1},D=function(e){return G(R(e),C.cancel)},M=function(e){return G(R(e),C.continueButton)},A=function(e){return G(i,C[e+"Dialog"])},U=function(e){return G(R(e),C.deleteButton)},j=function(){return G(i,C.dropProcessing)},O=function(e){return G(R(e),C.editNameIcon)},R=function(e){return v.map[e]||qq(a).getFirstByClass(u+e)},$=function(e){return G(R(e),C.file)},B=function(e){return G(R(e),C.pause)},N=function(e){return null==e?G(i,C.totalProgressBarContainer)||G(i,C.totalProgressBar):G(R(e),C.progressBarContainer)||G(R(e),C.progressBar)},L=function(e){return G(R(e),C.retry)},H=function(e){return G(R(e),C.size)},z=function(e){return G(R(e),C.spinner)},G=function(e,t){return e&&qq(e).getFirstByClass(t)},W=function(e){return s&&G(R(e),C.thumbnail)},Y=function(e){e&&qq(e).addClass(S.classes.hide)},V=function(e,t){var n=e.style.maxWidth,r=e.style.maxHeight;r&&n&&!t.style.maxWidth&&!t.style.maxHeight&&qq(t).css({maxWidth:n,maxHeight:r})},X=function(e,t){var n=x[e]||(new qq.Promise).failure(),r=new qq.Promise;return T.then(function(e){n.then(function(){r.success()},function(){V(e,t),t.onload=function(){t.onload=null,r.success()},t.src=e.src,te(t)})}),r},J=function(){var e,o,i,a,c,u,h,g,v,_,q;if(t("Parsing template"),null==S.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(S.templateIdOrEl)){if(e=document.getElementById(S.templateIdOrEl),null===e)throw new Error(qq.format("Cannot find template script at ID '{}'!",S.templateIdOrEl));o=e.innerHTML}else{if(void 0===S.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");o=S.templateIdOrEl.innerHTML}if(o=qq.trimStr(o),a=document.createElement("div"),a.appendChild(qq.toElement(o)),q=qq(a).getFirstByClass(C.uploader),S.button&&(u=qq(a).getFirstByClass(C.button),u&&qq(u).remove()),qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(v=qq(a).getFirstByClass(C.dropProcessing),v&&qq(v).remove()),h=qq(a).getFirstByClass(C.drop),h&&!qq.DragAndDrop&&(t("DnD module unavailable.","info"),qq(h).remove()),qq.supportedFeatures.fileDrop?qq(q).hasAttribute(m)&&h&&(_=qq(h).getFirstByClass(C.dropText),_&&qq(_).remove()):(q.removeAttribute(m),h&&qq(h).hasAttribute(p)&&qq(h).css({display:"none"})),g=qq(a).getFirstByClass(C.thumbnail),s?g&&(w=parseInt(g.getAttribute(d)),w=w>0?w:null,l=qq(g).hasAttribute(f)):g&&qq(g).remove(),s=s&&g,n=qq(a).getByClass(C.editFilenameInput).length>0,r=qq(a).getByClass(C.retry).length>0,i=qq(a).getFirstByClass(C.list),null==i)throw new Error("Could not find the file list container in the template!");return c=i.children[0].cloneNode(!0),i.innerHTML="",a.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),t("Template parsing complete"),{template:a,fileTemplate:c}},K=function(e,t,n){var r=n,o=r.firstChild;t>0&&(o=qq(r).children()[t].nextSibling),r.insertBefore(e,o)},Z=function(e){var t=e.id,n=e.optFileOrBlob,r=n&&n.qqThumbnailId,o=W(t),i={customResizeFunction:e.customResizeFunction,maxSize:w,orient:!0,scale:!0};qq.supportedFeatures.imagePreviews?o?S.limits.maxThumbs&&S.limits.maxThumbs<=q?(X(t,o),F()):E(o).done(function(){x[t]=new qq.Promise,x[t].done(function(){setTimeout(F,S.limits.timeBetweenThumbs)}),null!=r?ne(t,r):I(t,n,i)}):F():o&&(E(o),F())},Q=function(e){var t=e.id,n=e.thumbnailUrl,r=e.showWaitingImg,o=W(t),i={customResizeFunction:e.customResizeFunction,scale:l,maxSize:w};if(o)if(n){if(!(S.limits.maxThumbs&&S.limits.maxThumbs<=q))return r&&E(o),S.imageGenerator.generate(n,o,i).then(function(){te(o),q++,setTimeout(F,S.limits.timeBetweenThumbs)},function(){X(t,o),setTimeout(F,S.limits.timeBetweenThumbs)});X(t,o),F()}else X(t,o),F()},ee=function(e,t){var n=N(e),r=null==e?C.totalProgressBar:C.progressBar;n&&!qq(n).hasClass(r)&&(n=qq(n).getFirstByClass(r)),n&&(qq(n).css({width:t+"%"}),n.setAttribute("aria-valuenow",t))},te=function(e){e&&qq(e).removeClass(S.classes.hide)},ne=function(e,n){var r=W(e),o=W(n);t(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,n,n)),x[n].then(function(){q++,x[e].success(),t(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",n,e)),r.src=o.src,te(r)},function(){x[e].failure(),S.placeholders.waitUntilUpdate||X(e,r)})};qq.extend(S,e),t=S.log,qq.supportedFeatures.imagePreviews||(S.limits.timeBetweenThumbs=0,S.limits.maxThumbs=0),i=S.containerEl,s=void 0!==S.imageGenerator,o=J(),P(),qq.extend(this,{render:function(){t("Rendering template in DOM."),q=0,i.appendChild(o.template.cloneNode(!0)),Y(j()),this.hideTotalProgress(),a=S.fileContainerEl||G(i,C.list),t("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);i.innerHTML="",i.appendChild(t)},reset:function(){this.render()},clearFiles:function(){a.innerHTML=""},disableCancel:function(){_=!0},addFile:function(e,t,n,r,s){var l,d=o.fileTemplate.cloneNode(!0),f=G(d,C.file),p=G(i,C.uploader),h=s?v.content:a;s&&(v.map[e]=d),qq(d).addClass(u+e),p.removeAttribute(m),f&&(qq(f).setText(t),f.setAttribute("title",t)),d.setAttribute(c,e),n?K(d,n.index,h):h.appendChild(d),r?(d.style.display="none",qq(d).addClass(g)):(Y(N(e)),Y(H(e)),Y(U(e)),Y(L(e)),Y(B(e)),Y(M(e)),_&&this.hideCancel(e),l=W(e),l&&!l.src&&k.then(function(e){l.src=e.src,e.style.maxHeight&&e.style.maxWidth&&qq(l).css({maxHeight:e.style.maxHeight,maxWidth:e.style.maxWidth}),te(l)}))},addFileToCache:function(e,t,n,r){this.addFile(e,t,n,r,!0)},addCacheToDom:function(){a.appendChild(v.content),v.content=document.createDocumentFragment(),v.map={}},removeFile:function(e){qq(R(e)).remove()},getFileId:function(e){var t=e;if(t){for(;null==t.getAttribute(c);)t=t.parentNode;return parseInt(t.getAttribute(c))}},getFileList:function(){return a},markFilenameEditable:function(e){var t=$(e);t&&qq(t).addClass(S.classes.editable)},updateFilename:function(e,t){var n=$(e);n&&(qq(n).setText(t),n.setAttribute("title",t))},hideFilename:function(e){Y($(e))},showFilename:function(e){te($(e))},isFileName:function(e){return qq(e).hasClass(C.file)},getButton:function(){return S.button||G(i,C.button)},hideDropProcessing:function(){Y(j())},showDropProcessing:function(){te(j())},getDropZone:function(){return G(i,C.drop)},isEditFilenamePossible:function(){return n},hideRetry:function(e){Y(L(e))},isRetryPossible:function(){return r},showRetry:function(e){te(L(e))},getFileContainer:function(e){return R(e)},showEditIcon:function(e){var t=O(e);t&&qq(t).addClass(S.classes.editable)},isHiddenForever:function(e){return qq(R(e)).hasClass(g)},hideEditIcon:function(e){var t=O(e);t&&qq(t).removeClass(S.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(C.editNameIcon,!0)},getEditInput:function(e){return G(R(e),C.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(C.editFilenameInput,!0)},updateProgress:function(e,t,n){var r,o=N(e);o&&n>0&&(r=Math.round(t/n*100),100===r?Y(o):te(o),ee(e,r))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=N(e);t&&Y(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){ee(e,0),this.hideTotalProgress(e)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!_){var t=D(e);t&&qq(t).removeClass(S.classes.hide)}},hideCancel:function(e){Y(D(e))},isCancel:function(e){return qq(e).hasClass(C.cancel,!0)},allowPause:function(e){te(B(e)),Y(M(e))},uploadPaused:function(e){this.setStatusText(e,S.text.paused),this.allowContinueButton(e),Y(z(e))},hidePause:function(e){Y(B(e))},isPause:function(e){return qq(e).hasClass(C.pause,!0)},isContinueButton:function(e){return qq(e).hasClass(C.continueButton,!0)},allowContinueButton:function(e){te(M(e)),Y(B(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),te(z(e))},showDeleteButton:function(e){te(U(e))},hideDeleteButton:function(e){Y(U(e))},isDeleteButton:function(e){return qq(e).hasClass(C.deleteButton,!0)},isRetry:function(e){return qq(e).hasClass(C.retry,!0)},updateSize:function(e,t){var n=H(e);n&&(te(n),qq(n).setText(t))},setStatusText:function(e,t){var n=G(R(e),C.statusText);n&&(null==t?qq(n).clearText():qq(n).setText(t))},hideSpinner:function(e){qq(R(e)).removeClass(h),Y(z(e))},showSpinner:function(e){qq(R(e)).addClass(h),te(z(e))},generatePreview:function(e,t,n){this.isHiddenForever(e)||(y.push({id:e,customResizeFunction:n,optFileOrBlob:t}),!b&&F())},updateThumbnail:function(e,t,n,r){this.isHiddenForever(e)||(y.push({customResizeFunction:r,update:!0,id:e,thumbnailUrl:t,showWaitingImg:n}),!b&&F())},hasDialog:function(e){return qq.supportedFeatures.dialogElement&&!!A(e)},showDialog:function(e,t,n){var r=A(e),o=G(r,C.dialogMessage),i=r.getElementsByTagName("INPUT")[0],a=G(r,C.dialogCancelButton),s=G(r,C.dialogOkButton),l=new qq.Promise,c=function(){a.removeEventListener("click",u),s&&s.removeEventListener("click",d),l.failure()},u=function(){a.removeEventListener("click",u),r.close()},d=function(){r.removeEventListener("close",c),s.removeEventListener("click",d),r.close(),l.success(i&&i.value)};return r.addEventListener("close",c),a.addEventListener("click",u),s&&s.addEventListener("click",d),i&&(i.value=n),o.textContent=t,r.showModal(),l}})},qq.UiEventHandler=function(e,t){"use strict";function n(e){r.attach(e,o.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;o.onHandled(t,e)})}var r=new qq.DisposeSupport,o={eventType:"click",attachTo:null,onHandled:function(e,t){}};qq.extend(this,{addHandler:function(e){n(e)},dispose:function(){r.dispose()}}),qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return r}}),qq.extend(o,e),o.attachTo&&n(o.attachTo)},qq.FileButtonsClickHandler=function(e){"use strict";function t(e,t){qq.each(o,function(n,o){var i,a=n.charAt(0).toUpperCase()+n.slice(1);return r.templating["is"+a](e)?(i=r.templating.getFileId(e),qq.preventDefault(t),r.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",r.onGetName(i),i)),o(i),!1):void 0})}var n={},r={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},o={cancel:function(e){r.onCancel(e)},retry:function(e){r.onRetry(e)},deleteButton:function(e){r.onDeleteFile(e)},pause:function(e){r.onPause(e)},continueButton:function(e){r.onContinue(e)}};qq.extend(r,e),r.eventType="click",r.onHandled=t,r.attachTo=r.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(r,n))},qq.FilenameClickHandler=function(e){"use strict";function t(e,t){if(r.templating.isFileName(e)||r.templating.isEditIcon(e)){var o=r.templating.getFileId(e),i=r.onGetUploadStatus(o);i===qq.status.SUBMITTED&&(r.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",r.onGetName(o),o)),qq.preventDefault(t),n.handleFilenameEdit(o,e,!0))}}var n={},r={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(r,e),r.eventType="click",r.onHandled=t,qq.extend(this,new qq.FilenameEditHandler(r,n))},qq.FilenameInputFocusInHandler=function(e,t){"use strict";function n(e,n){if(r.templating.isEditInput(e)){var o=r.templating.getFileId(e),i=r.onGetUploadStatus(o);i===qq.status.SUBMITTED&&(r.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",r.onGetName(o),o)),t.handleFilenameEdit(o,e))}}var r={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};t||(t={}),r.eventType="focusin",r.onHandled=n,qq.extend(r,e),qq.extend(this,new qq.FilenameEditHandler(r,t))},qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))},qq.FilenameEditHandler=function(e,t){"use strict";function n(e){var t=s.onGetName(e),n=t.lastIndexOf(".");return n>0&&(t=t.substr(0,n)),t}function r(e){var t=s.onGetName(e);return qq.getExtension(t)}function o(e,t){var n,o=e.value;void 0!==o&&qq.trimStr(o).length>0&&(n=r(t),void 0!==n&&(o=o+"."+n),s.onSetName(t,o)),s.onEditingStatusChange(t,!1)}function i(e,n){t.getDisposeSupport().attach(e,"blur",function(){o(e,n)})}function a(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){var r=t.keyCode||t.which;13===r&&o(e,n)})}var s={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};qq.extend(s,e),s.attachTo=s.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(s,t)),qq.extend(t,{handleFilenameEdit:function(e,t,r){var o=s.templating.getEditInput(e);s.onEditingStatusChange(e,!0),o.value=n(e),r&&o.focus(),i(o,e),a(o,e)}})}}(window),define("directives/fineUpload",["base","fineuploader"],function(e,t){return e.directive("fineUpload",["$timeout",function(e){return{scope:{multiple:"=",endpoint:"@",templateId:"@",sizeLimit:"@",allowedExtensions:"=",onCompleteCallback:"=",onUploadCallback:"=",onValidateBatch:"=",onErrorCallback:"=",onSubmitCallback:"=",onCancelCallback:"=",autoUpload:"=",params:"=",control:"="},link:function(e,n,r){var o,i,a=e.multiple||!1,s=e.endpoint,l=e.templateId;i=null!=e.allowedExtensions?{allowedExtensions:e.allowedExtensions}:{},e.sizeLimit&&(i.sizeLimit=e.sizeLimit);var c=e.maxConnections||1,u=e.onCompleteCallback||function(){},d=e.onUploadCallback||function(){},f=e.onErrorCallback||function(){},p=e.onValidateBatch||function(){},m=e.onSubmitCallback||function(){},h=e.onCancelCallback||function(){};o=null==e.autoUpload?!0:e.autoUpload;var g=e.params||{};g._csrf=window.csrfToken;var v=new t.FineUploader({element:n[0],multiple:a,autoUpload:o,disabledCancelForFormUploads:!0,validation:i,maxConnections:c,request:{endpoint:s,forceMultipart:!0,params:g,paramsInBody:!1},callbacks:{onComplete:u,onUpload:d,onValidateBatch:p,onError:f,onSubmit:m,onCancel:h},template:l,failedUploadTextDisplay:{mode:"custom",responseProperty:"error"}});return window.q=v,null!=e.control&&(e.control.q=v),v}}}])}),define("directives/onEnter",["base"],function(e){return e.directive("onEnter",function(){return function(e,t,n){return t.bind("keydown keypress",function(t){return 13===t.which?(e.$apply(function(){return e.$eval(n.onEnter,{event:t})}),t.preventDefault()):void 0})}})}),define("directives/selectAll",["base"],function(e){return e.directive("selectAllList",function(){return{controller:["$scope",function(e){this.selectAll=function(){return e.$broadcast("select-all:select")},this.deselectAll=function(){return e.$broadcast("select-all:deselect")},this.clearSelectAllState=function(){return e.$broadcast("select-all:clear")}}],link:function(e,t,n){}}}),e.directive("selectAll",function(){return{require:"^selectAllList",link:function(e,t,n,r){return e.$on("select-all:clear",function(){return t.prop("checked",!1)}),t.change(function(){return t.is(":checked")?r.selectAll():r.deselectAll(),!0})}}}),e.directive("selectIndividual",function(){return{require:"^selectAllList",scope:{ngModel:"="},link:function(e,t,n,r){var o=!1;return e.$watch("ngModel",function(e){return null==e||o?void 0:r.clearSelectAllState()}),e.$on("select-all:select",function(){return t.prop("disabled")?void 0:(o=!0,e.$apply(function(){return e.ngModel=!0}),o=!1)}),e.$on("select-all:deselect",function(){return t.prop("disabled")?void 0:(o=!0,e.$apply(function(){return e.ngModel=!1}),o=!1)}),e.$on("select-all:row-clicked",function(){return t.prop("disabled")?void 0:(o=!0,e.$apply(function(){return e.ngModel=!e.ngModel,e.ngModel?void 0:r.clearSelectAllState()}),o=!1)})}}}),e.directive("selectRow",function(){return{scope:!0,link:function(e,t,n){return t.on("click",function(t){return e.$broadcast("select-all:row-clicked")})}}})}),define("directives/maxHeight",["base"],function(e){return e.directive("maxHeight",function(){return{restrict:"A",link:function(e,t,n){return e.$watch(n.maxHeight,function(e){return null!=e?t.css({"max-height":e}):void 0})}}})}),define("directives/bookmarkableTabset",["base"],function(e){e.directive("bookmarkableTabset",["$location","_",function(e,t){return{restrict:"A",require:"tabset",link:function(n,r,o,i){var a=function(e){if(e&&""!==e){var n=t.find(i.tabs,function(t){return t.bookmarkableTabId===e});if(n)return n.select(),r.children()[0].scrollIntoView({behavior:"smooth"})}};n.$applyAsync(function(){var t=e.hash();a(t);var n=document.querySelectorAll(".link-to-tab"),r=function(e){var t=e.currentTarget.getAttribute("href").split("#").pop();a(t)};n&&Array.from(n).map(function(e){return e.addEventListener("click",r)})})}}}]),e.directive("bookmarkableTab",["$location",function(e){return{restrict:"A",require:"tab",link:function(t,n,r,o){var i=n.isolateScope(),a=r.bookmarkableTab;i&&a&&""!==a&&(i.bookmarkableTabId=a,i.$watch("active",function(t,n){return t&&!n&&e.hash()!==a?e.hash(a):void 0}))}}}])}),define("services/validateCaptcha",["base"],function(e){return e.factory("validateCaptcha",function(){var e=[],t=function(t){for(var n=0,r=e;n<r.length;n++){var o=r[n];o(t)}e=[]},n=null,r=function(r,o){if(null==r&&(r=function(e){}),"undefined"==typeof grecaptcha||null===grecaptcha||o)return r();var i=function(){return grecaptcha.reset()};if(e.push(r),e.push(i),null==n){var a=$("#recaptcha")[0];n=grecaptcha.render(a,{callback:t})}return grecaptcha.execute(n)};return r})}),define("services/validateCaptchaV3",["base"],function(e){return e.factory("validateCaptchaV3",function(){var e=window.grecaptcha,t=window.ExposedSettings;return function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e&&t&&t.recaptchaSiteKeyV3&&e.ready(function(){e.execute(t.recaptchaSiteKeyV3,{action:n}).then(r)})}})}),define("filters/formatDate",["base","moment"],function(e,t){t.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}}),e.filter("formatDate",function(){return function(e,n){return e?(null==n&&(n="Do MMM YYYY, h:mm a"),t(e).format(n)):"N/A"}}),e.filter("relativeDate",function(){return function(e){return t(e).calendar()}}),e.filter("fromNowDate",function(){return function(e){return t(e).fromNow()}})}),define("components/inputSuggestions",["base"],function(e){var t=function(e,t,n,r){var o=this;o.showHint=!1,o.hasFocus=!1,o.handleFocus=function(){return o.hasFocus=!0,o.suggestion=null},o.handleBlur=function(){
return o.showHint=!1,o.hasFocus=!1,o.suggestion=null,o.onBlur()},o.handleKeyDown=function(e){return e.which!==r.TAB&&e.which!==r.ENTER||null==o.suggestion||""===o.suggestion||(e.preventDefault(),o.localNgModel+=o.suggestion),o.suggestion=null,o.showHint=!1},e.$watch("$ctrl.localNgModel",function(e,t){return o.hasFocus&&e!==t?(o.suggestion=null,o.showHint=!1,o.getSuggestion({userInput:e}).then(function(t){return null!=t&&e===o.localNgModel?(o.showHint=!0,o.suggestion=t.replace(e,"")):void 0})["catch"](function(){return o.suggestion=null})):void 0})};return t.$inject=["$scope","$element","$attrs","Keys"],e.component("inputSuggestions",{bindings:{localNgModel:"=ngModel",localNgModelOptions:"=?ngModelOptions",getSuggestion:"&",onBlur:"&?",inputId:"@?",inputName:"@?",inputPlaceholder:"@?",inputType:"@?",inputRequired:"=?"},controller:t,template:['<div class="input-suggestions">','<div class="form-control input-suggestions-shadow">','<span ng-bind="$ctrl.localNgModel"',' class="input-suggestions-shadow-existing"',' ng-show="$ctrl.showHint">',"</span>",'<span ng-bind="$ctrl.suggestion"',' class="input-suggestions-shadow-suggested"',' ng-show="$ctrl.showHint">',"</span>","</div>",'<input type="text"',' class="form-control input-suggestions-main"',' ng-focus="$ctrl.handleFocus()"',' ng-keyDown="$ctrl.handleKeyDown($event)"',' ng-blur="$ctrl.handleBlur()"',' ng-model="$ctrl.localNgModel"',' ng-model-options="$ctrl.localNgModelOptions"',' ng-model-options="{ debounce: 50 }"',' ng-attr-id="{{ ::$ctrl.inputId }}"',' ng-attr-placeholder="{{ ::$ctrl.inputPlaceholder }}"',' ng-attr-type="{{ ::$ctrl.inputType }}"',' ng-attr-name="{{ ::$ctrl.inputName }}"',' ng-required="::$ctrl.inputRequired">',"</div>"].join("")})}),define("main/v2-templates/template_page_controller",["base"],function(e){return e.controller("TemplatePageController",["$scope","$modal",function(e,t){e.openViewSourceModal=function(){t.open({templateUrl:"viewSourceModalTemplate"})}}])}),define("main/v2-templates/directives/addsearch",["base"],function(e){return e.directive("addsearch",function(){return{link:function(e,t,n){var r=t.find("input"),o=t.find("button");return o.on("click",function(e){return window.location.search="addsearch=".concat(r.val())})}}})}),define("main/v2-templates/index",["main/v2-templates/template_page_controller","main/v2-templates/directives/addsearch"],function(){}),define("main/tpr-webmodule/controllers/ReferenceUnlinkController",["base"],function(e){return e.controller("ReferenceUnlinkController",["$scope","$modal",function(e,t){return e.unlinkAccount=function(e){return t.open({templateUrl:"referenceUnlinkModalTemplate",controller:"ReferenceUnlinkModalController",resolve:{provider:function(){return e}}})}}]),e.controller("ReferenceUnlinkModalController",["$scope","$modalInstance","provider",function(e,t,n){return e.provider=n,e.providerUnlink="/".concat(n,"/unlink")}])}),define("main/tpr-webmodule/index",["main/tpr-webmodule/controllers/ReferenceUnlinkController"],function(){}),define("main/templates/index",["base"],function(e){return e.controller("openInSlController",["$scope","$http","$window","$timeout",function(e,t,n,r){return e.openInSlText="Open in ShareLaTeX",e.isDisabled=!1,e.state={unpublishInFlight:!1,republishInFlight:!1,apiProblem:!1},e.buttonsDisabled=function(){return e.state.unpublishInFlight||e.state.republishInFlight},e.open=function(){return e.openInSlText="Creating...",e.isDisabled=!0,ga("send","event","template-site","open-in-sl",$(".page-header h1").text())},e.downloadZip=function(){return ga("send","event","template-site","download-zip",$(".page-header h1").text())},e.republish=function(r){return e.state.republishInFlight=!0,t.post("/project/".concat(r,"/template/publish"),{_csrf:window.csrfToken}).then(function(){return e.state.republishInFlight=!1,e.state.apiProblem=!1,n.location.reload()})["catch"](function(){return e.state.republishInFlight=!1,e.state.apiProblem=!1})},e.unpublish=function(o){return e.state.unpublishInFlight=!0,t.post("/project/".concat(o,"/template/unpublish"),{_csrf:window.csrfToken}).then(function(){return e.state.unpublishInFlight=!1,e.state.apiProblem=!1,r(function(){return n.location.href="/templates"},500)})["catch"](function(){return e.state.unpublishInFlight=!1,console.log(">> unpub failed"),e.state.apiProblem=!0})}}]),e.factory("algolia",function(){if(null!=__guard__(__guard__("undefined"!=typeof window&&null!==window?window.sharelatex:void 0,function(e){return e.algolia}),function(e){return e.app_id})){var e=new AlgoliaSearch(null!=window.sharelatex.algolia?window.sharelatex.algolia.app_id:void 0,null!=window.sharelatex.algolia?window.sharelatex.algolia.api_key:void 0),t=e.initIndex(__guard__(null!=window.sharelatex.algolia?window.sharelatex.algolia.indexes:void 0,function(e){return e.templates}));return t}return{}}),e.controller("SearchController",["$scope","algolia","_","$window",function(e,t,n,r){e.hits=[],e.showSearch=null!=__guard__(null!=r.sharelatex.algolia?r.sharelatex.algolia.indexes:void 0,function(e){return e.templates}),e.clearSearchText=function(){return e.searchQueryText="",i([])},e.safeApply=function(t){var n=e.$root.$$phase;return"$apply"===n||"$digest"===n?e.$eval(t):e.$apply(t)};var o=function(e){return{name:e._highlightResult.name.value,description:e._highlightResult.description.value,url:"/templates/".concat(e._id),image_url:"".concat(__guard__(null!=window.sharelatex?window.sharelatex.templates:void 0,function(e){return e.cdnDomain}),"/templates/").concat(e._id,"/v/").concat(e.version,"/pdf-converted-cache/style-thumbnail")}},i=function(t){return e.safeApply(function(){return e.hits=t})};return e.search=function(){var r=e.searchQueryText;return null==r||0===r.length?void i([]):(r="".concat(__guard__(null!=window.sharelatex?window.sharelatex.templates:void 0,function(e){return e.user_id})," ").concat(r),t.search(r,function(e,t){if(e)return i([]);if(0===t.hits.length)return i([]);var r=n.map(t.hits,o);return i(r)}))}}]),e.controller("MissingTemplateController",["$scope","$modal",function(e,t){return e.showMissingTemplateModal=function(){return t.open({templateUrl:"missingTemplateModal",controller:"MissingTemplateModalController"})}}]),e.controller("MissingTemplateModalController",["$scope","$modalInstance",function(e,t){return e.cancel=function(){return t.dismiss()}}])}),define("main/support/index",["base","libs/platform","services/algolia-search"],function(e,t){return e.controller("ContactModal",["$scope","$modal",function(e,t){return e.contactUsModal=function(){t.open({templateUrl:"contactModalTemplate",controller:"ContactModalController",scope:e})}}]),e.controller("ContactGeneralModal",["$scope","$modal",function(e,t){return e.openModal=function(){t.open({templateUrl:"contactGeneralModalTemplate",controller:"ContactGeneralModalController"})}}]),e.controller("ContactModalController",["$scope","$modalInstance",function(e,t){return e.close=function(){return t.close()}}]),e.controller("ContactGeneralModalController",["$scope","$modalInstance",function(e,t){return e.close=function(){return t.close()}}]),e.controller("ContactFormController",["$scope","algoliaSearch","event_tracking","$http",function(e,n,r,o){e.form={email:""},e.sent=!1,e.sending=!1,e.suggestions=[];var i=function(t,n){var o=function(){for(var e=[],t=0,r=Array.from(n.hits);t<r.length;t++){var o=r[t],i=__guard__(null!=o?o.pageName:void 0,function(e){return e.replace(/\s/g,"_")}),a=encodeURIComponent(i),s=o.kb?"how-to":"latex",l=o.sectionName&&""!==o.sectionName,c=l?"#".concat(o.sectionName.replace(/\s/g,"_")):"",u=o._highlightResult.pageName.value;l&&(u+=" - "+o.sectionName),e.push({url:"/learn/".concat(s,"/").concat(a).concat(c),name:u})}return e}();return n.hits.length&&r.sendMB("contact-form-suggestions-shown"),e.$applyAsync(function(){return e.suggestions=o})};e.contactUs=function(){if(null==e.form.email||""===e.form.email)return void console.log("email not set");e.sending=!0;var n=Math.floor(65536*(1+Math.random())).toString(32),r=e.form.message;null!=e.form.project_url&&(r="".concat(r,"\n\n project_url = ").concat(e.form.project_url));var i={_csrf:window.csrfToken,email:e.form.email,message:r||"",subject:e.form.subject+" - [".concat(n,"]"),labels:"support",inbox:e.inbox||"support",about:"<div>browser: ".concat(null!=t?t.name:void 0," ").concat(null!=t?t.version:void 0,"</div> <div>os: ").concat(__guard__(null!=t?t.os:void 0,function(e){return e.family})," ").concat(__guard__(null!=t?t.os:void 0,function(e){return e.version}),"</div>")},a=o.post("/support",i);return a.then(function(t){return e.sent=!0}),a["catch"](function(){return e.error=!0,console.log("the request failed")})};var a=e.$watch("inbox",function(t){return e.inbox});a();var s=e.$watch("showContactFormSuggestions",function(e){return null!=e?(e===!0&&l(),s()):void 0}),l=function(){return e.$watch("form.subject",function(t,r){return t&&t!==r&&t.length>3?n.searchWiki(t,i,{hitsPerPage:3,typoTolerance:"strict"}):e.suggestions=[]})};return e.clickSuggestionLink=function(e){return r.sendMB("contact-form-suggestions-clicked",{url:e})}}])}),define("main/portals/index",["base","libs/platform"],function(e,t){return e.controller("PortalFormController",["$scope","$http",function(e,t){var n="Yes! I would like to explore an Overleaf Institutional Account.";e.form={department:"",email:"",firstName:"",lastName:"",message:n,role:""},e.sent=!1,e.sending=!1,e.submitSupport=function(){if(null==e.form.email||""===e.form.email)return void(e.error="Please include your email");e.sending=!0;var r=e.form,o=r.department,i=r.firstName,a=r.lastName,s=r.message,l=r.role,c="".concat(e.siteUrl,"/").concat(e.portalType,"/").concat(e.portalSlug),u="\n        \n**Overleaf Portal Contact**\n        \n**Name:** ".concat(i," ").concat(a,"\n        \n**Message:** ").concat(s,"\n        \n**Role:** ").concat(l,"\n        \n**Department:** ").concat(o,"\n        \n**Portal:** ").concat(e.portalTitle,"\n        \n**Portal Link:** ").concat(c,"\n        "),d=s.trim()===n?"":"Custom Portal Message",f={_csrf:window.csrfToken,email:e.form.email,message:u||"",subject:"Overleaf Portal Contact",inbox:"portals",tags:d},p=t.post("/support",f);return p.then(function(t){return e.sent=!0}),p["catch"](function(){return e.error=!0,console.log("the request failed")})}}])}),define("main/overleaf-integration/index",["base"],function(e){return e.controller("OverleafAccountMergeCheckerController",["$scope","$http",function(e,t){return e.hasSlAccount=null,e.slEmail="",e.errorCode=null,e.success=null,e.submitEmail=function(){if(e.slEmail){var n={sharelatexEmail:e.slEmail,_csrf:window.csrfToken};return e.errorCode=null,t.post("/account-merge/email/sharelatex",n).then(function(t){return e.errorCode=null,e.success=!0})["catch"](function(t){return e.errorCode=__guard__(null!=t?t.data:void 0,function(e){return e.errorCode})||"default_error",e.success=!1})}}}])}),define("main/open-in-overleaf/index",["base"],function(e){return e.controller("OpenInOverleafGatewayController",["$scope","$http","localStorage",function(e,t,n){function r(e){document.referrer&&!e.referrer&&(e.referrer=document.referrer)}function o(e){return e.error?!0:"store"===e.action&&""!==e.target&&e.params?!0:"submit"===e.action&&e.params}function i(e,t){r(e),window.sessionStorage.setItem("openInOverleaf",JSON.stringify(e)),window.location.replace(t)}function a(e){return 0===Object.keys(e).filter(function(e){return"referrer"!==e}).length?JSON.parse(window.sessionStorage.getItem("openInOverleaf"))||{}:e}function s(r,o){r._csrf=o,t({method:"POST",url:window.location.pathname,data:r}).then(function(t){t.error?e.serverError=t.error:t.data&&t.data.redirect?("true"===r.rich_text&&n("editor.mode."+t.data.projectId,"rich-text"),window.location.replace(t.data.redirect)):e.error=!0},function(t){t.data&&t.data.error?e.serverError=t.data.error:e.error=!0})}e.error=!1,e.handleGateway=function(){var t=JSON.parse($("#overleaf-gateway-data").text());r(t.params),o(t)?t.error?e.serverError=t.error:"store"===t.action?i(t.params,t.target):"submit"===t.action&&s(a(t.params),t.csrfToken):e.error=!0}}])}),define("main/launchpad/controllers/LaunchpadController",["base"],function(e){return e.controller("LaunchpadController",["$scope","$http","$timeout",function(e,t,n){return e.adminUserExists=window.data.adminUserExists,e.ideJsPath=window.data.ideJsPath,e.authMethod=window.data.authMethod,e.createAdminSuccess=null,e.createAdminError=null,e.statusChecks={ideJs:{status:"inflight",error:null},websocket:{status:"inflight",error:null},healthCheck:{status:"inflight",error:null}},e.testEmail={emailAddress:"",inflight:!1,status:null},e.shouldShowAdminForm=function(){return!e.adminUserExists},e.onCreateAdminSuccess=function(t){var n=t.status;return n>=200&&300>n?e.createAdminSuccess=!0:void 0},e.onCreateAdminError=function(){return e.createAdminError=!0},e.sendTestEmail=function(){return e.testEmail.inflight=!0,e.testEmail.status=null,t.post("/launchpad/send_test_email",{email:e.testEmail.emailAddress,_csrf:window.csrfToken}).then(function(t){var n=t.status;return e.testEmail.inflight=!1,n>=200&&300>n?e.testEmail.status="ok":void 0})["catch"](function(){return e.testEmail.inflight=!1,e.testEmail.status="error"})},e.tryFetchIdeJs=function(){return e.statusChecks.ideJs.status="inflight",n(function(){return t.get(e.ideJsPath).then(function(t){var n=t.status;return n>=200&&300>n?e.statusChecks.ideJs.status="ok":void 0})["catch"](function(t){var n=t.status;return e.statusChecks.ideJs.status="error",e.statusChecks.ideJs.error=new Error("Http status: ".concat(n))})},1e3)},e.tryOpenWebSocket=function(){return e.statusChecks.websocket.status="inflight",n(function(){if("undefined"==typeof io||null===io)return e.statusChecks.websocket.status="error",void(e.statusChecks.websocket.error="socket.io not loaded");var t=io.connect(null,{reconnect:!1,"connect timeout":3e4,"force new connection":!0});return t.on("connectionAccepted",function(){return e.statusChecks.websocket.status="ok",e.$apply(function(){})}),t.on("connectionRejected",function(t){return e.statusChecks.websocket.status="error",e.statusChecks.websocket.error=t,e.$apply(function(){})}),t.on("connect_failed",function(t){return e.statusChecks.websocket.status="error",e.statusChecks.websocket.error=t,e.$apply(function(){})})},1e3)},e.tryHealthCheck=function(){return e.statusChecks.healthCheck.status="inflight",t.get("/health_check").then(function(t){var n=t.status;return n>=200&&300>n?e.statusChecks.healthCheck.status="ok":void 0})["catch"](function(t){var n=t.status;return e.statusChecks.healthCheck.status="error",e.statusChecks.healthCheck.error=new Error("Http status: ".concat(n))})},e.runStatusChecks=function(){return n(function(){return e.tryFetchIdeJs()},1e3),n(function(){return e.tryOpenWebSocket()},2e3)},e.adminUserExists?e.runStatusChecks():void 0}])}),define("main/launchpad/index",["main/launchpad/controllers/LaunchpadController"],function(){}),define("main/github-sync/controllers/GithubSyncMenuEntryController",["base"],function(e){return e.controller("GithubSyncMenuEntryController",["$scope","$modal",function(e,t){return e.openImportModal=function(){return t.open({templateUrl:"githubSyncImportModalTemplate",controller:"GithubSyncImportModalController",size:"lg"})}}])}),define("main/github-sync/controllers/GithubSyncImportModalController",["base"],function(e){return e.controller("GithubSyncImportModalController",["$scope","$modalInstance","$http",function(e,t,n){return e.cancel=function(){return t.dismiss()},e.handleError=function(t){var n=t.data,r=t.status,o=null;401===r?o="GithubCredentialsExpired":n&&n.error&&(o=n.error),o?e.status.error={code:o}:e.status.error=!0},e.status={loading:!0,error:!1},n.get("/user/github-sync/status",{disableAutoLoginRedirect:!0}).then(function(t){var r=t.data;return e.status.user=r,r.enabled?n.get("/user/github-sync/repos",{disableAutoLoginRedirect:!0}).then(function(t){var n=t.data;return e.status.loading=!1,e.status.repos=n.repos})["catch"](e.handleError):e.status.loading=!1})["catch"](function(){return e.status.error=!0}),e.importRepo=function(t){return e.status.inflight=!0,n.post("/project/new/github-sync",{_csrf:window.csrfToken,projectName:t.name,repo:t.full_name,disableAutoLoginRedirect:!0}).then(function(e){var t=e.data,n=t.project_id;return window.location="/project/".concat(n)})["catch"](e.handleError)}}])}),define("main/github-sync/controllers/GithubSyncUnlinkController",["base"],function(e){return e.controller("GithubSyncUnlinkController",["$scope","$modal",function(e,t){return e.unlinkAccount=function(){return t.open({templateUrl:"githubSyncUnlinkModalTemplate"})}}])}),define("main/github-sync/index",["main/github-sync/controllers/GithubSyncMenuEntryController","main/github-sync/controllers/GithubSyncImportModalController","main/github-sync/controllers/GithubSyncUnlinkController"],function(){}),define("main/dropbox/index",["base"],function(e){return e.controller("DropboxRegistrationController",["$scope","$window","$http","$timeout",function(e,t,n,r){var o=window.location.hash.indexOf("access_token"),i={_csrf:window.csrfToken,tokenInfo:window.location.hash.slice(o)};return e.state="processing",n.post("/dropbox/completeRegistration",i).then(function(){e.state="success";var n=function(){return t.location.href="/user/settings"};return r(n,5e3)})["catch"](function(t){var n=t.data;return e.state="error",n.error&&(e.error={code:n.error}),console.log("the request failed")})}])}),define("main/cms/index",["directives/mathjax"],function(){}),define("main/admin-panel/controllers/AdminUserListController",["base"],function(e){return e.controller("AdminUserListController",["$scope","$http","$timeout","$window","$modal","queuedHttp",function(e,t,n,r,o,i){e.users=window.data.users,e.pages=window.data.pages,e.allSelected=!1,e.selectedUsers=[],e.timer,e.pageSelected=1;var a=function(){var t=$(".user-list-card").offset().top,n=$("footer").outerHeight()+25,o=$("aside").height()-56,i=r.innerHeight-t-n;return o>i&&(i=Math.min(o,r.innerHeight-t-25)),e.userListHeight=i};n(function(){return a()},0),angular.element(r).bind("resize",function(){return a(),e.$apply()});var s=function(){e.isLoading=!0,data._csrf=window.csrfToken,data.query=e.searchText,data.regexp=e.searchRegExp,data.secondaryEmailSearch=e.secondaryEmailSearch,data.page=e.pageSelected;var n=t.post("/admin/user/search",data);return n.then(function(t){var n=t.data;return e.users=n.users,e.pages=n.pages,e.deletedUserCount=n.deletedUserCount,e.updateVisibleUsers(),e.isLoading=!1}),n["catch"](function(){return console.log("the request failed"),e.isLoading=!1})};return e.clearSearchText=function(){return e.searchText="",e.$emit("search:clear"),s()},e.searchUsers=function(){return e.pageSelected=1,s()},e.changePage=function(t){return e.pageSelected=t,s()},e.updateSelectedUsers=function(){return e.selectedUsers=e.users.filter(function(e){return e.selected})},e.updateVisibleUsers=function(){e.visibleUsers=[];for(var t=0,n=Array.from(e.users);t<n.length;t++){var r=n[t],o=!0;o?e.visibleUsers.push(r):r.selected=!1}return e.updatePages()},e.getSelectedUsers=function(){return e.selectedUsers},e.getFirstSelectedUser=function(){return e.selectedUsers[0]},e.updatePages=function(){return e.pagesList=[],e.pages>1?__range__(1,Math.min(100,e.pages),!0).map(function(t){return e.pagesList.push(t)}):void 0},e._removeUserFromList=function(t){var n=e.users.indexOf(t);return n>-1?e.users.splice(n,1):void 0},e.openDeleteUsersModal=function(){var t=o.open({templateUrl:"deleteUsersModalTemplate",controller:"DeleteUsersModalController",resolve:{users:function(){return e.getSelectedUsers()}}});return t.result.then(function(){return e.DeleteSelectedUsers()})},e.DeleteSelectedUsers=function(){for(var t=e.getSelectedUsers(),n=0,r=Array.from(t);n<r.length;n++){var o=r[n];e._removeUserFromList(o),i({method:"DELETE",url:"/admin/user/".concat(o._id),headers:{"X-CSRF-Token":window.csrfToken}})}return e.searchUsers()},e.openSetPasswordModal=function(){var t=o.open({templateUrl:"setPasswordModalTemplate",controller:"SetPasswordModalController",resolve:{user:function(){return e.getFirstSelectedUser()}}});return t.result.then(function(t){return e.SetUserPassword(t)})},e.SetUserPassword=function(t){var n=e.getFirstSelectedUser();return i.post("/admin/user/".concat(n._id,"/setPassword"),{newPassword:t,_csrf:window.csrfToken})},e.updateVisibleUsers()}]),e.controller("UserListItemController",["$scope",function(e){return e.$watch("user.selected",function(t){return null!=t?e.updateSelectedUsers():void 0})}]),e.controller("DeleteUsersModalController",["$scope","$modalInstance","$timeout","users",function(e,t,n,r){return e.users=r,e["delete"]=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("SetPasswordModalController",["$scope","$modalInstance","$timeout","user",function(e,t,n,r){return e.user=r,e.inputs={newPassword:""},e.setPassword=function(){return t.close(e.inputs.newPassword)},e.cancel=function(){return t.dismiss("cancel")}}])}),define("main/admin-panel/controllers/AdminUserController",["base","libs/md5"],function(e){e.controller("AdminUserController",["$scope","$timeout","$modal","queuedHttp",function(e,t,n,r){e.user=window.data.user,e.projects=window.data.projects,e.deletedProjects=window.data.deletedProjects,e.searchText={value:""},e.searchRegExp={value:!1},e.selectedProjects=[],e.predicate="lastUpdated",e.reverse=!0,e.allSelected=!1,e.enableBetaError=!1;for(var o=0,i=Array.from(e.projects);o<i.length;o++){var a=i[o];a.accessLevel="owner"}return e.clearSearchText=function(){return e.searchText.value="",e.updateVisibleProjects()},e.searchProjects=function(){return e.updateVisibleProjects()},e.updateSelectedProjects=function(){return e.selectedProjects=e.projects.filter(function(e){return e.selected})},e.getSelectedProjects=function(){return e.selectedProjects},e.thirdPartyIdentifier=function(t){var n=e.user.thirdPartyIdentifiers;if(n)for(var r=0;r<n.length;r++)if(n[r].providerId===t)return n[r].externalUserId;return null},e.archivedIsArray=function(e){return Array.isArray(e.archived)},e.openArchiveProjectsModal=function(){var t=n.open({templateUrl:"deleteProjectsModalTemplate",controller:"AdminDeleteProjectsModalController",resolve:{projects:function(){return e.getSelectedProjects()}}});return t.result.then(function(){return e.archiveOrLeaveSelectedProjects()})},e.archiveOrLeaveSelectedProjects=function(){for(var t=e.getSelectedProjects(),n=0,o=Array.from(t);n<o.length;n++)a=o[n],a.archived=!0,r({method:"DELETE",url:"/admin/project/".concat(a._id),headers:{"X-CSRF-Token":window.csrfToken}});return e.updateVisibleProjects()},e.changePredicate=function(t){return e.predicate===t&&(e.reverse=!e.reverse),e.predicate=t},e.getSortIconClass=function(t){return t===e.predicate&&e.reverse?"fa-caret-down":t!==e.predicate||e.reverse?"":"fa-caret-up"},e.openDeleteSecondaryEmailModal=function(t){var o=n.open({templateUrl:"deleteSecondaryEmailModalTemplate",controller:"DeleteSecondaryEmailModalController",resolve:{users:function(){return[{email:t}]}}});return o.result.then(function(){return r({method:"DELETE",url:"/admin/user/".concat(e.user._id,"/secondaryemail"),data:{emailToRemove:t},headers:{"Content-type":"application/json;charset=utf-8","X-CSRF-Token":window.csrfToken}}).then(function(){return setTimeout(function(){return window.location.href="/admin/user/".concat(e.user._id)},100)})})},e.openUnlinkOlModal=function(){var t=n.open({templateUrl:"unlinkOlModalTemplate",controller:"UnlinkOlModalController",resolve:{users:function(){return[e.user]}}});return t.result.then(function(){return r({method:"DELETE",url:"/admin/user/".concat(e.user._id,"/overleaf"),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return setTimeout(function(){return window.location.href="/admin/user/".concat(e.user._id)},100)})})},e.openDeleteUserModal=function(){var t=n.open({templateUrl:"deleteUsersModalTemplate",controller:"DeleteUsersModalController",resolve:{users:function(){return[e.user]}}});return t.result.then(function(){return e.DeleteUser()})},e.DeleteUser=function(){var t=e.user;return r({method:"DELETE",url:"/admin/user/".concat(t._id),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return setTimeout(function(){return window.location.href="/admin/user"},100)})},e.refreshFeatures=function(){var t=e.user;return e.refreshingFeatures=!0,r({method:"POST",url:"/admin/user/".concat(t._id,"/refresh_features"),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return location.reload()})},e.openSetDefaultUserEmailModal=function(t){var r=n.open({templateUrl:"setDefaultUserEmailModalTemplate",controller:"SetDefaultUserEmailController",resolve:{email:function(){return t.email}}});return r.result.then(function(){return e.setDefaultUserEmail(t.email)})},e.setDefaultUserEmail=function(t){var n=e.user;return r({method:"POST",url:"/admin/user/".concat(n._id,"/default_email"),headers:{"X-CSRF-Token":window.csrfToken},data:{email:t}}).then(function(){return location.reload()})},e.updateVisibleProjects=function(){return e.visibleProjects=[],function(){for(var t=[],n=0,r=Array.from(e.projects);n<r.length;n++){a=r[n];var o=!0;null!=e.searchText.value&&""!==e.searchText.value&&(a.name.toLowerCase().match(e.searchText.value.toLowerCase())||(o=!1)),o?t.push(e.visibleProjects.push(a)):t.push(a.selected=!1)}return t}()},e.updateVisibleProjects()}]),e.controller("AdminDeletedProjectListItemController",["$scope","$http",function(e,t){e.getDeletedProjectName=function(e){return e.project?e.project.name:null}}]),e.controller("AdminProjectListItemController",["$scope",function(e){return e.$watch("project.selected",function(t){return null!=t?e.updateSelectedProjects():void 0})}]),e.controller("AdminDeleteProjectsModalController",["$scope","$modalInstance","$timeout","projects",function(e,t,n,r){e.projectsToDelete=r,e.action="Delete",e["delete"]=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("UnlinkOlModalController",["$scope","$modalInstance","$timeout","users",function(e,t,n,r){e.users=r,e.unlink=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("DeleteSecondaryEmailModalController",["$scope","$modalInstance","$timeout","users",function(e,t,n,r){e.users=r,e["delete"]=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("SetDefaultUserEmailController",["$scope","$modalInstance","$timeout","email",function(e,t,n,r){e.email=r,e.confirm=function(){return t.close()},e.cancel=function(){return t.dismiss("cancel")}}])}),define("main/admin-panel/controllers/AdminSubscriptionController",["base","libs/md5"],function(e){e.controller("AdminSubscriptionController",["$scope","$http",function(e,t){e.subscription=window.data.subscription,e.deleteSubscription=function(){e.deleteError=!1,t({url:"/admin/subscription/".concat(e.subscription._id),method:"DELETE",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){window.location="/admin/deletedSubscription/".concat(e.subscription._id)})["catch"](function(){return e.deleteError=!0})},e.updateAdminFormManager={_visible:!1,data:{},open:function(){this.data.admin_id=e.subscription.admin_id,this._visible=!0},cancel:function(){this._visible=!1},onSuccess:function(){e.subscription.admin_id=this.data.admin_id,e.updateAdminForm.response.message={type:"success",text:"Subscription admin user updated"},this._visible=!1},isVisible:function(){return this._visible&&this.isEnabled()},isEnabled:function(){return e.subscription.customAccount}},e.onUpdateAdminSuccess=function(){e.updateAdminFormManager.onSuccess()}}]),e.controller("AdminCreateSubscriptionController",["$scope",function(e){e.subscription={customAccount:!0,groupPlan:!0,planCode:"professional",membersLimit:10,admin_id:window.data.admin_id},e.onSuccess=function(e){var t=e.data.subscription,n="/admin/subscription/".concat(t._id);window.location=n}}])}),define("main/admin-panel/controllers/AdminDeletedSubscriptionController",["base"],function(e){e.controller("AdminDeletedSubscriptionController",["$scope","$http",function(e,t){e.subscription=window.data.subscription,e.restoreSubscription=function(){e.restoreError=null,t({url:"/admin/deletedSubscription/".concat(e.subscription._id,"/restore"),method:"POST",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){window.location="/admin/subscription/".concat(e.subscription._id)})["catch"](function(t){e.restoreError={message:t.data.message||t.status}})}}])}),define("main/admin-panel/controllers/AdminGraphController",["base","libs/md5"],function(e,t){return e.controller("AdminGraphController",["$scope","$timeout","$location","$modal",function(e,t,n,r){e.user=window.data.user,e.user.gravatar=CryptoJS.MD5(e.user.email).toString();var o=n.absUrl();return e.level=o.substr(o.indexOf("level=")+6,1),e.config={graph:window.data.graph,container:"graph",type:"canvas",settings:{defaultNodeColor:"#ccc",edgeColor:"target",edgeLabelSize:"proportional",enableEdgeHovering:!0,edgeHoverColor:"edge",edgeHoverSizeRatio:3}},sigma.renderers.def=sigma.renderers.canvas,e.sGraph=new sigma(e.config),e.sGraph.startForceAtlas2({worker:!0,barnesHutOptimize:!1}),e.sGraph.refresh(),e.sGraph.bind("clickNode",function(t){return e.selectedElement={name:t.data.node.label,id:t.data.node.id,type:"User",link:"/admin/user/".concat(t.data.node.id)},e.openGraphModal()}),e.sGraph.bind("clickEdge",function(t){return e.selectedElement={name:t.data.edge.label,id:t.data.edge.projectId,type:"Project",link:"/admin/project/".concat(t.data.edge.projectId)},e.openGraphModal()}),t(function(){return e.sGraph.stopForceAtlas2()},500),e.openGraphModal=function(){var t;return t=r.open({templateUrl:"graphModalTemplate",controller:"GraphModalController",resolve:{element:function(){return e.selectedElement}}})}}]),e.controller("GraphModalController",["$scope","$modalInstance","element",function(e,t,n){return e.element=n,e.close=function(){return t.close()}}])}),define("main/admin-panel/controllers/AdminProjectController",["base","libs/md5"],function(e){e.controller("AdminProjectController",["$scope","$modal","$http","queuedHttp",function(e,t,n,r){var o=JSON.parse($("#admin-project-data").text()),i=o.project,a=o.deletedProject,s=o.docSnapshots;e.project=i,e.deletedProject=a,e.docSnapshots=s,e.editingBrandVariationId=!1,e.tagList=function(){return(e.project._ownerTags||[]).map(function(e){return e.name}).join(", ")},e.getRestoreEndpoint=function(e,t){return"/admin/project/".concat(e,"/doc_snapshot/").concat(t,"/restore")},e.openResyncModal=function(){var n=t.open({templateUrl:"ResyncModalTemplate",controller:"ResyncModalController",resolve:{project:function(){return i}}});return n.result.then(function(){setTimeout(function(){return window.location.href="/admin/project/".concat(e.project._id)},100)})},e.openTransferOwnershipModal=function(){var n=t.open({templateUrl:"TransferOwnershipModalTemplate",controller:"TransferOwnershipModalController",resolve:{project:function(){return i}}});return n.result.then(function(t){return r({method:"POST",url:"/admin/project/".concat(e.project._id,"/transfer"),data:{user_id:t},headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){return setTimeout(function(){return window.location.href="/admin/project/".concat(e.project._id)},100)})})},e.undeleteProject=function(t){e.error=null,n.post("/admin/project/"+t._id+"/undelete",{_csrf:window.csrfToken}).then(function(){window.location.href="/admin/project/"+t._id},function(t){console.log(t),e.error="Failed to undelete project: ".concat(t.statusText)})},e.getDeletedProjectField=function(e,t){return e.project?e.project[t]||"-":"scrubbed"}}]),e.controller("ResyncModalController",["$scope","$modalInstance","queuedHttp","project",function(e,t,n,r){return e.project=r,e.inflight=!1,e.state=null,e.confirm=function(){e.inflight=!0,n({method:"POST",url:"/admin/project/".concat(e.project._id,"/resync"),headers:{"X-CSRF-Token":window.csrfToken}}).then(function(){e.inflight=!1,
e.state="success"})["catch"](function(t){e.inflight=!1,e.state="error",e.error=t})},e.cancel=function(){return t.dismiss("cancel")}}]),e.controller("TransferOwnershipModalController",["$scope","$modalInstance","$http","project",function(e,t,n,r){var o=/^[a-f\d]{24}$/i,i=/([^@]+)@(.+)/;return e.project=r,e.user_id="",e.inflight=!1,e.user={},e.findUser=function(){e.inflight=!0,n.get("/admin/user/info/"+encodeURIComponent(e.user_id)).then(function(t){e.inflight=!1,t.data.user?(e.user=t.data.user,e.user._id===e.project.owner_ref?e.state="self-transfer":e.state="success"):e.state="error"},function(t){e.inflight=!1,404===t.status||422===t.status?e.state="notfound":e.state="error"})},e.validUserId=function(){return e.user_id.match(o)||e.user_id.match(i)},e.confirm=function(){return t.close(e.user._id)},e.cancel=function(){return t.dismiss("cancel")}}])}),define("main/admin-panel/index",["main/admin-panel/controllers/AdminUserListController","main/admin-panel/controllers/AdminUserController","main/admin-panel/controllers/AdminSubscriptionController","main/admin-panel/controllers/AdminDeletedSubscriptionController","main/admin-panel/controllers/AdminGraphController","main/admin-panel/controllers/AdminGraphController","main/admin-panel/controllers/AdminProjectController"],function(){}),define("main",["main/project-list/index","main/user-details","main/account-settings","main/clear-sessions","main/account-upgrade","main/plans","main/user-membership","main/scribtex-popup","main/event","main/bonus","main/system-messages","main/translations","main/subscription-dashboard","main/new-subscription","main/annual-upgrade","main/announcements","main/register-users","main/subscription/team-invite-controller","main/contact-us","main/learn","main/affiliations/components/affiliationForm","main/affiliations/controllers/UserAffiliationsController","main/affiliations/factories/UserAffiliationsDataService","main/oauth/controllers/UserOauthController","main/keys","main/importing","analytics/AbTestingManager","directives/autoSubmitForm","directives/asyncForm","directives/complexPassword","directives/stopPropagation","directives/focus","directives/equals","directives/eventTracking","directives/fineUpload","directives/onEnter","directives/selectAll","directives/maxHeight","directives/creditCards","directives/bookmarkableTabset","services/queued-http","services/validateCaptcha","services/validateCaptchaV3","filters/formatDate","components/inputSuggestions","main/v2-templates/index","main/tpr-webmodule/index","main/templates/index","main/support/index","main/portals/index","main/overleaf-integration/index","main/open-in-overleaf/index","main/launchpad/index","main/github-sync/index","main/dropbox/index","main/cms/index","main/admin-panel/index"],function(){return angular.module("SharelatexApp").config(["$locationProvider",function(e){try{return e.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})}catch(t){return console.error("Error while trying to fix '#' links: ",t)}}]),angular.bootstrap(document.body,["SharelatexApp"])});
//# sourceMappingURL=main.js.map